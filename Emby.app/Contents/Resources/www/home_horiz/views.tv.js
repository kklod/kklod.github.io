define(["connectionManager","dom","./spotlight","focusManager","cardBuilder","appRouter","globalize","emby-itemscontainer"],function(connectionManager,dom,spotlight,focusManager,cardBuilder,appRouter,globalize){"use strict";function backdropImageUrl(item,options){return(options=options||{}).type=options.type||"Backdrop",options.maxWidth||options.width||options.maxHeight||options.height||(options.quality=100),item.BackdropImageTags&&item.BackdropImageTags.length?(options.tag=item.BackdropImageTags[0],connectionManager.getApiClient(item.ServerId).getImageUrl(item.Id,options)):null}return function(element,apiClient,parentId){var self=this;this.parentId=parentId,this.apiClient=apiClient,this.latestItemsContainer=element.querySelector(".latestSection .itemsContainer"),this.latestItemsContainer.fetchData=function(){var options={IncludeItemTypes:"Episode",Limit:12,ParentId:this.parentId,EnableImageTypes:"Primary,Backdrop,Thumb,Logo",Fields:"PrimaryImageAspectRatio,ProductionYear,CommunityRating",ImageTypeLimit:1};return this.apiClient.getLatestItems(options)}.bind(this),this.latestItemsContainer.getListOptions=function(){return{renderer:cardBuilder,options:{shape:"backdrop",rows:3,preferThumb:!0,showGroupCount:!0,multiSelect:!1},virtualScrollLayout:"vertical-grid"}}.bind(this),this.latestItemsContainer.parentContainer=this.latestItemsContainer.closest(".horizontalSection"),this.resumeItemsContainer=element.querySelector(".resumeSection .itemsContainer"),this.resumeItemsContainer.fetchData=function(){var apiClient=this.apiClient,options={Limit:apiClient.isMinServerVersion("4.6.0.9")?24:6,ParentId:this.parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb,Logo"};return apiClient.getResumableItems(apiClient.getCurrentUserId(),options)}.bind(this),this.resumeItemsContainer.getListOptions=function(){return{renderer:cardBuilder,options:{shape:"backdrop",rows:3,preferThumb:!0,scalable:!1,seriesNameInPlaceHolderName:!0,multiSelect:!1},virtualScrollLayout:"vertical-grid"}}.bind(this),this.resumeItemsContainer.parentContainer=this.resumeItemsContainer.closest(".horizontalSection"),this.nextUpItemsContainer=element.querySelector(".nextUpSection .itemsContainer"),this.nextUpItemsContainer.fetchData=function(){var apiClient=this.apiClient,options={Fields:"PrimaryImageAspectRatio,ProductionYear,CommunityRating",EnableImageTypes:"Primary,Backdrop,Thumb,Logo",ImageTypeLimit:1,Limit:18,ParentId:this.parentId,UserId:apiClient.getCurrentUserId(),EnableTotalRecordCount:!1};return apiClient.getNextUpEpisodes(options)}.bind(this),this.nextUpItemsContainer.getListOptions=function(){return{renderer:cardBuilder,options:{shape:"backdrop",rows:3,preferThumb:!0,seriesNameInPlaceHolderName:!0,multiSelect:!1},virtualScrollLayout:"vertical-grid"}}.bind(this),this.nextUpItemsContainer.parentContainer=this.nextUpItemsContainer.closest(".horizontalSection"),this.categoryItemsContainer=element.querySelector(".categoryItemsContainer"),this.categoryItemsContainer.fetchData=function(){var apiClient=this.apiClient,parentId=this.parentId;return apiClient.getItems(apiClient.getCurrentUserId(),{SortBy:"IsFavoriteOrLiked,Random",SortOrder:"Descending",IncludeItemTypes:"Series",Limit:3,Recursive:!0,ParentId:parentId,EnableImageTypes:"Backdrop,Logo",ImageTypes:"Backdrop",Fields:"PrimaryImageAspectRatio,ProductionYear,CommunityRating",ImageTypeLimit:1}).then(function(seriesResult){var seriesItems=seriesResult.Items,imgOptions={maxWidth:600},items=[];return items.push({Name:globalize.translate("Shows"),Id:"tvshows",ServerId:apiClient.serverId(),ParentId:parentId,Icon:cardBuilder.getDefaultIcon({CollectionType:"tvshows"}),IsCategory:!0,ImageUrl:1<seriesItems.length?backdropImageUrl(seriesItems[1],imgOptions):null}),items.push({Name:globalize.translate("Favorites"),Id:"tvshows_favorites",ServerId:apiClient.serverId(),ParentId:parentId,Icon:"favorite",IsCategory:!0,ImageUrl:seriesItems.length?backdropImageUrl(seriesItems[0],imgOptions):null}),items.push({Name:globalize.translate("Upcoming"),Id:"tvshows_upcoming",ServerId:apiClient.serverId(),ParentId:parentId,Icon:"&#xE916;",IsCategory:!0}),Promise.resolve({Items:items,TotalRecordCount:items.length})})}.bind(this),this.categoryItemsContainer.getListOptions=function(){return{renderer:cardBuilder,options:{shape:"backdrop",multiSelect:!1,contextMenu:!1,overlayText:!0,fields:["Name"],action:"custom"},virtualScrollLayout:"vertical-grid"}}.bind(this),this.categoryItemsContainer.addEventListener("action-null",function(e){var item=e.detail.item,url="/tv?serverId="+connectionManager.getApiClient(item).serverId()+"&parentId="+item.ParentId,idParts=item.Id.split("_");1<idParts.length&&(url+="&tab="+idParts[1]),appRouter.show(url)}.bind(this)),this.spotlight=new spotlight(element.querySelector(".spotlightItemsContainer"),function(query){var apiClient=this.apiClient;return apiClient.getItems(apiClient.getCurrentUserId(),Object.assign({SortBy:"Random",IncludeItemTypes:"Series",Recursive:!0,ParentId:this.parentId,EnableImageTypes:"Backdrop,Logo",ImageTypes:"Backdrop",Fields:"Taglines,ProductionYear,CommunityRating",ImageTypeLimit:1},query))}.bind(this),function(){var apiClient=this.apiClient;return{Id:this.parentId,ServerId:apiClient.serverId(),CollectionType:"tvshows",Name:globalize.translate("Shows"),IsFolder:!0}}.bind(this)),self.resume=function(options){var promises=[this.spotlight.resume(options),this.categoryItemsContainer.resume(options),this.resumeItemsContainer.resume(options),this.nextUpItemsContainer.resume(options),this.latestItemsContainer.resume(options)];return Promise.all(promises)},self.pause=function(){self.spotlight.pause(),self.categoryItemsContainer.pause(),self.latestItemsContainer.pause(),self.resumeItemsContainer.pause(),self.nextUpItemsContainer.pause()},self.destroy=function(){self.spotlight&&(self.spotlight.destroy(),self.spotlight=null),self.categoryItemsContainer=null,self.latestItemsContainer=null,self.resumeItemsContainer=null,self.nextUpItemsContainer=null,self.apiClient=null}}});