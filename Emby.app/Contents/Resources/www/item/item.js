define(["indicators","textEncoding","skinManager","multiSelect","backdrop","appHeader","loading","imageLoader","listView","itemContextMenu","globalize","layoutManager","focusManager","apphost","cardBuilder","dom","appRouter","mediaInfo","connectionManager","itemHelper","datetime","inputManager","events","playbackManager","serverNotifications","baseView","emby-scroller","emby-itemscontainer","emby-linkbutton","emby-downloadbutton","flexStyles","css!./item"],function(indicators,textEncoding,skinManager,MultiSelect,backdrop,appHeader,loading,imageLoader,listView,itemContextMenu,globalize,layoutManager,focusManager,appHost,cardBuilder,dom,appRouter,mediaInfo,connectionManager,itemHelper,datetime,inputManager,events,playbackManager,serverNotifications,BaseView){"use strict";function renderTrackSelectionsWithoutUser(page,instance,item,forceReload){connectionManager.getApiClient(item.ServerId).getCurrentUser().then(function(user){renderTrackSelections(page,instance,item,user,forceReload)})}function cloneMediaStream(m){return Object.assign({},m)}function renderMediaSources(page,renderAdminFields,item,mediaSources){var groupedVersions=mediaSources.filter(function(g){return"Grouping"===g.Type});renderAdminFields&&groupedVersions.length?page.querySelector(".splitVersionContainer").classList.remove("hide"):page.querySelector(".splitVersionContainer").classList.add("hide");for(var parentElem=page.querySelector(".mediaSources"),anyDisplayed=!1,i=(parentElem.innerHTML="",0),length=mediaSources.length;i<length;i++){var mediaSource=mediaSources[i];!function(version,renderAdminFields){for(var i=0,length=version.MediaStreams.length;i<length;i++){if("Data"!==version.MediaStreams[i].Type)return 1}return version.Container||(version.Formats&&version.Formats.length||(version.Path&&"Http"!==version.Protocol&&renderAdminFields||!!version.Size))}(mediaSource,renderAdminFields)||function(parentElem,renderAdminFields,item,mediaSource,scrollX){var elem=document.createElement("div");elem.classList.add("mediaSource");var html="";html+=scrollX?'<div class="sectionTitle sectionTitle-cards" style="display:block;padding-left:.3em;padding-bottom:.5em;">':'<div style="display:block;">',mediaSource.Path&&"Http"!==mediaSource.Protocol&&renderAdminFields&&(html+="<div>"+mediaSource.Path+"</div>"),html+="<div>",mediaSource.Container&&(html+=mediaSource.Container.toUpperCase()),mediaSource.Size&&(html+='<span style="margin-left:1em;">'+(mediaSource.Size/1048576).toFixed(0)+"MB</span>");var sectionHtml,dateCreated=datetime.parseISO8601Date(item.DateCreated);html+='<span style="margin-left:1em;">'+globalize.translate("AddedOnValue",datetime.toLocaleDateString(dateCreated)+" "+datetime.getDisplayTime(dateCreated))+"</span>",html+="</div>",html=(html+="</div>")&&'<div class="padded-left padded-right">'+html+"</div>",elem.innerHTML=html,sectionHtml=scrollX?'<div is="emby-scroller" class="emby-scroller padded-top-focusscale padded-bottom-focusscale" data-mousewheel="false" data-centerfocus="true" data-horizontal="true"><div is="emby-itemscontainer" class="scrollSlider focuscontainer-x itemsContainer padded-left padded-right focusable" data-focusabletype="nearest"></div></div>':'<div is="emby-itemscontainer" class="vertical-list itemsContainer padded-left padded-right"></div>',elem.insertAdjacentHTML("beforeend",sectionHtml),parentElem.appendChild(elem);for(var mediaStreams=mediaSource.MediaStreams.map(cloneMediaStream),i=0,length=mediaStreams.length;i<length;i++)mediaStreams[i].StreamType=mediaStreams[i].Type,mediaStreams[i].Type="MediaStream",mediaStreams[i].MediaSourceId=mediaSource.Id,mediaStreams[i].ItemId=item.Id,mediaStreams[i].ServerId=item.ServerId;scrollX?cardBuilder.buildCards(mediaStreams,{shape:"backdrop",overlayText:!0,fields:["MediaStreamInfo"],itemsContainer:elem.querySelector(".itemsContainer"),action:"none",multiSelect:!1,ratingButton:!1,playedButton:!1,defaultIcon:!1,typeIndicator:!1,playedIndicator:!1,syncIndicator:!1,timerIndicator:!1,randomDefaultBackground:!1,imageFallback:!1,cardPadderClass:layoutManager.tv?"mediaStreamPadder-tv":"mediaStreamPadder",innerCardFooterClass:"mediaStreamInnerCardFooter",enableUserData:!1,draggable:!1}):listView.buildItems(mediaStreams,{image:!1,fields:["MediaStreamInfo"],itemsContainer:elem.querySelector(".itemsContainer"),action:"none",multiSelect:!1,ratingButton:!1,playedButton:!1,defaultIcon:!1,typeIndicator:!1,playedIndicator:!1,syncIndicator:!1,timerIndicator:!1,randomDefaultBackground:!1,imageFallback:!1,innerCardFooterClass:"mediaStreamInnerCardFooter",enableUserDataButtons:!1,draggable:!1,itemClass:"detailsListItem"})}(parentElem,renderAdminFields,item,mediaSource,anyDisplayed=!0)}anyDisplayed?page.querySelector(".audioVideoMediaInfo").classList.remove("hide"):page.querySelector(".audioVideoMediaInfo").classList.add("hide")}function isRenderingTrackSelections(item){return!(!itemHelper.supportsMediaSourceSelection(item)||-1===playbackManager.getSupportedCommands().indexOf("PlayMediaSource")||!playbackManager.canPlay(item))}function renderTrackSelections(page,instance,item,user,forceReload,mediaSources){var select=page.querySelector(".selectSource");if(!isRenderingTrackSelections(item))return renderMediaSources(page,user.Policy.IsAdministrator,item,item.MediaSources||[]),instance._currentPlaybackMediaSources=[],instance.trackSelectionsContainer.classList.add("hide"),select.innerHTML="",page.querySelector(".selectVideo").innerHTML="",page.querySelector(".selectAudio").innerHTML="",page.querySelector(".selectSubtitles").innerHTML="",select.setAttribute("disabled","disabled"),void updateTrackSelectionsFocusState(instance,page);(mediaSources?Promise.resolve(mediaSources):playbackManager.getPlaybackMediaSources(item)).then(function(mediaSources){var renderAdminFields=user.Policy.IsAdministrator;renderMediaSources(page,renderAdminFields,item,mediaSources),instance._currentPlaybackMediaSources=mediaSources,instance.trackSelectionsContainer.classList.remove("hide"),select.setLabel(globalize.translate("LabelVersion"));var currentValue=select.value,selectedId=mediaSources[0].Id;select.innerHTML=mediaSources.map(function(v){var selected=v.Id===selectedId?" selected":"";return'<option value="'+v.Id+'"'+selected+">"+v.Name+"</option>"}).join(""),1<mediaSources.length?(select.removeAttribute("disabled"),page.querySelector(".selectSourceContainer").classList.remove("hide")):(page.querySelector(".selectSourceContainer").classList.add("hide"),select.setAttribute("disabled","disabled")),select.value===currentValue&&!forceReload||(renderVideoSelections(page,mediaSources),renderAudioSelections(page,mediaSources),renderSubtitleSelections(page,mediaSources),updateTrackSelectionsFocusState(instance,page))})}function renderVideoSelections(page,mediaSources){var mediaSourceId=page.querySelector(".selectSource").value,tracks=mediaSources.filter(function(m){return m.Id===mediaSourceId})[0].MediaStreams.filter(function(m){return"Video"===m.Type}),select=page.querySelector(".selectVideo");select.setLabel(globalize.translate("LabelVideo"));var selectedId=tracks.length?tracks[0].Index:-1;select.innerHTML=tracks.map(function(v){var selected=v.Index===selectedId?" selected":"",titleParts=[],resolutionText=mediaInfo.getResolutionText(v);return resolutionText&&titleParts.push(resolutionText),v.Codec&&titleParts.push(v.Codec.toUpperCase()),'<option value="'+v.Index+'" '+selected+">"+(v.DisplayTitle||titleParts.join(" "))+"</option>"}).join(""),select.setAttribute("disabled","disabled"),tracks.length?page.querySelector(".selectVideoContainer").classList.remove("hide"):page.querySelector(".selectVideoContainer").classList.add("hide")}function renderAudioSelections(page,mediaSources){var mediaSourceId=page.querySelector(".selectSource").value,mediaSource=mediaSources.filter(function(m){return m.Id===mediaSourceId})[0],tracks=mediaSource.MediaStreams.filter(function(m){return"Audio"===m.Type}),select=page.querySelector(".selectAudio");select.setLabel(globalize.translate("LabelAudio"));var selectedId=mediaSource.DefaultAudioStreamIndex;select.innerHTML=tracks.map(function(v){var selected=v.Index===selectedId?" selected":"",embeddedTitle=v.Title&&!(v.DisplayTitle||"").includes(v.Title)?v.Title:null;return"<option"+(embeddedTitle?' title="'+embeddedTitle+'"':"")+' value="'+v.Index+'" '+selected+">"+v.DisplayTitle+"</option>"}).join(""),1<tracks.length?select.removeAttribute("disabled"):select.setAttribute("disabled","disabled"),tracks.length?page.querySelector(".selectAudioContainer").classList.remove("hide"):page.querySelector(".selectAudioContainer").classList.add("hide")}function renderSubtitleSelections(page,mediaSources){var mediaSourceId=page.querySelector(".selectSource").value,mediaSource=mediaSources.filter(function(m){return m.Id===mediaSourceId})[0],tracks=mediaSource.MediaStreams.filter(function(m){return"Subtitle"===m.Type}),select=page.querySelector(".selectSubtitles");select.setLabel(globalize.translate("LabelSubtitles"));var selected,selectedId=null==mediaSource.DefaultSubtitleStreamIndex?-1:mediaSource.DefaultSubtitleStreamIndex;tracks.length?(selected=-1===selectedId?" selected":"",select.innerHTML='<option value="-1">'+globalize.translate("Off")+"</option>"+tracks.map(function(v){selected=v.Index===selectedId?" selected":"";var embeddedTitle=v.Title&&!(v.DisplayTitle||"").includes(v.Title)?v.Title:null;return"<option"+(embeddedTitle?' title="'+embeddedTitle+'"':"")+' value="'+v.Index+'" '+selected+">"+v.DisplayTitle+"</option>"}).join(""),select.classList.remove("noSelections"),page.querySelector(".selectSubtitlesContainer").classList.remove("hide")):(select.innerHTML="",select.classList.add("noSelections"),page.querySelector(".selectSubtitlesContainer").classList.add("hide"))}function setButtonText(page,query,html){for(var elems=page.querySelectorAll(query),i=0,length=elems.length;i<length;i++){elems[i].innerHTML=html;var btn=elems[i].closest("button");btn&&(btn.title=html,btn.setAttribute("aria-label",html))}}function setResumeProgress(resumeInfoElement,item){var ticksLeft,minRemaining,resumeProgress=resumeInfoElement.querySelector(".resumeProgress");item.UserData&&0<item.UserData.PlaybackPositionTicks&&item.RunTimeTicks?(ticksLeft=item.RunTimeTicks-item.UserData.PlaybackPositionTicks,minRemaining='<div class="resumeTimeRemaining secondaryText">'+globalize.translate("TimeRemainingValue",datetime.getHumanReadableRuntime(ticksLeft))+"</div>",resumeProgress.innerHTML=indicators.getProgressBarHtml(item,{containerClass:"resumeInfoProgressBar"})+minRemaining,resumeInfoElement.querySelector(".resumeSpacer2").classList.remove("hide"),resumeProgress.classList.remove("hide")):(resumeProgress.classList.add("hide"),resumeInfoElement.querySelector(".resumeSpacer2").classList.remove("add"))}function reloadPlayButtons(instance,page,item,isUserDataChangeEvent){var now,enableShuffle,activeElement,isPlayFocused,btnPlay,btnResume,btnPlayTrailer,btnShuffle,canResume,canPlay=!1,playButtons=page.querySelectorAll(".btnPlay");return"Program"===item.Type?((now=new Date)>=datetime.parseISO8601Date(item.StartDate,!0)&&now<datetime.parseISO8601Date(item.EndDate,!0)?(hideAll(page,playButtons,!0),canPlay=!0):hideAll(page,playButtons),hideAll(page,"resumeButtonContainer"),hideAll(page,"btnShuffle"),hideAll(page,"btnQueue"),setButtonText(page,".playButtonText",globalize.translate("Play"))):playbackManager.canPlay(item)?(hideAll(page,"btnPlay",!0),enableShuffle=item.IsFolder||-1!==["MusicAlbum","MusicGenre","MusicArtist"].indexOf(item.Type),"Season"!==item.Type&&"Series"!==item.Type||(enableShuffle=!1),hideAll(page,"btnShuffle",enableShuffle),canPlay=!0,isPlayFocused=(activeElement=document.activeElement)&&activeElement.classList&&(activeElement.classList.contains("btnResume")||activeElement.classList.contains("btnMainPlay")),btnPlay=page.querySelector(".btnPlay"),btnResume=page.querySelector(".btnResume"),btnPlayTrailer=page.querySelector(".btnPlayTrailer"),btnShuffle=page.querySelector(".btnShuffle"),"Series"===item.Type&&item.UserData&&item.UserData&&item.UserData.UnplayedItemCount?(btnResume.classList.add("detailButton-primary"),btnPlay.classList.remove("detailButton-primary","detailButton-highres3"),function(instance,page){getNextUpItems.call(instance,{Limit:1}).then(function(result){var resumeName,item=result.Items[0],resumeInfo=page.querySelector(".resumeInfo");item?((resumeName=resumeInfo.querySelector(".resumeName")).innerHTML=itemHelper.getDisplayName(item),resumeName.classList.remove("hide"),page.querySelector(".resumeSpacer1").classList.remove("hide"),setResumeProgress(resumeInfo,item),item.UserData&&0<item.UserData.PlaybackPositionTicks?setButtonText(page,".resumeButtonText",globalize.translate("Resume")):setButtonText(page,".resumeButtonText",globalize.translate("Play")),resumeInfo.classList.remove("hide")):(setButtonText(page,".resumeButtonText",globalize.translate("Play")),resumeInfo.classList.add("hide")),hideAll(page,"resumeButtonContainer",!0)})}(instance,page),setButtonText(page,".playButtonText",globalize.translate("HeaderPlayAll")),btnPlay.classList.remove("detailButton-stacked"),btnPlayTrailer.classList.remove("detailButton-stacked"),btnShuffle.classList.remove("detailButton-stacked")):((canResume=item.UserData&&0<item.UserData.PlaybackPositionTicks)?(btnResume.classList.add("detailButton-primary"),btnPlay.classList.remove("detailButton-primary","detailButton-stacked"),btnPlay.classList.add("detailButton-highres3"),btnPlayTrailer.classList.remove("detailButton-stacked"),btnShuffle.classList.remove("detailButton-stacked"),setButtonText(page,".resumeButtonText.detailButton-lowres",globalize.translate("ResumeAt",datetime.getDisplayRunningTime(item.UserData.PlaybackPositionTicks))),setButtonText(page,".playButtonText",globalize.translate("PlayFromBeginning")),hideAll(page,"resumeInfo",!0),hideAll(page,"resumeName"),setResumeProgress(page.querySelector(".resumeInfo"),item)):(btnPlay.classList.add("detailButton-primary"),btnPlay.classList.remove("detailButton-highres3"),btnPlayTrailer.classList.remove("detailButton-stacked"),enableShuffle?(btnPlayTrailer.classList.remove("detailButton-stacked"),btnPlay.classList.add("detailButton-stacked"),btnShuffle.classList.add("detailButton-stacked")):(isTrailerButtonVisible(item)?(btnPlay.classList.add("detailButton-stacked"),btnPlayTrailer.classList.add("detailButton-stacked")):(btnPlay.classList.remove("detailButton-stacked"),btnPlayTrailer.classList.remove("detailButton-stacked")),btnShuffle.classList.remove("detailButton-stacked")),setButtonText(page,".playButtonText",globalize.translate("Play"))),hideAll(page,"resumeButtonContainer",canResume)),isUserDataChangeEvent||hideAll(page,"btnQueue",playbackManager.canQueue(item)),isPlayFocused&&focusMainSection.call(activeElement.parentNode)):(hideAll(page,playButtons),hideAll(page,"btnQueue"),hideAll(page,"resumeButtonContainer"),hideAll(page,"btnShuffle")),canPlay}function focusMainSection(){for(var btns=this.querySelectorAll(".detailButton"),i=0,length=btns.length;i<length;i++){var btn=btns[i];if(focusManager.isCurrentlyFocusable(btn))try{return void focusManager.focus(btn)}catch(err){}}focusManager.autoFocus(this)}function logoImageUrl(item,apiClient,options){options=options||{};var logoTypes=skinManager.getPreferredLogoImageTypes();return apiClient.getLogoImageUrl(item,options,logoTypes)}function setTitle(item,apiClient,enableLogo){"TvChannel"===item.Type&&(enableLogo=!1);var pageTitle,url=enableLogo?logoImageUrl(item,apiClient,{}):null;url?((pageTitle=document.querySelector(".pageTitle")).style.backgroundImage="url('"+url+"')",pageTitle.classList.add("pageTitleWithLogo"),pageTitle.innerHTML=""):appHeader.setTitle("")}function renderLogo(page,item,apiClient){var url=logoImageUrl(item,apiClient,{maxWidth:300});"TvChannel"===item.Type&&(url=null);var detailLogo=page.querySelector(".detailLogo"),detailLogoContainer=page.querySelector(".detailLogoContainer");url?(detailLogo.style.backgroundImage="url('"+url+"')",detailLogoContainer.classList.remove("hide")):detailLogoContainer.classList.add("hide")}function getArtistLinksHtml(artists,serverId){for(var html=[],i=0,length=artists.length;i<length;i++){var artist=artists[i],href=appRouter.getRouteUrl(artist,{itemType:"MusicArtist",serverId:serverId});html.push('<a style="color:inherit;font-weight:inherit;" class="button-link" is="emby-linkbutton" href="'+href+'">'+textEncoding.htmlEncode(artist.Name)+"</a>")}return html=html.join(" / ")}function inferContext(item){return"Movie"===item.Type||"BoxSet"===item.Type?"movies":"Series"===item.Type||"Season"===item.Type||"Episode"===item.Type?"tvshows":"Game"===item.Type||"GameSystem"===item.Type||"Game"===item.Type||"GameSystem"===item.Type?"games":"MusicArtist"===item.Type||"MusicAlbum"===item.Type||"Audio"===item.Type||"AudioBook"===item.Type?"music":null}function isTrailerButtonVisible(item){if(playbackManager.getSupportedCommands().includes("PlayTrailers")){if(item.LocalTrailerCount)return 1;if(item.RemoteTrailers&&item.RemoteTrailers.length)return 1}}function setTrailerButtonVisibility(page,item){isTrailerButtonVisible(item)?hideAll(page,"btnPlayTrailer",!0):hideAll(page,"btnPlayTrailer")}function enableTrackList(item){return layoutManager.tv&&("Playlist"===item.Type||"MusicAlbum"===item.Type)}function enableItemBackdropAsTopImage(item){return"Playlist"!==item.Type&&"MusicAlbum"!==item.Type&&"TvChannel"!==item.Type&&"Audio"!==item.Type}function hideAll(page,className,show){for(var elems="string"==typeof className?page.querySelectorAll("."+className):className,i=0,length=elems.length;i<length;i++)show?elems[i].classList.remove("hide"):elems[i].classList.add("hide")}function getContextMenuOptions(view,item,user,button){var selectSource=view.querySelector(".selectSource"),options={item:item,open:!1,play:!1,playAllFromHere:!1,queueAllFromHere:!1,positionTo:button,cancelTimer:!1,record:!1,deleteItem:!0,shuffle:"Series"===item.Type||"Season"===item.Type,instantMix:!0,user:user,share:!0,mediaSourceId:selectSource&&selectSource.value||null,positionY:"center",positionX:"right",transformOrigin:"left top",played:!1,favorites:!1,navigateOnDelete:"back"};return appHost.supports("sync")&&(options.syncLocal=!1),options}function renderDetails(instance,view,item,apiClient,user){var promises=[],overviewElem=view.querySelector(".overview-container"),overviewTextElem=overviewElem.querySelector(".overview-text");enableTrackList(item)?(view.querySelector(".detailLogo").classList.add("detailLogo-tracklist"),overviewTextElem.classList.add("overview-text-tracklist")):overviewTextElem.classList.remove("overview-text-tracklist"),item.Overview?(function(elem,overview){var textElement=elem.querySelector(".overview-text"),btnReadMore=elem.querySelector(".btnReadMore");if(btnReadMore.innerHTML=globalize.translate("More"),!overview)return elem.classList.add("hide"),textElement.innerHTML="";textElement.innerHTML=overview,elem.classList.remove("hide");var offsetHeight=textElement.offsetHeight,scrollHeight=textElement.scrollHeight,textButton=textElement.closest("button");offsetHeight&&scrollHeight&&offsetHeight<scrollHeight?(layoutManager.tv?(textButton.removeAttribute("disabled"),textButton.classList.remove("btnOverviewText-allowselection"),btnReadMore.classList.add("hide")):(textButton.setAttribute("disabled","disabled"),textButton.classList.add("btnOverviewText-allowselection"),btnReadMore.classList.remove("hide")),setScopedFocus(null,elem,!0)):(textButton.setAttribute("disabled","disabled"),layoutManager.tv?textButton.classList.remove("btnOverviewText-allowselection"):textButton.classList.add("btnOverviewText-allowselection"),btnReadMore.classList.add("hide"),setScopedFocus(null,elem,!1))}(overviewElem,item.Overview?dom.stripScripts(item.Overview):""),"MusicAlbum"===item.Type||"Playlist"===item.Type?overviewTextElem.classList.add("overview-twoline"):overviewTextElem.classList.remove("overview-twoline")):overviewElem.classList.add("hide"),function(page,item){var directors=(item.People||[]).filter(function(p){return"Director"===p.Type}),html=directors.map(function(p){return'<a style="color:inherit;" class="button-link" is="emby-linkbutton" href="'+appRouter.getRouteUrl({Name:p.Name,Type:"Person",ServerId:item.ServerId,Id:p.Id},{})+'">'+textEncoding.htmlEncode(p.Name)+"</a>"}).join(", "),elem=page.querySelector(".directors");elem.innerHTML=1<directors.length?globalize.translate("DirectorsValue",html):globalize.translate("DirectorValue",html),directors.length?elem.classList.remove("hide"):elem.classList.add("hide")}(view,item),reloadPlayButtons(instance,view,item),function(page,item){for(var btnPlaystates=page.querySelectorAll(".btnPlaystate"),i=0,length=btnPlaystates.length;i<length;i++){var btnPlaystate=btnPlaystates[i];itemHelper.canMarkPlayed(item)?(btnPlaystate.classList.remove("hide"),btnPlaystate.setItem(item)):(btnPlaystate.classList.add("hide"),btnPlaystate.setItem(null))}var btnUserRatings=page.querySelectorAll(".btnUserRating");for(i=0,length=btnUserRatings.length;i<length;i++){var btnUserRating=btnUserRatings[i];itemHelper.canRate(item)?(btnUserRating.classList.remove("hide"),btnUserRating.setItem(item)):(btnUserRating.classList.add("hide"),btnUserRating.setItem(null))}}(view,item),setTrailerButtonVisibility(view,item),item.CanDelete&&!item.IsFolder&&"MusicArtist"!==item.Type?hideAll(view,"btnDeleteItem",!0):hideAll(view,"btnDeleteItem"),promises.push(function(instance,page,item,user){if(instance.currentRecordingFields)return instance.currentRecordingFields.refresh(item),Promise.resolve();return"Program"===item.Type&&user.Policy.EnableLiveTvManagement?require(["recordingFields"]).then(function(responses){var RecordingFields=responses[0],recordingFieldsElement=page.querySelector(".mainDetailButtons");instance.currentRecordingFields=new RecordingFields({parent:recordingFieldsElement,program:item}),events.on(instance.currentRecordingFields,"recordingchanged",onRecordingChanged.bind(instance)),events.on(instance.currentRecordingFields,"seriesrecordingchanged",onRecordingChanged.bind(instance))}):Promise.resolve()}(instance,view,item,user)),itemContextMenu.getCommands(getContextMenuOptions(view,item,user)).length?hideAll(view,"btnMoreCommands",!0):hideAll(view,"btnMoreCommands");var mediaInfoElem=view.querySelector(".mediaInfoPrimary");"Season"===item.Type||"SeriesTimer"===item.Type?mediaInfoElem.classList.add("hide"):(mediaInfo.fillPrimaryMediaInfo(mediaInfoElem,item,{interactive:!0,episodeTitle:!1,subtitles:!1,dateAdded:!1,genres:!0,context:inferContext(item)}),setScopedFocus(null,mediaInfoElem,null!=mediaInfoElem.querySelector("a,button"),"nearest")),enableItemBackdropAsTopImage(item)?(mediaInfoElem.classList.remove("mediaInfo-centered"),view.querySelector(".detailTextContainerInner").classList.remove("detailTextContainerInner-centered")):(mediaInfoElem.classList.add("mediaInfo-centered"),view.querySelector(".detailTextContainerInner").classList.add("detailTextContainerInner-centered")),mediaInfoElem=view.querySelector(".mediaInfoSecondary"),mediaInfo.fillSecondaryMediaInfo(mediaInfoElem,item,{interactive:!0}),setScopedFocus(null,mediaInfoElem,null!=mediaInfoElem.querySelector("a,button"),"nearest"),mediaInfoElem.innerHTML.trim()?mediaInfoElem.classList.remove("hide"):mediaInfoElem.classList.add("hide");var birthDateElem,birthDateString,deathDateElem,deathDateString,taglineElem=view.querySelector(".tagline");return item.Taglines&&item.Taglines.length?(taglineElem.classList.remove("hide"),taglineElem.innerHTML=dom.stripScripts(item.Taglines[0])):taglineElem.classList.add("hide"),"Person"===item.Type&&(birthDateElem=view.querySelector(".birthDate"),item.PremiereDate?(birthDateString=datetime.toLocaleDateString(datetime.parseISO8601Date(item.PremiereDate),{year:"numeric",month:"long",day:"numeric"}),birthDateString=item.ProductionLocations&&item.ProductionLocations.length?globalize.translate("BornValueWithPlace",birthDateString,item.ProductionLocations[0]):globalize.translate("BornValue",birthDateString),birthDateElem.innerHTML=birthDateString,birthDateElem.classList.remove("hide")):birthDateElem.classList.add("hide"),deathDateElem=view.querySelector(".deathDate"),item.EndDate?(deathDateString=datetime.toLocaleDateString(datetime.parseISO8601Date(item.EndDate),{year:"numeric",month:"long",day:"numeric"}),deathDateString=globalize.translate("DiedValue",deathDateString),deathDateElem.innerHTML=deathDateString,deathDateElem.classList.remove("hide")):deathDateElem.classList.add("hide")),function(page,item){var itemTags=page.querySelector(".itemTags"),tagElements=[],tags=item.TagItems||[];"Program"===item.Type&&(tags=[]);for(var i=0,length=tags.length;i<length;i++){var href=appRouter.getRouteUrl({Name:tags[i].Name,Type:"Tag",ServerId:item.ServerId,Id:tags[i].Id},{itemTypes:"Person"===item.Type||"MusicArtist"===item.Type?item.Type:null});tagElements.push('<a is="emby-linkbutton" class="raised item-tag-button nobackdropfilter" href="'+href+'"><i class="md-icon button-icon button-icon-left">label</i>'+textEncoding.htmlEncode(tags[i].Name)+"</a>")}itemTags.innerHTML=tagElements.join(""),tagElements.length?page.querySelector(".tagsSection").classList.remove("hide"):page.querySelector(".tagsSection").classList.add("hide")}(view,item),Promise.all(promises)}function onRecordingChanged(){reloadItem(this,!0)}function renderPeopleItems(view,item,apiClient){var section=view.querySelector(".peopleItems");if("Person"===item.Type||"MusicArtist"===item.Type){section.classList.remove("hide");var sections=[];"Person"===item.Type?(sections.push({name:globalize.translate("HeaderUpcomingOnTV"),type:"Program"}),sections.push({name:globalize.translate("Movies"),type:"Movie"}),sections.push({name:globalize.translate("Shows"),type:"Series"}),sections.push({name:globalize.translate("Episodes"),type:"Episode"}),sections.push({name:globalize.translate("Trailers"),type:"Trailer"}),sections.push({name:globalize.translate("HeaderMusicVideos"),type:"MusicVideo"}),sections.push({name:globalize.translate("Videos"),type:"Video"})):"MusicArtist"===item.Type&&sections.push({name:globalize.translate("HeaderMusicVideos"),type:"MusicVideo"}),section.innerHTML=sections.map(function(section){var html="";return html+='<div class="verticalSection personSection" data-type="'+section.type+'">',html+='<div class="sectionTitleContainer sectionTitleContainer-cards padded-left padded-right">',html+='<a is="emby-sectiontitle" href="'+function(item,type){return"Genre"===item.Type?"list/list.html?type="+type+"&genreId="+item.Id+"&serverId="+item.ServerId:"MusicGenre"===item.Type?"list/list.html?type="+type+"&musicGenreId="+item.Id+"&serverId="+item.ServerId:"GameGenre"===item.Type?"list/list.html?type="+type+"&gameGenreId="+item.Id+"&serverId="+item.ServerId:"Studio"===item.Type?"list/list.html?type="+type+"&studioId="+item.Id+"&serverId="+item.ServerId:"MusicArtist"===item.Type?"list/list.html?type="+type+"&artistId="+item.Id+"&serverId="+item.ServerId:"Person"===item.Type?"list/list.html?type="+type+"&personId="+item.Id+"&serverId="+item.ServerId:"list/list.html?type="+type+"&parentId="+item.Id+"&serverId="+item.ServerId}(item,section.type)+'" class="button-link sectionTitleTextButton">',html+='<h2 class="sectionTitle sectionTitle-cards">',html+=section.name,html+="</h2>",html+="</a>",html+="</div>",html+='<div is="emby-scroller" class="emby-scroller padded-top-focusscale padded-bottom-focusscale" data-mousewheel="false" data-centerfocus="true" data-horizontal="true">',html+='<div is="emby-itemscontainer" class="scrollSlider focuscontainer-x itemsContainer padded-left padded-right"></div>',html+="</div>",html+="</div>",html+="</div>"}).join("");for(var sectionElems=section.querySelectorAll(".personSection"),i=0,length=sectionElems.length;i<length;i++)!function(item,element,type,apiClient){switch(type){case"Program":loadPeopleItems(element,item,0,{IncludeItemTypes:"Program",Limit:12,SortBy:"StartDate",Fields:"PrimaryImageAspectRatio"},{shape:"autooverflow",fields:["Name","ChannelName"],centerText:!0,preferThumb:!0,overlayText:!1,showAirTime:!0,showAirDateTime:!0},apiClient);break;case"Movie":loadPeopleItems(element,item,0,{IncludeItemTypes:"Movie",Limit:12,SortBy:"SortName",Fields:"PrimaryImageAspectRatio"},{shape:"autooverflow",fields:["Name","ProductionYear"],centerText:!0,overlayText:!1},apiClient);break;case"Video":loadPeopleItems(element,item,0,{IncludeItemTypes:"Video",Limit:12,SortBy:"SortName",Fields:"PrimaryImageAspectRatio"},{shape:"autooverflow",fields:["Name","ProductionYear"],centerText:!0,overlayText:!1},apiClient);break;case"MusicVideo":loadPeopleItems(element,item,0,{IncludeItemTypes:"MusicVideo",Limit:12,SortBy:"SortName",Fields:"PrimaryImageAspectRatio"},{shape:"autooverflow",fields:["Name"],centerText:!0,overlayPlayButton:!0},apiClient);break;case"Game":loadPeopleItems(element,item,0,{IncludeItemTypes:"Game",Limit:12,SortBy:"SortName",Fields:"PrimaryImageAspectRatio"},{shape:"autooverflow",fields:["Name"],centerText:!0},apiClient);break;case"Trailer":loadPeopleItems(element,item,0,{IncludeItemTypes:"Trailer",Limit:12,SortBy:"SortName",Fields:"PrimaryImageAspectRatio"},{shape:"autooverflow",fields:["Name"],centerText:!0,overlayPlayButton:!0},apiClient);break;case"Series":loadPeopleItems(element,item,0,{IncludeItemTypes:"Series",Limit:12,SortBy:"SortName",Fields:"PrimaryImageAspectRatio"},{shape:"autooverflow",fields:["Name"],centerText:!0},apiClient);break;case"MusicAlbum":loadPeopleItems(element,item,0,{IncludeItemTypes:"MusicAlbum",Limit:12,SortBy:"ProductionYear,SortName",SortOrder:"Descending,Ascending",Fields:"ProductionYear,PrimaryImageAspectRatio"},{shape:"autooverflow",playFromHere:!0,fields:["Name","ProductionYear"],centerText:!0,overlayPlayButton:!0},apiClient);break;case"MusicArtist":loadPeopleItems(element,item,0,{IncludeItemTypes:"MusicArtist",Limit:8,SortBy:"SortName",Fields:"PrimaryImageAspectRatio"},{shape:"autooverflow",playFromHere:!0,fields:["Name"],showParentTitle:!0,centerText:!0,overlayPlayButton:!0},apiClient);break;case"Episode":loadPeopleItems(element,item,0,{IncludeItemTypes:"Episode",Limit:6,SortBy:"SeriesSortName,SortName",Fields:"PrimaryImageAspectRatio"},{shape:"autooverflow",fields:["Name"],showParentTitle:!0,centerText:!0,overlayPlayButton:!0},apiClient);break;case"Audio":loadPeopleItems(element,item,0,{IncludeItemTypes:"Audio",SortBy:"AlbumArtist,Album,SortName",Fields:"PrimaryImageAspectRatio"},{playFromHere:!0,action:"playallfromhere",smallIcon:!0,artist:!0},apiClient)}}(item,sectionElems[i],sectionElems[i].getAttribute("data-type"),apiClient)}else section.classList.add("hide")}function loadPeopleItems(element,item,type,query,listOptions,apiClient){query.SortBy="SortName",query.SortOrder="Ascending",query.Recursive=!0,query.CollapseBoxSetItems=!1,query.Fields="PrimaryImageAspectRatio,ProductionYear","Person"===item.Type?query.PersonIds=item.Id:"MusicArtist"===item.Type&&(query.ArtistIds=item.Id),query.ImageTypeLimit=1,query.EnableTotalRecordCount=!1,apiClient.getItems(apiClient.getCurrentUserId(),query).then(function(result){cardBuilder.buildCards(result.Items,{parentContainer:element,itemsContainer:element.querySelector(".itemsContainer"),shape:listOptions.shape,fields:listOptions.fields,showParentTitle:listOptions.showParentTitle,overlayText:!1,centerText:!0})})}function onTrackSelectionsSubmit(e){return e.preventDefault(),!1}function bindAll(view,selector,eventName,fn){for(var elems=view.querySelectorAll(selector),i=0,length=elems.length;i<length;i++)elems[i].addEventListener(eventName,fn)}function onInputCommand(e){switch(e.detail.command){case"play":playCurrentItem(this,"resume");break;case"record":!function(instance){var currentItem=instance.currentItem,type=currentItem.Type,id=currentItem.Id,serverId=currentItem.ServerId,timerId=currentItem.TimerId,seriesTimerId=currentItem.SeriesTimerId;("Program"===type||timerId||seriesTimerId)&&require(["recordingHelper"],function(recordingHelper){var programId="Program"===type?id:null;recordingHelper.toggle(serverId,programId,timerId,seriesTimerId).then(function(){reloadItem(instance,!0)})})}(this);break;case"delete":onDeleteClick.call(this);break;default:return}e.preventDefault(),e.stopPropagation()}function onDataFetched(responses){var backdropUrl,itemInfo=responses[0],item=itemInfo.item,mediaSources=itemInfo.mediaSources,user=responses[1],apiClient=connectionManager.getApiClient(item.ServerId),view=this.view,hasAnimatedTransition=view.classList.contains("animatedView");"Person"===item.Type&&backdrop.hasBackdrop()||backdrop.setBackdrops([item],null,null,!hasAnimatedTransition),!hasAnimatedTransition||(backdropUrl=backdrop.getCurrentUrl())&&(view.classList.add("animatedView-withbackdrop"),view.style["background-image"]="url("+backdropUrl+")"),this.currentItem=item,this.sectionsInitialized||(this.sectionsInitialized=!0,function(instance,view,item){if("Series"!==item.Type)return;var itemsContainer=view.querySelector(".nextUpItemsContainer");itemsContainer.fetchData=getNextUpItems.bind(instance),itemsContainer.parentContainer=itemsContainer.closest(".verticalSection"),itemsContainer.getListOptions=getNextUpListOptions,itemsContainer.classList.add("generalItemsContainer")}(this,view,item),function(instance,view,item){if("Episode"!==item.Type)return;var itemsContainer=view.querySelector(".moreFromSeasonItemsContainer"),section=itemsContainer.closest(".verticalSection");section.querySelector("h2").innerHTML=globalize.translate("MoreFromValue",item.SeasonName),itemsContainer.fetchData=function(query){var item=this.currentItem;if(!item.SeasonId||!item.SeriesId)return Promise.resolve({TotalRecordCount:0,Items:[]});var apiClient=connectionManager.getApiClient(item);return query=Object.assign({SeasonId:item.SeasonId,UserId:apiClient.getCurrentUserId(),Fields:"PrimaryImageAspectRatio,BasicSyncInfo,CanDelete"},query),apiClient.getEpisodes(item.SeriesId,query).then(function(result){return!query.StartIndex&&result.Items.length<2?Promise.resolve({TotalRecordCount:0,Items:[]}):result})}.bind(instance),itemsContainer.parentContainer=section,itemsContainer.getListOptions=getMoreFromSeasonListOptions,itemsContainer.afterRefresh=function(totalResult){if(!totalResult.Items.length)return;var item=this.currentItem;if(!item)return;var view=this.view;if(!view)return;var itemsContainer=view.querySelector(".moreFromSeasonItemsContainer");if(!itemsContainer)return;var index=itemsContainer.indexOfItemId(item.Id);if(-1!==index)return void itemsContainer.scrollToIndex(Math.min(index+1,totalResult.TotalRecordCount-1),{behavior:"instant"},!1);var apiClient=connectionManager.getApiClient(item);if(!apiClient.isMinServerVersion("4.6.0.38"))return;var query={SeasonId:item.SeasonId,UserId:apiClient.getCurrentUserId(),Fields:"PrimaryImageAspectRatio,BasicSyncInfo,CanDelete",Limit:0,StartItemId:item.Id};return apiClient.getEpisodes(item.SeriesId,query).then(function(result){index=Math.max(totalResult.TotalRecordCount-result.TotalRecordCount,0),itemsContainer.scrollToIndex(Math.min(index+1,totalResult.TotalRecordCount-1),{behavior:"instant"},!1)})}.bind(instance),itemsContainer.classList.add("generalItemsContainer")}(this,view,item),function(instance,view,item){var itemsContainer=view.querySelector(".moreFromArtistItemsContainer"),section=itemsContainer.closest(".verticalSection");if("MusicArtist"!==item.Type&&"MusicAlbum"!==item.Type)return;"MusicArtist"===item.Type?section.querySelector(".sectionTitle").innerHTML=globalize.translate("HeaderAppearsOn"):section.querySelector(".sectionTitle").innerHTML=globalize.translate("MoreFromValue",textEncoding.htmlEncode(item.AlbumArtists[0].Name));itemsContainer.fetchData=function(query){var item=this.currentItem;if("MusicAlbum"===item.Type&&!item.AlbumArtists&&!item.AlbumArtists.length)return Promise.resolve({TotalRecordCount:0,Items:[]});query=Object.assign({IncludeItemTypes:"MusicAlbum",Recursive:!0,ExcludeItemIds:item.Id,SortBy:"ProductionYear,SortName",SortOrder:"Descending",Fields:"PrimaryImageAspectRatio,ProductionYear,CanDelete"},query);var apiClient=connectionManager.getApiClient(item);"MusicArtist"===item.Type?query.ContributingArtistIds=item.Id:query.AlbumArtistIds=item.AlbumArtists[0].Id;return apiClient.getItems(apiClient.getCurrentUserId(),query)}.bind(instance),itemsContainer.parentContainer=section,itemsContainer.getListOptions=getMoreFromArtistListOptions,itemsContainer.classList.add("generalItemsContainer")}(this,view,item),function(instance,item,apiClient){var sectionType,section=instance.view.querySelector(".childrenSection");if("Series"===item.Type||"MusicArtist"===item.Type)sectionType="x";else{if("BoxSet"!==item.Type)return section.classList.add("hide");sectionType="y"}var headerText,headerHtml,html="";"x"===sectionType?(html+='<div class="sectionTitleContainer sectionTitleContainer-cards padded-left padded-right">',html+="</div>",html+='<div is="emby-scroller" class="emby-scroller padded-top-focusscale padded-bottom-focusscale" data-mousewheel="false" data-centerfocus="true" data-horizontal="true">',html+='<div is="emby-itemscontainer" class="scrollSlider focuscontainer-x childrenItemsContainer generalItemsContainer itemsContainer padded-left padded-right focusable"></div>',html+="</div>"):"y"===sectionType&&(html+='<h2 class="sectionTitle sectionTitle-cards padded-left padded-right"></h2>',html+='<div is="emby-itemscontainer" class="itemsContainer vertical-wrap childrenItemsContainer generalItemsContainer focuscontainer-x padded-left padded-right"></div>');{var focusableType;section.innerHTML=html,"x"===sectionType&&(focusableType="Series"===item.Type?"autofocus":"nearest",setScopedFocus(instance.view,section.querySelector(".focusable"),!0,focusableType))}var childrenItemsContainer=section.querySelector(".itemsContainer");{var href;childrenItemsContainer.parentContainer=section,"Series"===item.Type?(headerText=section.querySelector(".sectionTitleContainer"),headerHtml='<h2 class="sectionTitle sectionTitle-cards">',headerHtml+=globalize.translate("Seasons"),headerHtml+="</h2>",headerText.innerHTML=headerHtml,headerText.classList.remove("hide"),childrenItemsContainer.fetchData=function(serverId,itemId){return function(){var apiClient=connectionManager.getApiClient(serverId);return apiClient.getSeasons(itemId,{UserId:apiClient.getCurrentUserId(),Fields:"PrimaryImageAspectRatio,BasicSyncInfo,CanDelete,ProductionYear",EnableTotalRecordCount:!1})}}(apiClient.serverId(),item.Id),childrenItemsContainer.getListOptions=getSeriesChildrenListOptions):"MusicArtist"===item.Type?(headerText=section.querySelector(".sectionTitleContainer"),href=appRouter.getRouteUrl("list",{serverId:apiClient.serverId(),itemTypes:"MusicAlbum",albumArtistId:item.Id}),headerHtml='<a is="emby-sectiontitle" href="'+href+'" class="button-link sectionTitleTextButton">',headerHtml+='<h2 class="sectionTitle sectionTitle-cards">',headerHtml+=globalize.translate("Albums"),headerHtml+="</h2>",headerHtml+="</a>",headerText.innerHTML=headerHtml,headerText.classList.remove("hide"),childrenItemsContainer.setAttribute("data-virtualscrolllayout","horizontal-grid"),childrenItemsContainer.fetchData=function(serverId,itemId){return function(query){var apiClient=connectionManager.getApiClient(serverId);return(query=Object.assign({IncludeItemTypes:"MusicAlbum",Recursive:!0,SortBy:"ProductionYear,SortName",SortOrder:"Descending,Ascending",ImageTypeLimit:1,Fields:"PrimaryImageAspectRatio,ProductionYear,CanDelete"},query)).AlbumArtistIds=itemId,apiClient.getItems(apiClient.getCurrentUserId(),query)}}(apiClient.serverId(),item.Id),childrenItemsContainer.getListOptions=getMusicArtistChildrenListOptions):"BoxSet"===item.Type&&((headerText=section.querySelector("h2")).innerHTML=globalize.translate("Items"),headerText.classList.remove("hide"),childrenItemsContainer.fetchData=function(serverId,itemId){return function(){var apiClient=connectionManager.getApiClient(serverId);return apiClient.getItems(apiClient.getCurrentUserId(),{ParentId:itemId,ImageTypeLimit:1,Fields:"PrimaryImageAspectRatio,ProductionYear,CanDelete",EnableTotalRecordCount:!1}).then(function(result){for(var i=0,length=result.Items.length;i<length;i++)result.Items[i].CollectionId=itemId;return result})}}(apiClient.serverId(),item.Id),childrenItemsContainer.getListOptions=function(id){return function(items){return{renderer:cardBuilder,options:{shape:"auto",scalable:!0,centerText:!0,fields:["Name","ProductionYear"],overlayText:!1,collectionId:id},virtualScrollLayout:"vertical-grid"}}}(item.Id),childrenItemsContainer.setAttribute("data-monitor","CollectionItems"),childrenItemsContainer.monitorCollectionId=item.Id)}}(this,item,apiClient),function(view,item,apiClient){if("MusicArtist"!==item.Type)return;var headerText=view.querySelector(".artistSongsItemsHeader"),href=appRouter.getRouteUrl("list",{serverId:apiClient.serverId(),itemTypes:"Audio",artistId:item.Id}),headerHtml="";headerHtml='<a is="emby-sectiontitle" href="'+href+'" class="button-link sectionTitleTextButton">',headerHtml+='<h2 class="sectionTitle sectionTitle-cards">',headerHtml+=globalize.translate("Songs"),headerHtml+="</h2>",headerHtml+="</a>",headerText.innerHTML=headerHtml;var artistSongsItemsContainer=view.querySelector(".artistSongsItemsContainer");artistSongsItemsContainer.classList.add("generalItemsContainer"),artistSongsItemsContainer.fetchData=function(serverId,itemId){return function(query){var apiClient=connectionManager.getApiClient(serverId);return apiClient.getItems(apiClient.getCurrentUserId(),Object.assign({Recursive:!0,IncludeItemTypes:"Audio",ArtistIds:itemId,SortBy:"PlayCount,SortName",SortOrder:"Descending,Ascending",ImageTypeLimit:1,Fields:"PrimaryImageAspectRatio,CanDelete"},query))}}(apiClient.serverId(),item.Id),artistSongsItemsContainer.getListOptions=getArtistSongsListOptions,artistSongsItemsContainer.parentContainer=artistSongsItemsContainer.closest(".verticalSection"),artistSongsItemsContainer.setAttribute("data-excludecontextcommands","viewartist")}(view,item,apiClient),function(instance,item,apiClient){var trackList=instance.view.querySelector(".trackList");trackList.parentContainer=trackList,"Season"===item.Type?(trackList.fetchData=function(instance,serverId,seriesId,seasonId){return function(query){var apiClient=connectionManager.getApiClient(serverId);return apiClient.getEpisodes(seriesId,Object.assign({SeasonId:seasonId,ImageTypeLimit:1,UserId:apiClient.getCurrentUserId(),Fields:"Overview,PrimaryImageAspectRatio"},query)).then(function(result){return instance.seasonItems=result.Items,result})}}(instance,apiClient.serverId(),item.SeriesId,item.Id),trackList.getListOptions=function(item){return function(){return{renderer:listView,options:{showIndexNumber:"MusicAlbum"===item.Type,enableOverview:!0,imageSize:"large",enableSideMediaInfo:!1,highlight:!1,action:layoutManager.tv?null:"none",infoButton:!layoutManager.tv,imagePlayButton:!layoutManager.tv,includeParentInfoInTitle:!1,enableSpecialEpisodePrefix:0!==item.IndexNumber,itemClass:"detailsListItem"},virtualScrollLayout:"vertical-list"}}}(item),trackList.setAttribute("data-virtualscrolllayout","vertical-grid"),trackList.classList.add("padded-bottom-page")):"MusicAlbum"===item.Type?(trackList.fetchData=function(serverId,itemId){return function(query){var apiClient=connectionManager.getApiClient(serverId);return apiClient.getItems(apiClient.getCurrentUserId(),Object.assign({ParentId:itemId,Fields:"PrimaryImageAspectRatio,CanDelete",ImageTypeLimit:1,SortBy:null,EnableTotalRecordCount:!1}))}}(apiClient.serverId(),item.Id),trackList.getListOptions=getPlaylistListOptionsFn(item),trackList.setAttribute("data-excludecontextcommands","viewalbum"),trackList.classList.add("generalItemsContainer")):"Playlist"===item.Type&&(trackList.fetchData=function(serverId,itemId){return function(query){var apiClient=connectionManager.getApiClient(serverId);return apiClient.getItems(apiClient.getCurrentUserId(),Object.assign({ParentId:itemId,Fields:"PrimaryImageAspectRatio",ImageTypeLimit:1},query)).then(function(result){for(var i=0,length=result.Items.length;i<length;i++)result.Items[i].PlaylistId=itemId;return result})}}(apiClient.serverId(),item.Id),trackList.getListOptions=getPlaylistListOptionsFn(item),trackList.setAttribute("data-monitor","PlaylistItems"),trackList.monitorPlaylistId=item.Id,trackList.setAttribute("data-virtualscrolllayout","vertical-grid"),trackList.classList.add("padded-bottom-page"),trackList.classList.add("generalItemsContainer"));"Season"!==item.Type&&(layoutManager.tv||"Playlist"!==item.Type&&"MusicAlbum"!==item.Type)?trackList.classList.remove("tracklist-topmargin"):trackList.classList.add("tracklist-topmargin")}(this,item,apiClient),function(view,item,apiClient){if(!itemHelper.supportsAddingToCollection(item)&&!itemHelper.supportsAddingToPlaylist(item))return;var appearsOnListsItemsContainer=view.querySelector(".appearsOnListsItemsContainer");appearsOnListsItemsContainer.fetchData=function(serverId,itemId){return function(query){var apiClient=connectionManager.getApiClient(serverId);return query=Object.assign({fields:"PrimaryImageAspectRatio,UserData,CanDelete",IncludeItemTypes:"Playlist,BoxSet",Recursive:!0,SortBy:"SortName",ListItemIds:itemId},query),apiClient.getItems(apiClient.getCurrentUserId(),query)}}(apiClient.serverId(),item.Id),appearsOnListsItemsContainer.getListOptions=getAppearsOnListsListOptions,appearsOnListsItemsContainer.parentContainer=appearsOnListsItemsContainer.closest(".verticalSection"),appearsOnListsItemsContainer.classList.add("generalItemsContainer")}(view,item,apiClient),function(instance,view){var peopleItemsContainer=view.querySelector(".peopleItemsContainer");peopleItemsContainer.fetchData=function(instance){return function(query){var serverId=instance.currentItem.ServerId,people=(instance.currentItem.People||[]).filter(function(p){return p.ServerId=serverId,"Person"!==p.Type&&(p.PersonType=p.Type,p.Type="Person"),!0}),totalRecordCount=people.length;return query&&(people=people.slice(query.StartIndex||0),query.Limit&&people.length>query.Limit&&(people.length=query.Limit)),Promise.resolve({Items:people,TotalRecordCount:totalRecordCount})}}(instance),peopleItemsContainer.parentContainer=peopleItemsContainer.closest(".verticalSection"),peopleItemsContainer.getListOptions=getPeopleListOptions,peopleItemsContainer.classList.add("generalItemsContainer")}(this,view),function(view,item,apiClient){if(!itemHelper.supportsSimilarItems(item))return;var itemsContainer=view.querySelector(".similarItemsContainer");itemsContainer.fetchData=function(item,serverId){return function(){var apiClient=connectionManager.getApiClient(serverId),options={Limit:12,UserId:apiClient.getCurrentUserId(),ImageTypeLimit:1,Fields:"PrimaryImageAspectRatio,UserData,CanDelete,ProductionYear",EnableTotalRecordCount:!1};return"Program"!==item.Type||item.IsSports||(options.GroupProgramsBySeries=!0),"MusicAlbum"===item.Type&&item.AlbumArtists&&item.AlbumArtists.length&&(options.ExcludeArtistIds=item.AlbumArtists[0].Id),apiClient.getSimilarItems(item.Id,options)}}(item,apiClient.serverId()),itemsContainer.parentContainer=itemsContainer.closest(".verticalSection"),itemsContainer.getListOptions=function(item){return function(items){var fields=["Name"];return"Movie"!==item.Type&&"Trailer"!==item.Type&&"Program"!==item.Type&&"Game"!==item.Type||fields.push("ProductionYear"),{renderer:cardBuilder,options:{shape:"auto",showParentTitle:"MusicAlbum"===item.Type||"Game"===item.Type||"Program"===item.Type,lines:"Game"===item.Type?3:"Program"===item.Type?2:null,centerText:!0,fields:fields,overlayPlayButton:!0,overlayText:!1,multiSelect:"Program"!==item.Type,contextMenu:"Program"!==item.Type,draggable:"Program"!==item.Type},virtualScrollLayout:"horizontal-grid"}}}(item),itemsContainer.classList.add("generalItemsContainer")}(view,item,apiClient),function(view,item,apiClient){if(!itemHelper.supportsSimilarItemsOnLiveTV(item,apiClient))return;var itemsContainer=view.querySelector(".similarOnLiveTVItemsContainer");itemsContainer.fetchData=function(itemId,serverId){return function(){var apiClient=connectionManager.getApiClient(serverId);return apiClient.getSimilarItems(itemId,{userId:apiClient.getCurrentUserId(),limit:12,fields:"PrimaryImageAspectRatio,UserData,CanDelete,ProductionYear",IncludeItemTypes:"Program",EnableTotalRecordCount:!1,GroupProgramsBySeries:!0})}}(item.Id,apiClient.serverId()),itemsContainer.parentContainer=itemsContainer.closest(".verticalSection"),itemsContainer.getListOptions=getMoreLikeThisOnLiveTVListOptions,itemsContainer.classList.add("generalItemsContainer")}(view,item,apiClient),function(instance,view,item){if("Series"!==item.Type&&"Program"!==item.Type)return;var itemsContainer=view.querySelector(".seriesScheduleItemsContainer");itemsContainer.fetchData=function(query){var item=this.currentItem,apiClient=connectionManager.getApiClient(item);if(query=Object.assign({UserId:apiClient.getCurrentUserId(),HasAired:!1,SortBy:"StartDate",ImageTypeLimit:1,EnableImageTypes:"Primary,Thumb,Backdrop",EnableUserData:!1,Fields:"PrimaryImageAspectRatio,ChannelInfo"},query),"Program"===item.Type)if(item.AsSeries)query.SeriesFromProgramId=item.Id;else{if(!apiClient.isMinServerVersion("4.6.0.38"))return Promise.resolve({Items:[],TotalRecordCount:0});query.ShowingsFromProgramId=item.Id,query.ExcludeItemIds=item.Id}else query.LibrarySeriesId=item.Id;return apiClient.getLiveTvPrograms(query)}.bind(instance),itemsContainer.parentContainer=itemsContainer.closest(".verticalSection"),itemsContainer.getListOptions=function(items){return{renderer:cardBuilder,options:{preferThumb:"auto",shape:"autooverflow",showParentTitle:!1,fields:["Name","ChannelName"],centerText:!0,overlayText:!1,overlayPlayButton:!1,showAirTime:!0,showAirDateTime:!0,multiSelect:!1,draggable:!1},virtualScrollLayout:"horizontal-grid"}}.bind(instance),itemsContainer.classList.add("generalItemsContainer"),"Program"===item.Type&&(item.AsSeries?itemsContainer.parentContainer.querySelector(".sectionTitle").innerHTML=globalize.translate("Showings"):itemsContainer.parentContainer.querySelector(".sectionTitle").innerHTML=globalize.translate("HeaderOtherShowings"))}(this,view,item),function(instance,view,item){if(!itemHelper.supportsExtras(item))return;var itemsContainer=view.querySelector(".extrasItemsContainer");itemsContainer.fetchData=function(query){var item=this.currentItem,apiClient=connectionManager.getApiClient(item);return apiClient.getSpecialFeatures(apiClient.getCurrentUserId(),item.Id).then(function(items){var totalRecordCount=items.length;return query&&(items=items.slice(query.StartIndex||0),query.Limit&&items.length>query.Limit&&(items.length=query.Limit)),{Items:items,TotalRecordCount:totalRecordCount}})}.bind(instance),itemsContainer.parentContainer=itemsContainer.closest(".verticalSection"),itemsContainer.getListOptions=getExtrasListOptions,itemsContainer.classList.add("generalItemsContainer")}(this,view,item),function(instance,view){var itemsContainer=view.querySelector(".chaptersItemsContainer");itemsContainer.fetchData=function(query){var item=this.currentItem,chapters=item.Chapters||[];chapters.length&&!chapters[0].ImageTag&&(chapters=[]);var videoStream=(((item.MediaSources||[])[0]||{}).MediaStreams||[]).filter(function(i){return"Video"===i.Type})[0]||{},aspect=null;videoStream.Width&&videoStream.Height&&(aspect=videoStream.Width/videoStream.Height);for(var i=0,length=chapters.length;i<length;i++){var chapter=chapters[i];chapter.Id=item.Id,chapter.Type=item.Type,chapter.ServerId=item.ServerId,chapter.MediaType=item.MediaType,chapter.PrimaryImageAspectRatio=aspect,chapter.ChapterIndex=i}var totalItems=chapters.length;query&&(chapters=chapters.slice(query.StartIndex||0),query.Limit&&chapters.length>query.Limit&&(chapters.length=query.Limit));return Promise.resolve({Items:chapters,TotalRecordCount:totalItems})}.bind(instance),itemsContainer.parentContainer=itemsContainer.closest(".verticalSection"),itemsContainer.getListOptions=getChaptersListOptions,itemsContainer.classList.add("generalItemsContainer")}(this,view),function(instance,view){var itemsContainer=view.querySelector(".additionalPartsItemsContainer");itemsContainer.fetchData=function(){var item=this.currentItem;if(!item.PartCount)return Promise.resolve({TotalRecordCount:0,Items:[]});var apiClient=connectionManager.getApiClient(item);return apiClient.getAdditionalVideoParts(apiClient.getCurrentUserId(),item.Id)}.bind(instance),itemsContainer.parentContainer=itemsContainer.closest(".verticalSection"),itemsContainer.getListOptions=getAdditionalPartsListOptions,itemsContainer.classList.add("generalItemsContainer")}(this,view),function(instance,view,item){if("TvChannel"!==item.Type)return;var itemsContainer=view.querySelector(".programGuideItemsContainer");itemsContainer.fetchData=function(query){var item=this.currentItem,apiClient=connectionManager.getApiClient(item);return apiClient.getLiveTvPrograms(Object.assign({ChannelIds:item.Id,UserId:apiClient.getCurrentUserId(),HasAired:!1,SortBy:"StartDate",ImageTypeLimit:1,EnableUserData:!1,Fields:"PrimaryImageAspectRatio,Overview"},query))}.bind(instance),itemsContainer.parentContainer=itemsContainer.closest(".programGuideSection"),itemsContainer.getListOptions=getProgramGuideListOptions,itemsContainer.classList.add("generalItemsContainer")}(this,view,item),function(instance,view,item){if("SeriesTimer"!==item.Type)return;var itemsContainer=view.querySelector(".seriesTimerScheduleItemsContainer");itemsContainer.fetchData=function(){var item=this.currentItem,apiClient=connectionManager.getApiClient(item);return apiClient.getLiveTvTimers({UserId:apiClient.getCurrentUserId(),ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb",SortBy:"StartDate",EnableTotalRecordCount:!1,EnableUserData:!1,SeriesTimerId:item.Id,Fields:"ChannelInfo,ChannelImage"})}.bind(instance),itemsContainer.parentContainer=itemsContainer.closest(".verticalSection"),itemsContainer.getListOptions=getSeriesTimerListOptions,itemsContainer.classList.add("generalItemsContainer")}(this,view,item),function(instance,view,item){var itemsContainer=function(view,item){var sideImageContainer=view.querySelector(".detailImageContainer-side"),mainImageContainer=view.querySelector(".detailImageContainer-main");return enableTrackList(item)?(mainImageContainer.classList.add("hide"),sideImageContainer.classList.remove("hide"),sideImageContainer):(mainImageContainer.classList.remove("hide"),sideImageContainer.classList.add("hide"),mainImageContainer)}(view,item),detailImage=itemsContainer;enableTrackList(item)||"Person"!==item.Type&&"BoxSet"!==item.Type&&"Season"!==item.Type&&"TvChannel"!==item.Type&&"Playlist"!==item.Type||detailImage.classList.add("detailImageContainer-small");var detailImageContainerMain=view.querySelector(".detailImageContainer-main");layoutManager.tv?detailImageContainerMain.classList.add("detailImageContainer-main-tv"):detailImageContainerMain.classList.remove("detailImageContainer-main-tv");enableItemBackdropAsTopImage(item)?detailImageContainerMain.classList.add("detailImageContainer-hidemobile"):detailImageContainerMain.classList.remove("detailImageContainer-hidemobile");var shape=imageLoader.getShape([item],{});detailImage.classList.remove("detailImageContainer-backdrop","detailImageContainer-square","detailImageContainer-portrait","detailImageContainer-fourThree","detailImageContainer-banner"),shape&&detailImage.classList.add("detailImageContainer-"+shape);"TvChannel"===item.Type||"Season"===item.Type||"MusicAlbum"===item.Type||"Playlist"===item.Type?detailImage.classList.add("detailImage-nomarginleft"):detailImage.classList.remove("detailImage-nomarginleft");itemsContainer.fetchData=function(){var item=this.currentItem,items=[];item&&items.push(item);return Promise.resolve({Items:items,TotalRecordCount:items.length})}.bind(instance),itemsContainer.parentContainer=itemsContainer.closest(".verticalSection"),itemsContainer.getListOptions=function(cardClass,imageContainerClassName){(imageContainerClassName=imageContainerClassName.split(" ").filter(function(c){return c.includes("detailImage")}).join(" ")).includes("detailImageContainer-side")&&(imageContainerClassName+=" item-fixed-side");return imageContainerClassName+=" imageWidthTest",function(items){return{renderer:cardBuilder,options:{overlayText:!0,fields:[],action:"none",imageClass:"detailImage",imageWidthTestClass:imageContainerClassName,multiSelect:!1,contextMenu:!1,ratingButton:!1,playedButton:!1,cardClass:cardClass,defaultIcon:!0,typeIndicator:!1,playedIndicator:!1,syncIndicator:!1,timerIndicator:!1,randomDefaultBackground:!1,staticElement:!0,progress:!1,enableUserData:!1,moreButton:!1},virtualScrollLayout:"vertical-grid"}}}((item.Type,"detailImageContainerCard"),detailImage.className),itemsContainer.afterRefresh=afterDetailImageRefreshed,itemsContainer.classList.add("generalItemsContainer")}(this,view,item));var additionalContentSection=view.querySelector(".details-additionalContent");"TvChannel"===item.Type||"Playlist"===item.Type||"Season"===item.Type?additionalContentSection.classList.remove("padded-bottom-page"):additionalContentSection.classList.add("padded-bottom-page"),backdrop.hasBackdrop()?(additionalContentSection.classList.add("details-additionalContent-withbackdrop"),this.topDetailsContainer.classList.add("topDetailsContainer-withbackdrop")):(additionalContentSection.classList.remove("details-additionalContent-withbackdrop"),this.topDetailsContainer.classList.remove("topDetailsContainer-withbackdrop")),hasAnimatedTransition?additionalContentSection.classList.add("details-additionalContent-fadein"):additionalContentSection.classList.remove("hide"),enableTrackList(item)?"Season"===item.Type?setTitle(item,apiClient):layoutManager.tv?setTitle(item,apiClient,layoutManager.tv):(renderLogo(view,item,apiClient),setTitle(item,apiClient)):(renderLogo(view,item,apiClient),setTitle(item,apiClient));var topDetailsMain=view.querySelector(".topDetailsMain"),itemSideContainer=view.querySelector(".item-fixed-side"),mainDetailButtons=view.querySelector(".mainDetailButtons"),detailMainContainer=this.mainSection;enableTrackList(item)?("MusicAlbum"===item.Type?detailMainContainer.classList.add("detailMainContainer-marginleft"):detailMainContainer.classList.remove("detailMainContainer-marginleft"),topDetailsMain.classList.remove("topDetailsMain-graphic"),detailMainContainer.classList.remove("detailMainContainer-moveup"),detailMainContainer.classList.remove("detailMainContainer-vertical"),itemSideContainer.classList.remove("hide"),layoutManager.tv&&"Season"!==item.Type?topDetailsMain.classList.add("padded-left","padded-right"):topDetailsMain.classList.remove("padded-left","padded-right")):(detailMainContainer.classList.remove("detailMainContainer-marginleft"),enableItemBackdropAsTopImage(item)?(detailMainContainer.classList.add("detailMainContainer-moveup"),detailMainContainer.classList.remove("detailMainContainer-vertical")):(detailMainContainer.classList.remove("detailMainContainer-moveup"),detailMainContainer.classList.add("detailMainContainer-vertical")),layoutManager.tv&&("Series"===item.Type||"Video"===item.MediaType||"Game"===item.MediaType)&&(item.BackdropImageTags&&item.BackdropImageTags.length||item.ParentBackdropImageTags&&item.ParentBackdropImageTags.length)?topDetailsMain.classList.add("topDetailsMain-graphic"):topDetailsMain.classList.remove("topDetailsMain-graphic"),itemSideContainer.classList.add("hide"),topDetailsMain.classList.remove("padded-left"),topDetailsMain.classList.remove("padded-right"),function(elem){for(var btns=elem.querySelectorAll(".detailButton"),i=0,length=btns.length;i<length;i++){var btn=btns[i];if(focusManager.isCurrentlyFocusable(btn))return setScopedFocus(null,elem,!0)}setScopedFocus(null,elem,!1)}(mainDetailButtons));var promises=[];return function(instance,item,user,containers){var parentRoute,context=inferContext(item),parentNameHtml=[],parentNameLast=!1,hasButton=!1;item.AlbumArtists?(parentNameHtml.push(getArtistLinksHtml(item.AlbumArtists,item.ServerId)),parentNameLast=!0):item.ArtistItems&&item.ArtistItems.length&&"MusicVideo"===item.Type?(parentNameHtml.push(getArtistLinksHtml(item.ArtistItems,item.ServerId)),parentNameLast=!0):item.SeriesName&&item.SeriesId?(parentRoute=appRouter.getRouteUrl({Id:item.SeriesId,Name:item.SeriesName,Type:"Series",IsFolder:!0,ServerId:item.ServerId},{context:context}),hasButton=!0,parentNameHtml.push('<a style="color:inherit;font-weight:inherit;" class="button-link" is="emby-linkbutton" href="'+parentRoute+'">'+textEncoding.htmlEncode(item.SeriesName)+"</a>")):item.SeriesName?parentNameHtml.push(textEncoding.htmlEncode(item.SeriesName)):(item.IsSeries||item.EpisodeTitle)&&parentNameHtml.push(textEncoding.htmlEncode(item.Name)),item.SeasonId&&item.SeasonName?(parentRoute=appRouter.getRouteUrl({Id:item.SeasonId,Name:item.SeasonName,Type:"Season",IsFolder:!0,ServerId:item.ServerId},{context:context}),hasButton=!0,parentNameHtml.push('<a style="color:inherit;font-weight:inherit;" class="button-link" is="emby-linkbutton" href="'+parentRoute+'">'+textEncoding.htmlEncode(item.SeasonName)+"</a>")):item.SeasonName?parentNameHtml.push(textEncoding.htmlEncode(item.SeasonName)):item.Album&&item.AlbumId&&("MusicVideo"===item.Type||"Audio"===item.Type)?(parentRoute=appRouter.getRouteUrl({Id:item.AlbumId,Name:item.Album,Type:"MusicAlbum",IsFolder:!0,ServerId:item.ServerId},{context:context}),hasButton=!0,parentNameHtml.push('<a style="color:inherit;font-weight:inherit;" class="button-link" is="emby-linkbutton" href="'+parentRoute+'">'+textEncoding.htmlEncode(item.Album)+"</a>")):item.Album&&parentNameHtml.push(textEncoding.htmlEncode(item.Album));var html="",editorButtonsHtml="";layoutManager.tv||(itemHelper.canEdit(user,item)&&(hasButton=!0,editorButtonsHtml+='<button is="paper-icon-button-light" class="btnDetailEdit btnEditMetadata secondaryText flex-shrink-zero" title="'+globalize.translate("HeaderEditMetadata")+'" aria-label="'+globalize.translate("HeaderEditMetadata")+'"><i class="md-icon">edit</i></button>'),itemHelper.canEditImages(user,item)&&(hasButton=!0,editorButtonsHtml+='<button is="paper-icon-button-light" class="btnDetailEdit btnEditImages secondaryText flex-shrink-zero" title="'+globalize.translate("HeaderEditImages")+'" aria-label="'+globalize.translate("HeaderEditImages")+'"><i class="md-icon">photo</i></button>'));var itemPrimaryNameContainerClass="itemPrimaryNameContainer";enableItemBackdropAsTopImage(item)||(itemPrimaryNameContainerClass+=" itemPrimaryNameContainer-centered"),parentNameHtml.length&&(html=parentNameLast?'<div class="itemSecondaryNameContainer"><h3 class="itemName-secondary">'+parentNameHtml.join(" - ")+"</h3></div>":'<div class="'+itemPrimaryNameContainerClass+'"><h1 class="itemName-primary">'+parentNameHtml.join(" - ")+"</h1></div>");var name=itemHelper.getDisplayName(item,{includeParentInfo:!1});html&&name&&!parentNameLast?html+='<div class="flex align-items-center flex-wrap-wrap itemSecondaryNameContainer"><h3 class="itemName-secondary">'+name+"</h3>"+editorButtonsHtml+"</div>":html=parentNameLast?'<div class="flex align-items-center flex-wrap-wrap '+itemPrimaryNameContainerClass+'"><h1 class="itemNameBeforeParentName itemName-primary">'+name+"</h1>"+editorButtonsHtml+"</div>"+html:'<div class="flex align-items-center flex-wrap-wrap '+itemPrimaryNameContainerClass+'"><h1 class="itemName-primary">'+name+"</h1>"+editorButtonsHtml+"</div>"+html;for(var i=0,length=containers.length;i<length;i++){var container=containers[i];enableItemBackdropAsTopImage(item)?container.classList.remove("nameContainer-centered"):container.classList.add("nameContainer-centered"),container.innerHTML=html,setScopedFocus(null,container,hasButton,"nearest"),html.length?container.classList.remove("hide"):container.classList.add("hide");var btnEditMetadata=container.querySelector(".btnEditMetadata");btnEditMetadata&&btnEditMetadata.addEventListener("click",onEditMetadataClick.bind(instance));var btnEditImages=container.querySelector(".btnEditImages");btnEditImages&&btnEditImages.addEventListener("click",onEditImagesClick.bind(instance))}}(this,item,user,view.querySelectorAll(".nameContainer")),function(view,item,apiClient){var imgUrl,usePrimaryImage,screenWidth=screen.availWidth,itemBackdropElement=view.querySelector(".itemBackdrop");enableItemBackdropAsTopImage(item)?(itemBackdropElement.classList.remove("hide"),usePrimaryImage="Video"===item.MediaType&&"Movie"!==item.Type&&"Trailer"!==item.Type||item.MediaType&&"Video"!==item.MediaType||"MusicAlbum"===item.Type||"Playlist"===item.Type,"Program"===item.Type&&item.ImageTags&&item.ImageTags.Thumb?imgUrl=apiClient.getImageUrl(item.Id,{type:"Thumb",index:0,maxWidth:screenWidth,tag:item.ImageTags.Thumb}):usePrimaryImage&&item.ImageTags&&item.ImageTags.Primary?imgUrl=apiClient.getImageUrl(item.Id,{type:"Primary",index:0,maxWidth:screenWidth,tag:item.ImageTags.Primary}):item.BackdropImageTags&&item.BackdropImageTags.length?imgUrl=apiClient.getImageUrl(item.Id,{type:"Backdrop",index:0,maxWidth:screenWidth,tag:item.BackdropImageTags[0]}):item.ParentBackdropItemId&&item.ParentBackdropImageTags&&item.ParentBackdropImageTags.length?imgUrl=apiClient.getImageUrl(item.ParentBackdropItemId,{type:"Backdrop",index:0,tag:item.ParentBackdropImageTags[0],maxWidth:screenWidth}):item.ImageTags&&item.ImageTags.Thumb?imgUrl=apiClient.getImageUrl(item.Id,{type:"Thumb",index:0,maxWidth:screenWidth,tag:item.ImageTags.Thumb}):item.ImageTags&&item.ImageTags.Primary&&(imgUrl=apiClient.getImageUrl(item.Id,{type:"Primary",index:0,maxWidth:screenWidth,tag:item.ImageTags.Primary})),"TvChannel"===item.Type&&itemBackdropElement.classList.add("itemBackdrop-small"),"TvChannel"!==item.Type&&enableItemBackdropAsTopImage(item)&&view.querySelector(".itemMainScrollSlider").classList.add("itemMainScrollSlider-nopaddingtop"),"TvChannel"!==item.Type&&"Person"!==item.Type||itemBackdropElement.classList.add("itemBackdrop-contain"),itemBackdropElement.style.backgroundImage=imgUrl?"url('"+imgUrl+"')":""):itemBackdropElement.classList.add("hide")}(view,item,apiClient),renderTrackSelections(view,this,item,user,!0,mediaSources),promises.push(renderDetails(this,view,item,0,user)),function(view,user,item){if(appHost.supports("sync"))for(var canSync=itemHelper.canSync(user,item),buttons=view.querySelectorAll(".btnSyncDownload"),i=0,length=buttons.length;i<length;i++)buttons[i].setItem(item),canSync?buttons[i].classList.remove("hide"):buttons[i].classList.add("hide")}(view,user,item),Promise.all(promises).then(function(){return[item,user]})}function getItemWithMediaSource(instance,apiClient){return function(instance,apiClient){var params=instance.params;if(params.seriesTimerId)return apiClient.getLiveTvSeriesTimer(params.seriesTimerId);var options={};return"true"===params.asSeries&&(options.AsSeries=!0),apiClient.getItem(apiClient.getCurrentUserId(),params.id,options)}(instance,apiClient).then(function(item){var playbackMediaSourcesPromise=isRenderingTrackSelections(item)?playbackManager.getPlaybackMediaSources(item):Promise.resolve([]);return playbackMediaSourcesPromise.then(function(mediaSources){return{item:item,mediaSources:mediaSources}})})}function startDataLoad(instance){var params=instance.params,apiClient=connectionManager.getApiClient(params.serverId);instance.dataPromise=Promise.all([getItemWithMediaSource(instance,apiClient),apiClient.getCurrentUser()]).then(onDataFetched.bind(instance))}function playCurrentItem(instance,mode){var item,playOptions;MultiSelect.canPlay()?MultiSelect.play():(item=instance.currentItem,(playOptions=function(view,startPositionTicks){var audioStreamIndex=view.querySelector(".selectAudio").value||null;return{startPositionTicks:startPositionTicks,mediaSourceId:view.querySelector(".selectSource").value,audioStreamIndex:audioStreamIndex,subtitleStreamIndex:view.querySelector(".selectSubtitles").value}}(instance.view,item.UserData&&"resume"===mode?null:0)).items=[item],playbackManager.play(playOptions))}function onPlayClick(e){playCurrentItem(this,e.currentTarget.getAttribute("data-mode"))}function onQueueClick(){var text,currentItem=this.currentItem;playbackManager.queue({items:[currentItem]}),text={text:globalize.translate("HeaderAddedToPlayQueue"),icon:"playlist_add"},require(["toast"],function(toast){toast(text)})}function onEdited(){reloadItem(this,!0)}function onEditCancel(){}function onEditMetadataClick(){var currentItem=this.currentItem,instance=this;require(["metadataEditor"]).then(function(responses){return responses[0].show(currentItem.Id,currentItem.ServerId).then(onEdited.bind(instance),onEditCancel)})}function onEditImagesClick(){var currentItem=this.currentItem,instance=this;require(["imageEditor"],function(imageEditor){imageEditor.show({itemId:currentItem.Id,serverId:currentItem.ServerId}).then(onEdited.bind(instance),onEditCancel)})}function onDeleteClick(){var currentItem=this.currentItem;require(["deleteHelper"],function(deleteHelper){deleteHelper.deleteItem({item:currentItem,navigate:"back"})})}function onDownloadChange(){reloadItem(this,!0)}function onReadMoreClick(e){var options,overviewTextElem=e.currentTarget.closest(".overview-container").querySelector(".overview-text");options={html:overviewTextElem.innerHTML,confirmButton:!1,title:globalize.translate(itemHelper.getDisplayName(this.currentItem)),centerText:!1},require(["alert"]).then(function(responses){responses[0](options)})}function onSplitVersionsClick(){var params=this.params,apiClient=connectionManager.getApiClient(params.serverId);!function(instance,apiClient,params){require(["confirm"],function(confirm){confirm("Are you sure you wish to split the media sources into separate items?","Split Media Apart").then(function(){loading.show(),apiClient.ajax({type:"DELETE",url:apiClient.getUrl("Videos/"+params.id+"/AlternateSources")}).then(function(){loading.hide(),reloadItem(instance,!0)})})})}(this,(this.view,apiClient),params)}function onPromiseRejected(){}function getSeriesChildrenListOptions(items){return{renderer:cardBuilder,options:{shape:"auto",scalable:!0,centerText:!0,fields:["Name"],overlayText:!1},virtualScrollLayout:"horizontal-grid"}}function getMusicArtistChildrenListOptions(items){return{renderer:cardBuilder,options:{shape:"auto",scalable:!0,centerText:!0,fields:["Name","ProductionYear"],overlayText:!1},virtualScrollLayout:"horizontal-grid"}}function getPlaylistListOptionsFn(item){return function(){return{renderer:listView,options:{showIndexNumberLeft:"MusicAlbum"===item.Type,action:"playallfromhere",dragHandle:"Playlist"===item.Type&&!layoutManager.tv,playlistId:"Playlist"===item.Type?item.Id:null,image:"Playlist"===item.Type,artist:"auto",showIndex:"MusicAlbum"===item.Type,index:"disc",containerAlbumArtists:"MusicAlbum"===item.Type?item.AlbumArtists:null,showParentTitle:"Playlist"===item.Type,playAction:"playallfromhere",itemClass:"detailsListItem"},virtualScrollLayout:"vertical-list"}}}function getAppearsOnListsListOptions(items){return{renderer:cardBuilder,options:{shape:"autooverflow",centerText:!0,fields:["Name"],overlayText:!1},virtualScrollLayout:"horizontal-grid"}}function getArtistSongsListOptions(items){return{renderer:cardBuilder,options:{shape:"auto",lines:2,centerText:!0,fields:["Name","Album"],overlayPlayButton:!0,overlayText:!1,sideFooter:!0,action:"play"},virtualScrollLayout:"horizontal-grid"}}function getPeopleListOptions(items){return{renderer:cardBuilder,options:{cardLayout:!1,centerText:!0,fields:["Name","PersonRole"],cardFooterAside:!1,showPersonRoleOrType:!0,multiSelect:!1,coverImage:!0,shape:"portrait",draggable:!1},virtualScrollLayout:"horizontal-grid"}}function getMoreLikeThisOnLiveTVListOptions(items){return{renderer:cardBuilder,options:{shape:"auto",fields:["Name","ProductionYear"],showParentTitle:!0,centerText:!0,showDetailsMenu:!0,overlayPlayButton:!0,overlayText:!1,lines:2,draggable:!1,multiSelect:!1},virtualScrollLayout:"horizontal-grid"}}function getNextUpItems(query){var item=this.currentItem,apiClient=connectionManager.getApiClient(item);return query=Object.assign({SeriesId:item.Id,Fields:"PrimaryImageAspectRatio,CanDelete",ImageTypeLimit:1,UserId:apiClient.getCurrentUserId()},query),apiClient.getNextUpEpisodes(query)}function getNextUpListOptions(items){return{renderer:cardBuilder,options:{shape:"autooverflow",fields:["Name"],overlayText:!1,centerText:!0,scalable:!0},virtualScrollLayout:"horizontal-grid"}}function getAdditionalPartsListOptions(items){return{renderer:cardBuilder,options:{shape:"autooverflow",scalable:!0,fields:["Name"],action:"playallfromhere",centerText:!0,overlayText:!1,showRuntime:!0,draggable:!1},virtualScrollLayout:"horizontal-grid"}}function getExtrasListOptions(items){return{renderer:cardBuilder,options:{shape:"autooverflow",scalable:!0,fields:["Name"],action:"playallfromhere",centerText:!0,overlayText:!1,showRuntime:!0,draggable:!1},virtualScrollLayout:"horizontal-grid"}}function getProgramGuideListOptions(items){return{renderer:listView,options:{enableOverview:!0,imageSize:"large",enableUserDataButtons:!1,showParentTitle:!0,showProgramDateTime:!0,mediaInfo:!0,enableSideMediaInfo:!1,mediaInfoWithTitle:!0,draggable:!1,multiSelect:!1,defaultShape:"portrait",itemClass:"detailsListItem"},virtualScrollLayout:"vertical-grid"}}function getSeriesTimerListOptions(items){return{renderer:listView,options:{enableUserDataButtons:!1,image:!0,imageSource:"channel",showProgramDateTime:!0,showChannel:!1,mediaInfo:!1,action:"none",moreButton:!1,recordButton:!1,draggable:!1,multiSelect:!1,itemClass:"detailsListItem"},virtualScrollLayout:"vertical-grid"}}function afterDetailImageRefreshed(){var detailImageElement=this.querySelector(".detailImage");detailImageElement&&(this.querySelector(".cardImageIcon")?detailImageElement.classList.remove("detailImage-transparent"):detailImageElement.classList.add("detailImage-transparent"))}function getChaptersListOptions(items){return{renderer:cardBuilder,options:{shape:"autooverflow",centerText:!0,overlayText:!1,fields:["Name","ChapterTime"],multiSelect:!1,contextMenu:!1,playedButton:!1,ratingButton:!1,action:"play",enableUserData:!1,draggable:!1},virtualScrollLayout:"horizontal-grid"}}function getMoreFromSeasonListOptions(items){return{renderer:cardBuilder,options:{shape:"auto",scalable:!0,fields:["Name"],overlayText:!1,centerText:!0,includeParentInfoInTitle:!1},virtualScrollLayout:"horizontal-grid"}}function getMoreFromArtistListOptions(items){return{renderer:cardBuilder,options:{shape:"auto",scalable:!0,fields:["Name","ProductionYear"],showParentTitle:!1,centerText:!0,overlayText:!1,overlayPlayButton:!0},virtualScrollLayout:"horizontal-grid"}}function reloadItem(instance,reloadAllData,restartDataLoad){reloadAllData&&!1!==restartDataLoad&&startDataLoad(instance),instance.dataPromise.then(function(responses){var item=responses[0],user=responses[1];item?(function(view,eventName,item){view.dispatchEvent(new CustomEvent(eventName,{detail:{item:item},bubbles:!0,cancelable:!1}))}(instance.view,"itemshow",item),enableItemBackdropAsTopImage(item)?(document.querySelector(".backdropContainer").classList.add("backdropContainer-preventbackdrop"),instance.backgroundContainer.classList.add("itemBackgroundContainer","itemBackgroundContainer-preventbackdrop")):(document.querySelector(".backdropContainer").classList.remove("backdropContainer-preventbackdrop"),instance.backgroundContainer.classList.add("itemBackgroundContainer"),instance.backgroundContainer.classList.remove("itemBackgroundContainer-preventbackdrop"))):instance.backgroundContainer.classList.remove("itemBackgroundContainer","itemBackgroundContainer-preventbackdrop");var trackList,apiClient=connectionManager.getApiClient(item.ServerId),view=instance.view;!function(view,refreshData){for(var containers=view.querySelectorAll(".generalItemsContainer"),i=0,length=containers.length;i<length;i++)containers[i].resume({refresh:refreshData})}(view,reloadAllData),"Season"!==item.Type||(trackList=view.querySelector(".trackList"))&&trackList.resume({refresh:reloadAllData}).then(function(){!function(items,element){var focusItem=items.filter(function(i){return!i.UserData||!i.UserData.Played})[0];if(focusItem=focusItem||items[0]){var index=element.indexOfItemId(focusItem.Id);if(-1!==index)return element.scrollToIndex(index,{},!0),1}}(instance.seasonItems,trackList)&&focusManager.autoFocus(view)}),reloadAllData&&(renderPeopleItems(view,item,apiClient),function(view,item,user,apiClient){if("SeriesTimer"===item.Type){if(!user.Policy.EnableLiveTvManagement)return view.querySelector(".seriesTimerScheduleSection").classList.add("hide"),view.querySelector(".btnCancelSeriesTimer").classList.add("hide");require(["seriesRecordingEditor"],function(seriesRecordingEditor){seriesRecordingEditor.embed(item,apiClient.serverId(),{context:view.querySelector(".seriesRecordingEditor")})}),view.querySelector(".seriesTimerScheduleSection").classList.remove("hide"),view.querySelector(".btnCancelSeriesTimer").classList.remove("hide")}}(view,item,user,apiClient),function(page,item,user){"Recording"===item.Type&&user.Policy.EnableLiveTvManagement&&item.TimerId&&"InProgress"===item.Status?hideAll(page,"btnCancelTimer",!0):hideAll(page,"btnCancelTimer")}(view,item,user),function(page,item){var linksElem=page.querySelector(".linksSection"),links=[];if(item.ExternalUrls&&appHost.supports("externallinks")&&!layoutManager.tv)for(var i=0,length=item.ExternalUrls.length;i<length;i++){var url=item.ExternalUrls[i];links.push('<a is="emby-linkbutton" class="raised item-tag-button nobackdropfilter" href="'+url.Url+'" target="_blank"><i class="md-icon button-icon button-icon-left">link</i>'+textEncoding.htmlEncode(url.Name)+"</a>")}linksElem.querySelector(".itemLinks").innerHTML=links.join(""),links.length?linksElem.classList.remove("hide"):linksElem.classList.add("hide")}(view,item),view.querySelector(".audioVideoMediaInfo").classList.remove("mediainfo-forcehide"),view.querySelector(".details-additionalContent").classList.remove("hide"),focusMainSection.call(instance.mainSection)),loading.hide()})}function addClass(elems,className){for(var i=0,length=elems.length;i<length;i++)elems[i].classList.add(className)}function setScopedFocus(view,query,enabled,type){var elem="string"==typeof query?view.querySelector(query):query;enabled?(elem.classList.add("focusable"),elem.setAttribute("data-focusabletype",type||"autofocus")):(elem.classList.remove("focusable"),elem.removeAttribute("data-focusabletype"))}function updateTrackSelectionsFocusState(instance,view){var elem=instance.trackSelectionsContainer,isEnabled=elem.querySelector("select:not([disabled]):not(.noSelections)");setScopedFocus(view,elem,isEnabled)}function ItemPage(view,params){BaseView.apply(this,arguments),this.params=params,this.playerChangeFn=function(){var view=this.view,item=this.currentItem;view&&item&&renderTrackSelectionsWithoutUser(view,this,item)}.bind(this),this.onInputCommandFn=onInputCommand.bind(this),this.topDetailsContainer=view.querySelector(".topDetailsContainer"),this.backgroundContainer=document.querySelector(".backgroundContainer"),this.mainSection=view.querySelector(".detailMainContainer"),this.trackSelectionsContainer=view.querySelector(".trackSelections"),layoutManager.tv?(view.querySelector(".detailLogo").classList.add("detailLogo-tv"),view.querySelector(".detailLogoContainer").classList.add("detailLogoContainer-tv"),addClass(view.querySelectorAll(".reduce-font-size-tv"),"reduce-font-size")):addClass(view.querySelectorAll(".detailTextContainer"),"details-largefont"),function(view,query,enabled,type){for(var elems=view.querySelectorAll(query),i=0,length=elems.length;i<length;i++)setScopedFocus(view,elems[i],enabled,type)}(view,".focusable",!0,"nearest"),this.trackSelectionsContainer.addEventListener("submit",onTrackSelectionsSubmit),bindAll(view,".btnPlay","click",onPlayClick.bind(this)),bindAll(view,".btnResume","click",onPlayClick.bind(this)),bindAll(view,".btnQueue","click",onQueueClick.bind(this)),bindAll(view,".btnShuffle","click",function(){var currentItem=this.currentItem;playbackManager.shuffle(currentItem)}.bind(this)),bindAll(view,".btnPlayTrailer","click",function(){var currentItem=this.currentItem;playbackManager.playTrailers(currentItem)}.bind(this)),bindAll(view,".btnCancelSeriesTimer","click",function(){var currentItem=this.currentItem;require(["recordingHelper"],function(recordingHelper){recordingHelper.cancelSeriesTimerWithConfirmation(currentItem.Id,currentItem.ServerId).then(function(){appRouter.showLiveTV(currentItem.ServerId)})})}.bind(this)),bindAll(view,".btnCancelTimer","click",function(){var instance=this;require(["recordingHelper"],function(recordingHelper){recordingHelper.cancelTimer(connectionManager.getApiClient(instance.currentItem.ServerId),instance.currentItem.TimerId).then(function(){reloadItem(instance,!0)})})}.bind(this)),bindAll(view,".btnDeleteItem","click",onDeleteClick.bind(this)),bindAll(view,".btnSyncDownload","download",onDownloadChange.bind(this)),bindAll(view,".btnSyncDownload","download-cancel",onDownloadChange.bind(this)),bindAll(view,".btnMoreCommands","click",function(e){var button=e.currentTarget,instance=this,params=this.params,apiClient=connectionManager.getApiClient(params.serverId),currentItem=this.currentItem,view=this.view;apiClient.getCurrentUser().then(function(user){itemContextMenu.show(getContextMenuOptions(view,currentItem,user,button)).then(function(result){!result.updated&&"addtoplaylist"!==result.command&&"addtocollection"!==result.command||reloadItem(instance,!0)},onPromiseRejected)})}.bind(this)),bindAll(view,".btnManageSeriesRecording","click",function(e){var item=this.currentItem;item.SeriesTimerId&&appRouter.showItem({Type:"SeriesTimer",Id:item.SeriesTimerId,ServerId:item.ServerId})}.bind(this)),this.mainSection.addEventListener("focus",function(e){var target=e.target;target.classList.contains("btnReadMore")||target.closest(".seriesRecordingEditor")||this.view.scrollToPosition({top:0})}.bind(this),!0),bindAll(view,".btnSplitVersions","click",onSplitVersionsClick.bind(this)),bindAll(view,".btnReadMore","click",onReadMoreClick.bind(this)),bindAll(view,".btnOverviewText","click",onReadMoreClick.bind(this));var instance=this;view.querySelector(".selectSource").addEventListener("change",function(){renderVideoSelections(view,instance._currentPlaybackMediaSources),renderAudioSelections(view,instance._currentPlaybackMediaSources),renderSubtitleSelections(view,instance._currentPlaybackMediaSources),updateTrackSelectionsFocusState(instance,view)}),view.addEventListener("viewbeforehide",function(e){var detail=e.detail;detail&&detail.newView&&detail.newView.classList.contains("itemView")||(this.backgroundContainer.classList.remove("itemBackgroundContainer","itemBackgroundContainer-preventbackdrop"),document.querySelector(".backdropContainer").classList.remove("backdropContainer-preventbackdrop"))}.bind(this)),this.onUserDataChangedFn=function(e,apiClient,userData){var currentItem=this.currentItem,view=this.view;currentItem&&currentItem.Id===userData.ItemId&&"Video"===currentItem.MediaType&&(currentItem.UserData=userData,reloadPlayButtons(this,view,currentItem,!0))}.bind(this),this.onLibraryChangedFn=function(e,apiClient,data){var currentItem=this.currentItem;this.view,currentItem&&data.ItemsUpdated&&data.ItemsUpdated.includes(currentItem.Id)&&(this.paused?this._fullReloadOnResume=!0:reloadItem(this,!0))}.bind(this),inputManager.on(view,this.onInputCommandFn);var onLibraryChangedFn=this.onLibraryChangedFn;onLibraryChangedFn&&events.on(serverNotifications,"LibraryChanged",onLibraryChangedFn)}return Object.assign(ItemPage.prototype,BaseView.prototype),ItemPage.prototype.onBeginResume=function(options){BaseView.prototype.onBeginResume.apply(this,arguments),startDataLoad(this)},ItemPage.prototype.onResume=function(options){BaseView.prototype.onResume.apply(this,arguments);var view=this.view,onUserDataChangedFn=this.onUserDataChangedFn;onUserDataChangedFn&&events.on(serverNotifications,"UserDataChanged",onUserDataChangedFn);var onPlayerChangeFn=this.playerChangeFn;onPlayerChangeFn&&events.on(playbackManager,"playerchange",onPlayerChangeFn);var currentItem,refresh=options.refresh||this._fullReloadOnResume;this._fullReloadOnResume=!1,reloadItem(this,refresh,!1),refresh||(renderTrackSelectionsWithoutUser(view,this,currentItem=this.currentItem,!0),setTrailerButtonVisibility(view,currentItem))},ItemPage.prototype.onPause=function(){BaseView.prototype.onPause.apply(this,arguments);var onUserDataChangedFn=this.onUserDataChangedFn;onUserDataChangedFn&&events.off(serverNotifications,"UserDataChanged",onUserDataChangedFn);var onPlayerChangeFn=this.playerChangeFn;onPlayerChangeFn&&events.off(playbackManager,"playerchange",onPlayerChangeFn)},ItemPage.prototype.enableTransitions=function(){return!0},ItemPage.prototype.destroy=function(){var view=this.view,onLibraryChangedFn=this.onLibraryChangedFn;onLibraryChangedFn&&events.off(serverNotifications,"LibraryChanged",onLibraryChangedFn),this.onLibraryChangedFn=null;var onInputCommandFn=this.onInputCommandFn;onInputCommandFn&&view&&inputManager.off(view,onInputCommandFn),this.onInputCommandFn=null,BaseView.prototype.destroy.apply(this,arguments),this.onUserDataChangedFn=null,this.playerChangeFn=null,this.currentItem=null,this._currentPlaybackMediaSources=null,this.currentRecordingFields&&(this.currentRecordingFields.destroy(),this.currentRecordingFields=null),this.seasonItems=null,this.topDetailsContainer=null,this.mainSection=null,this.backgroundContainer=null,this.trackSelectionsContainer=null,this.params=null,this.dataPromises=null},ItemPage});