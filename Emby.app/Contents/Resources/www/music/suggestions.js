define(["baseTab","cardBuilder","loading","connectionManager","apphost","layoutManager","focusManager","emby-itemscontainer","emby-scroller"],function(BaseTab,cardBuilder,loading,connectionManager,appHost,layoutManager,focusManager){"use strict";function MusicSuggestionsTab(view,params){BaseTab.apply(this,arguments),this.view=view,this.params=params,this.apiClient=connectionManager.getApiClient(params.serverId),this.latestItemsContainer=view.querySelector(".latestSection .itemsContainer"),this.latestItemsContainer.fetchData=function(query){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getLatestItems({IncludeItemTypes:apiClient.isMinServerVersion("4.6.0.45")?null:"Audio",Fields:"PrimaryImageAspectRatio,BasicSyncInfo",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary",Limit:24})}.bind(this),this.latestItemsContainer.getListOptions=function(items){return getListOptions(0,{})}.bind(this),this.latestItemsContainer.parentContainer=view.querySelector(".latestSection"),this.latestItemsContainer.maxTotalRecordCount=24,this.addFocusBehavior(this.latestItemsContainer),this.recentlyPlayedItemsContainer=view.querySelector(".recentlyPlayedSection .itemsContainer"),this.recentlyPlayedItemsContainer.fetchData=function(query){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getItems(apiClient.getCurrentUserId(),Object.assign({SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Audio",Recursive:!0,Fields:"PrimaryImageAspectRatio,CanDelete",Filters:"IsPlayed",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Logo"},query))}.bind(this),this.recentlyPlayedItemsContainer.getListOptions=function(items){return getListOptions(0,{action:"play",overlayPlayButton:!1,sideFooter:!0})}.bind(this),this.recentlyPlayedItemsContainer.parentContainer=view.querySelector(".recentlyPlayedSection"),this.recentlyPlayedItemsContainer.maxTotalRecordCount=50,this.addFocusBehavior(this.recentlyPlayedItemsContainer),this.frequentlyPlayedItemsContainer=view.querySelector(".frequentlyPlayedSection .itemsContainer"),this.frequentlyPlayedItemsContainer.fetchData=function(query){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getItems(apiClient.getCurrentUserId(),Object.assign({SortBy:"PlayCount",SortOrder:"Descending",IncludeItemTypes:"Audio",Recursive:!0,Fields:"PrimaryImageAspectRatio,CanDelete",Filters:"IsPlayed",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Logo"},query))}.bind(this),this.frequentlyPlayedItemsContainer.getListOptions=function(items){return getListOptions(0,{action:"play",overlayPlayButton:!1,sideFooter:!0})}.bind(this),this.frequentlyPlayedItemsContainer.parentContainer=view.querySelector(".frequentlyPlayedSection"),this.frequentlyPlayedItemsContainer.maxTotalRecordCount=50,this.addFocusBehavior(this.frequentlyPlayedItemsContainer),this.favoriteArtistsItemsContainer=view.querySelector(".favoriteArtistsSection .itemsContainer"),this.favoriteArtistsItemsContainer.fetchData=function(query){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getArtists(apiClient.getCurrentUserId(),Object.assign({SortBy:"SortName",SortOrder:"Ascending",Recursive:!0,Fields:"PrimaryImageAspectRatio,BasicSyncInfo",Filters:"IsFavorite",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary",ParentId:parentId},query))}.bind(this),this.favoriteArtistsItemsContainer.getListOptions=function(items){return getListOptions(0,{overlayPlayButton:!0,showParentTitle:!1,round:!0})}.bind(this),this.favoriteArtistsItemsContainer.parentContainer=view.querySelector(".favoriteArtistsSection"),this.addFocusBehavior(this.favoriteArtistsItemsContainer),this.favoriteAlbumsItemsContainer=view.querySelector(".favoriteAlbumsSection .itemsContainer"),this.favoriteAlbumsItemsContainer.fetchData=function(query){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getItems(apiClient.getCurrentUserId(),Object.assign({SortBy:"Random",IncludeItemTypes:"MusicAlbum",Recursive:!0,Fields:"PrimaryImageAspectRatio,CanDelete",Filters:"IsFavorite",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary"},query))}.bind(this),this.favoriteAlbumsItemsContainer.getListOptions=function(items){return getListOptions(0,{overlayPlayButton:!0})}.bind(this),this.favoriteAlbumsItemsContainer.parentContainer=view.querySelector(".favoriteAlbumsSection"),this.addFocusBehavior(this.favoriteAlbumsItemsContainer),this.favoriteSongsItemsContainer=view.querySelector(".favoriteSongsSection .itemsContainer"),this.favoriteSongsItemsContainer.fetchData=function(query){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getItems(apiClient.getCurrentUserId(),Object.assign({SortBy:"Random",IncludeItemTypes:"Audio",Recursive:!0,Fields:"PrimaryImageAspectRatio,CanDelete",Filters:"IsFavorite",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Logo"},query))}.bind(this),this.favoriteSongsItemsContainer.getListOptions=function(items){return getListOptions(0,{action:"play",overlayPlayButton:!1,sideFooter:!0})}.bind(this),this.favoriteSongsItemsContainer.parentContainer=view.querySelector(".favoriteSongsSection"),this.addFocusBehavior(this.favoriteSongsItemsContainer),params.parentId&&(this.latestItemsContainer.setAttribute("data-parentid",params.parentId),this.recentlyPlayedItemsContainer.setAttribute("data-parentid",params.parentId),this.frequentlyPlayedItemsContainer.setAttribute("data-parentid",params.parentId),this.favoriteArtistsItemsContainer.setAttribute("data-parentid",params.parentId),this.favoriteAlbumsItemsContainer.setAttribute("data-parentid",params.parentId),this.favoriteSongsItemsContainer.setAttribute("data-parentid",params.parentId)),function(view,params){[].forEach.call(view.querySelectorAll(".sectionTitleTextButton-link"),function(link){var href=link.getAttribute("data-href");href&&(link.href=href+"&serverId="+params.serverId)})}(view,params)}function getListOptions(items,options){return{renderer:cardBuilder,options:Object.assign({showUnplayedIndicator:!1,showLatestItemsPopup:!1,shape:"autooverflow",fields:["Name"],showParentTitle:!0,centerText:!0,overlayPlayButton:!0},options),virtualScrollLayout:"horizontal-grid"}}return Object.assign(MusicSuggestionsTab.prototype,BaseTab.prototype),MusicSuggestionsTab.prototype.onResume=function(options){BaseTab.prototype.onResume.apply(this,arguments);var promises=[];promises.push(this.latestItemsContainer.resume(options)),promises.push(this.recentlyPlayedItemsContainer.resume(options)),promises.push(this.frequentlyPlayedItemsContainer.resume(options)),promises.push(this.favoriteArtistsItemsContainer.resume(options)),promises.push(this.favoriteAlbumsItemsContainer.resume(options)),promises.push(this.favoriteSongsItemsContainer.resume(options));var view=this.view;Promise.all(promises).then(function(){options.autoFocus&&focusManager.autoFocus(view)})},MusicSuggestionsTab.prototype.onPause=function(){BaseTab.prototype.onPause.apply(this,arguments),this.latestItemsContainer.pause(),this.recentlyPlayedItemsContainer.pause(),this.frequentlyPlayedItemsContainer.pause(),this.favoriteArtistsItemsContainer.pause(),this.favoriteAlbumsItemsContainer.pause(),this.favoriteSongsItemsContainer.pause()},MusicSuggestionsTab.prototype.destroy=function(){BaseTab.prototype.destroy.apply(this,arguments),this.view=null,this.params=null,this.apiClient=null,this.latestItemsContainer=null,this.recentlyPlayedItemsContainer=null,this.frequentlyPlayedItemsContainer=null,this.favoriteArtistsItemsContainer=null,this.favoriteAlbumsItemsContainer=null,this.favoriteSongsItemsContainer=null},MusicSuggestionsTab});