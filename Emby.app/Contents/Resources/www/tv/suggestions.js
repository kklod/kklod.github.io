define(["baseTab","cardBuilder","loading","connectionManager","apphost","layoutManager","focusManager","emby-itemscontainer","emby-scroller"],function(BaseTab,cardBuilder,loading,connectionManager,appHost,layoutManager,focusManager){"use strict";function TvSuggestionsTab(view,params){BaseTab.apply(this,arguments),this.view=view,this.params=params,this.apiClient=connectionManager.getApiClient(params.serverId),function(view){for(var html,containers=view.querySelectorAll(".autoScrollSection"),i=0,length=containers.length;i<length;i++){var section=containers[i],sectionType=section.getAttribute("data-section"),commands="";"nextup"===sectionType?commands=' data-commands="removefromnextup"':"resume"===sectionType&&(commands=' data-commands="removefromresume"'),html="resume"===sectionType?'<div is="emby-scroller" class="padded-top-focusscale padded-bottom-focusscale" data-mousewheel="false" data-centerfocus="true"><div is="emby-itemscontainer"'+commands+' class="itemsContainer scrollSlider focuscontainer-x padded-left padded-right" data-monitor="videoplayback,markplayed" data-virtualscrolllayout="horizontal-grid"></div></div>':'<div is="emby-itemscontainer"'+commands+' class="itemsContainer padded-left padded-right vertical-wrap focuscontainer-x" data-monitor="videoplayback,markplayed"></div>',section.insertAdjacentHTML("beforeend",html)}}(view),this.resumeItemsContainer=view.querySelector(".resumeSection .itemsContainer"),this.resumeItemsContainer.fetchData=function(query){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getResumableItems(apiClient.getCurrentUserId(),Object.assign({IncludeItemTypes:"Episode",Fields:"PrimaryImageAspectRatio,BasicSyncInfo",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb"},query))}.bind(this),this.resumeItemsContainer.getListOptions=function(){return{renderer:cardBuilder,options:{preferThumb:!0,shape:"backdrop",scalable:!0,fields:["Name"],showParentTitle:!0,overlayText:!1,centerText:!0,overlayPlayButton:!0,cardLayout:!1},virtualScrollLayout:"horizontal-grid"}}.bind(this),this.resumeItemsContainer.parentContainer=view.querySelector(".resumeSection"),this.addFocusBehavior(this.resumeItemsContainer),this.nextUpItemsContainer=view.querySelector(".nextUpSection .itemsContainer"),this.nextUpItemsContainer.fetchData=function(){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getNextUpEpisodes({ParentId:parentId,Limit:48,Fields:"PrimaryImageAspectRatio,BasicSyncInfo",UserId:apiClient.getCurrentUserId(),ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb",EnableTotalRecordCount:!1})}.bind(this),this.nextUpItemsContainer.getListOptions=function(){return{renderer:cardBuilder,options:{preferThumb:!0,shape:"backdrop",scalable:!0,fields:["Name"],showParentTitle:!0,overlayText:!1,centerText:!0,overlayPlayButton:!0,cardLayout:!1},virtualScrollLayout:"vertical-grid"}}.bind(this),this.nextUpItemsContainer.parentContainer=view.querySelector(".nextUpSection"),this.addFocusBehavior(this.nextUpItemsContainer),this.latestItemsContainer=view.querySelector(".latestSection .itemsContainer"),this.latestItemsContainer.fetchData=function(query){var parentId=this.params.parentId;return this.apiClient.getLatestItems(Object.assign({IncludeItemTypes:"Episode",Limit:30,Fields:"PrimaryImageAspectRatio,BasicSyncInfo",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb,Logo,Banner",GroupItems:!1}),query)}.bind(this),this.latestItemsContainer.getListOptions=function(){return{renderer:cardBuilder,options:{preferThumb:!0,shape:"backdrop",scalable:!0,fields:["Name"],showParentTitle:!0,overlayText:!1,centerText:!0,overlayPlayButton:!0,cardLayout:!1},virtualScrollLayout:"vertical-grid"}}.bind(this),this.latestItemsContainer.parentContainer=view.querySelector(".latestSection"),this.addFocusBehavior(this.latestItemsContainer),params.parentId&&(this.resumeItemsContainer.setAttribute("data-parentid",params.parentId),this.nextUpItemsContainer.setAttribute("data-parentid",params.parentId),this.latestItemsContainer.setAttribute("data-parentid",params.parentId)),layoutManager.tv||function(view,params,apiClient){require(["categorySyncButton"],function(categorySyncButton){apiClient.getCurrentUser().then(function(user){categorySyncButton.init(view.querySelector(".btnSyncLatest"),user,params.serverId,params.parentId),categorySyncButton.init(view.querySelector(".btnSyncNextUp"),user,params.serverId,params.parentId)})})}(view,params,this.apiClient)}return Object.assign(TvSuggestionsTab.prototype,BaseTab.prototype),TvSuggestionsTab.prototype.onResume=function(options){BaseTab.prototype.onResume.apply(this,arguments);var promises=[];promises.push(this.resumeItemsContainer.resume(options)),promises.push(this.nextUpItemsContainer.resume(options)),promises.push(this.latestItemsContainer.resume(options));var view=this.view;Promise.all(promises).then(function(){options.autoFocus&&focusManager.autoFocus(view)})},TvSuggestionsTab.prototype.onPause=function(){BaseTab.prototype.onPause.apply(this,arguments),this.resumeItemsContainer.pause(),this.nextUpItemsContainer.pause(),this.latestItemsContainer.pause()},TvSuggestionsTab.prototype.destroy=function(){BaseTab.prototype.destroy.apply(this,arguments),this.view=null,this.params=null,this.apiClient=null,this.resumeItemsContainer=null,this.nextUpItemsContainer=null,this.latestItemsContainer=null},TvSuggestionsTab});