define(["baseTab","appRouter","cardBuilder","dom","globalize","connectionManager","focusManager","emby-itemscontainer","emby-scroller"],function(BaseTab,appRouter,cardBuilder,dom,globalize,connectionManager,focusManager){"use strict";function FavoritesTab(view,params){BaseTab.apply(this,arguments),this.view=view,this.params=params,this.apiClient=connectionManager.currentApiClient(),this.sectionsContainer=view.querySelector(".sections"),function(instance,elem,apiClient){var i,length,sections=function(){var sections=[{name:"HeaderFavoriteChannels",types:"TvChannel",shape:"autooverflow",fields:["Name","CurrentProgramParentName","CurrentProgramTime"],overlayPlayButton:!0,centerText:!0,defaultBackground:!0,preferThumb:"auto"},{name:"HeaderFavoriteShows",types:"Series",shape:"autooverflow",fields:["Name","ProductionYear"],overlayPlayButton:!0,centerText:!0},{name:"HeaderFavoriteEpisodes",types:"Episode",shape:"autooverflow",preferThumb:!1,fields:["Name"],showParentTitle:!0,overlayPlayButton:!0,centerText:!0},{name:"HeaderFavoriteMovies",types:"Movie",shape:"autooverflow",fields:["Name","ProductionYear"],overlayPlayButton:!0,centerText:!0},{name:"HeaderFavoriteVideos",types:"Video",shape:"autooverflow",preferThumb:!0,fields:["Name"],overlayPlayButton:!0,centerText:!0},{name:"HeaderFavoriteCollections",types:"BoxSet",shape:"autooverflow",fields:["Name"],overlayPlayButton:!0,centerText:!0},{name:"HeaderFavoritePlaylists",types:"Playlist",shape:"autooverflow",preferThumb:!1,fields:["Name"],showParentTitle:!1,centerText:!0,overlayPlayButton:!0},{name:"HeaderFavoriteArtists",types:"MusicArtist",shape:"autooverflow",round:!0,preferThumb:!1,fields:["Name"],showParentTitle:!1,centerText:!0,overlayPlayButton:!0},{name:"HeaderFavoriteAlbums",types:"MusicAlbum",shape:"autooverflow",preferThumb:!1,fields:["Name"],showParentTitle:!0,centerText:!0,overlayPlayButton:!0},{name:"HeaderFavoriteSongs",types:"Audio",sideFooter:!0,shape:"autooverflow",preferThumb:!1,fields:["Name"],showParentTitle:!0,centerText:!0,action:"instantmix"},{name:"HeaderFavoriteGames",types:"Game",shape:"autooverflow",preferThumb:!1,fields:["Name","ProductionYear"],showParentTitle:!0,centerText:!0}];return sections.push({name:"HeaderFavoritePeople",types:"Person",shape:"autooverflow",fields:["Name"],centerText:!0}),sections}(),html="";for(i=0,length=sections.length;i<length;i++){var section=sections[i],sectionClass="verticalSection focusable";section.fields.includes("Name")&&!section.sideFooter||(sectionClass+=" verticalSection-extrabottompadding"),html+='<div class="'+sectionClass+' hide" data-focusabletype="nearest">',html+='<div class="sectionTitleContainer sectionTitleContainer-cards padded-left padded-right">',html+='<a is="emby-sectiontitle" href="'+function(section,serverId){return appRouter.getRouteUrl("list",{serverId:serverId,itemTypes:section.types,isFavorite:!0})}(section,apiClient.serverId())+'" class="noautofocus more button-link sectionTitleTextButton">',html+='<h2 class="sectionTitle sectionTitle-cards">',html+=globalize.translate(section.name),html+="</h2>",html+="</a>",html+="</div>";var itemsContainerClass="itemsContainer scrollSlider focuscontainer-x padded-left padded-right";section.sideFooter&&(itemsContainerClass+=" itemsContainer-sideFooters"),html+='<div is="emby-scroller" class="padded-top-focusscale padded-bottom-focusscale" data-mousewheel="false" data-centerfocus="true"><div is="emby-itemscontainer" class="'+itemsContainerClass+'" data-monitor="markfavorite" data-virtualscrolllayout="horizontal-grid"></div></div>',html+="</div>"}elem.innerHTML=html;var elems=elem.querySelectorAll(".itemsContainer");for(i=0,length=elems.length;i<length;i++){var itemsContainer=elems[i];itemsContainer.fetchData=function(section){return function(query){var apiClient=this.apiClient,fields="PrimaryImageAspectRatio,BasicSyncInfo";section.fields.includes("ProductionYear")&&(fields+=",ProductionYear","Series"===section.types&&(fields+=",Status,EndDate"));var options=Object.assign({SortBy:"Episode"===section.types?"SeriesName,SortName":"SortName",SortOrder:"Ascending",Filters:"IsFavorite",Recursive:!0,Fields:fields,CollapseBoxSetItems:!1},query||{});"TvChannel"===section.types&&(options.SortBy="ChannelNumber,SortName",options.Fields+=",CurrentProgram");var userId=apiClient.getCurrentUserId();return"MusicArtist"===section.types?apiClient.getArtists(userId,options):"Person"===section.types?apiClient.getPeople(userId,options):(options.IncludeItemTypes=section.types,apiClient.getItems(userId,options))}}(sections[i]).bind(instance),itemsContainer.getListOptions=function(section){return function(items){this.apiClient.serverId();return{renderer:cardBuilder,options:{preferThumb:section.preferThumb,shape:section.shape,sideFooter:section.sideFooter,centerText:section.centerText,overlayText:!1,fields:section.fields,showParentTitle:section.showParentTitle,scalable:!0,overlayPlayButton:section.overlayPlayButton,action:section.action,channelNumberFirst:!0},virtualScrollLayout:"horizontal-grid"}}}(sections[i]).bind(instance),itemsContainer.parentContainer=itemsContainer.closest(".verticalSection"),instance.addFocusBehavior(itemsContainer)}}(this,this.sectionsContainer,this.apiClient)}return Object.assign(FavoritesTab.prototype,BaseTab.prototype),FavoritesTab.prototype.onResume=function(options){BaseTab.prototype.onResume.apply(this,arguments),this.refresh(options)},FavoritesTab.prototype.refresh=function(options){this.apiClient;for(var promises=[],view=this.view,elems=this.sectionsContainer.querySelectorAll(".itemsContainer"),i=0,length=elems.length;i<length;i++)promises.push(elems[i].resume(options));Promise.all(promises).then(function(){options.autoFocus&&focusManager.autoFocus(view)})},FavoritesTab.prototype.onPause=function(){BaseTab.prototype.onPause.apply(this,arguments);for(var elems=this.sectionsContainer.querySelectorAll(".itemsContainer"),i=0,length=elems.length;i<length;i++)elems[i].pause()},FavoritesTab.prototype.destroy=function(){BaseTab.prototype.destroy.apply(this,arguments),this.view=null,this.params=null,this.apiClient=null;for(var elems=this.sectionsContainer.querySelectorAll(".itemsContainer"),i=0,length=elems.length;i<length;i++)elems[i].fetchData=null,elems[i].getListOptions=null,elems[i].parentContainer=null;this.sectionsContainer=null},FavoritesTab});