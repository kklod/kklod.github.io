define(["exports","./basetab.js","./../modules/cardbuilder/cardbuilder.js","./../modules/common/playback/playbackmanager.js"],function(_exports,_basetab,_cardbuilder,_playbackmanager){function ChaptersTab(view){_basetab.default.apply(this,arguments)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_basetab=babelHelpers.interopRequireDefault(_basetab),_cardbuilder=babelHelpers.interopRequireDefault(_cardbuilder),_playbackmanager=babelHelpers.interopRequireDefault(_playbackmanager),Object.assign(ChaptersTab.prototype,_basetab.default.prototype),ChaptersTab.prototype.loadTemplate=function(){var view=this.view;return view.innerHTML='\n                    <div is="emby-scroller" data-mousewheel="false" data-centerfocus="true" class="padded-top-focusscale padded-bottom-focusscale">\n                        <div is="emby-itemscontainer" class="scrollSlider itemsContainer videoosd-padded-left videoosd-padded-right" data-refreshinterval="300000" data-virtualscrolllayout="horizontal-grid"></div>\n                    </div>\n',this.itemsContainer=view.querySelector(".itemsContainer"),this.itemsContainer.fetchData=function(query){var item=this.currentOptions.displayItem,chapters=item.Chapters||[],videoStream=(((item.MediaSources||[])[0]||{}).MediaStreams||[]).filter(function(i){return"Video"===i.Type})[0]||{},aspect=null;videoStream.Width&&videoStream.Height&&(aspect=videoStream.Width/videoStream.Height);for(var i=0,length=chapters.length;i<length;i++){var chapter=chapters[i];chapter.Id=item.Id,chapter.Type=item.Type,chapter.ServerId=item.ServerId,chapter.MediaType=item.MediaType,chapter.PrimaryImageAspectRatio=aspect,chapter.ChapterIndex=i}var totalItems=chapters.length;return query&&(chapters=chapters.slice(query.StartIndex||0),query.Limit&&chapters.length>query.Limit&&(chapters.length=query.Limit)),Promise.resolve({Items:chapters,TotalRecordCount:totalItems})}.bind(this),this.itemsContainer.getListOptions=function(items){return{renderer:_cardbuilder.default,options:{shape:"autooverflow",centerText:!0,overlayText:!1,fields:["Name","ChapterTime"],multiSelect:!1,contextMenu:!1,playedButton:!1,ratingButton:!1,action:"custom",playAction:"custom",enableUserData:!1,draggable:!1,cardClass:"videoOsd-itemstab-card videoOsd-itemstab-card-twoline",defaultShape:"backdrop",allowBottomPadding:!1,defaultBackground:!0},virtualScrollLayout:"horizontal-grid"}}.bind(this),this.itemsContainer.addEventListener("action-null",function(e){var item=e.detail.item;_playbackmanager.default.seek(item.StartPositionTicks||0),this.closeTab()}.bind(this)),Promise.resolve()},ChaptersTab.prototype.onResume=function(options){var instance=this;return _basetab.default.prototype.onResume.apply(this,arguments).then(function(){var hasFocus=instance.itemsContainer.contains(document.activeElement);return instance.itemsContainer.resume(options).then(function(){instance.itemsContainer.scrollToIndex(instance.getCurrentChapterIndex(),{behavior:"instant"},hasFocus)})})},ChaptersTab.prototype.getCurrentChapterIndex=function(){for(var chapters=this.currentOptions.displayItem.Chapters||[],positionTicks=this.positionTicks||0,i=0,length=chapters.length;i<length;i++){if(positionTicks<chapters[i].StartPositionTicks)return Math.max(0,i-1)}return 0},ChaptersTab.prototype.onPause=function(){_basetab.default.prototype.onPause.apply(this,arguments),this.itemsContainer.pause()},ChaptersTab.prototype.destroy=function(){_basetab.default.prototype.destroy.apply(this,arguments),this.itemsContainer=null},_exports.default=ChaptersTab});