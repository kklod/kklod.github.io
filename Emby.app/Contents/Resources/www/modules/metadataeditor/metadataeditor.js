define(["textEncoding","layoutManager","dialogHelper","datetime","loading","focusManager","connectionManager","globalize","require","shell","emby-checkbox","emby-input","emby-select","listViewStyle","emby-textarea","emby-button","paper-icon-button-light","formDialogStyle","clearButtonStyle","flexStyles","emby-scroller","css!./metadataeditor"],function(textEncoding,layoutManager,dialogHelper,datetime,loading,focusManager,connectionManager,globalize,require,shell){"use strict";var currentContext,metadataEditorInfo,currentItem,hasChanges;function closeDialog(){currentContext.classList.contains("dialog")&&dialogHelper.close(currentContext)}function submitUpdatedItem(form,item){var apiClient=getApiClient();(function(form,item,apiClient){if("TvChannel"!==(item=currentItem).Type||!apiClient.isMinServerVersion("4.6.0.44"))return Promise.resolve();var providerId=form.querySelector(".selectGuideDataProvider").value||null,providerChannelId=form.querySelector(".selectGuideChannel").value||null;return providerId===item.ListingsProviderId&&providerChannelId===item.ListingsChannelId?Promise.resolve():apiClient.ajax({type:"POST",url:apiClient.getUrl("LiveTv/ChannelMappings"),data:{providerId:providerId,tunerChannelId:item.ManagementId,providerChannelId:providerChannelId},dataType:"json"})})(form,item,apiClient).then(function(){apiClient.updateItem(item).then(function(){hasChanges=!0,require(["toast"],function(toast){toast(globalize.translate("MessageItemSaved"))}),loading.hide(),closeDialog()})})}function getDateValue(form,element){var elem=form.querySelector(element);if("text"!==elem.getAttribute("type")){var val,offsetMs=60*(new Date).getTimezoneOffset()*1e3;if(val=elem.valueAsNumber)return new Date(val+offsetMs).toISOString()}return(val=form.querySelector(element).value)||null}function onSubmit(e){loading.show();var item={Id:currentItem.Id,Name:this.querySelector(".txtName").value,ChannelNumber:this.querySelector(".txtChannelNumber").value,OriginalTitle:this.querySelector("#txtOriginalName").value,ForcedSortName:this.querySelector(".txtSortName").value,SortName:this.querySelector(".txtSortName").value,CommunityRating:this.querySelector("#txtCommunityRating").value,CriticRating:this.querySelector("#txtCriticRating").value,IndexNumber:this.querySelector("#txtIndexNumber").value||null,AirsBeforeSeasonNumber:this.querySelector(".txtAirsBeforeSeason").value,AirsAfterSeasonNumber:this.querySelector(".txtAirsAfterSeason").value,AirsBeforeEpisodeNumber:this.querySelector(".txtAirsBeforeEpisode").value,ParentIndexNumber:this.querySelector("#txtParentIndexNumber").value||null,SortParentIndexNumber:this.querySelector(".txtDisplaySeason").value,SortIndexNumber:this.querySelector(".txtDisplayEpisode").value,DisplayOrder:this.querySelector("#selectDisplayOrder").value,Album:this.querySelector("#txtAlbum").value,AlbumArtists:function(form){return form.querySelector("#txtAlbumArtist").value.trim().split(";").filter(function(s){return 0<s.length}).map(function(a){return{Name:a}})}(this),ArtistItems:function(form){return form.querySelector("#txtArtist").value.trim().split(";").filter(function(s){return 0<s.length}).map(function(a){return{Name:a}})}(this),Overview:this.querySelector("#txtOverview").value,Status:this.querySelector("#selectStatus").value,Genres:getListValues(this.querySelector("#listGenres")),Tags:getListValues(this.querySelector("#listTags")),TagItems:getListValues(this.querySelector("#listTags")).map(function(element){return{Name:element}}),Studios:getListValues(this.querySelector("#listStudios")).map(function(element){return{Name:element}}),PremiereDate:getDateValue(this,"#txtPremiereDate"),DateCreated:getDateValue(this,"#txtDateAdded"),EndDate:getDateValue(this,"#txtEndDate"),ProductionYear:this.querySelector("#txtProductionYear").value,Video3DFormat:this.querySelector("#select3dFormat").value,OfficialRating:this.querySelector("#selectOfficialRating").value,CustomRating:this.querySelector("#selectCustomRating").value,People:currentItem.People,LockData:this.querySelector(".chkLockData").checked,LockedFields:Array.prototype.filter.call(this.querySelectorAll(".chkLockedField"),function(c){return c.checked}).map(function(c){return c.getAttribute("data-field")})};item.ProviderIds=Object.assign({},currentItem.ProviderIds);var placeOfBirth,seriesRuntime,idElements=this.querySelectorAll(".txtExternalId");Array.prototype.map.call(idElements,function(idElem){var providerKey=idElem.getAttribute("data-providerkey");item.ProviderIds[providerKey]=idElem.value}),item.PreferredMetadataLanguage=this.querySelector("#selectLanguage").value,item.PreferredMetadataCountryCode=this.querySelector("#selectCountry").value,"Person"===currentItem.Type&&(placeOfBirth=this.querySelector("#txtPlaceOfBirth").value,item.ProductionLocations=placeOfBirth?[placeOfBirth]:[]),"Series"===currentItem.Type&&(seriesRuntime=this.querySelector("#txtSeriesRuntime").value,item.RunTimeTicks=seriesRuntime?6e8*seriesRuntime:null);var tagline=this.querySelector("#txtTagline").value;return item.Taglines=tagline?[tagline]:[],submitUpdatedItem(this,item),e.preventDefault(),e.stopPropagation(),!1}function getListValues(list){return Array.prototype.map.call(list.querySelectorAll(".textValue"),function(el){return el.textContent})}function editPerson(context,person,index){require(["personEditor"],function(personEditor){personEditor.show(person).then(function(updatedPerson){-1===index&&currentItem.People.push(updatedPerson),populatePeople(context,currentItem.People);var chkLockedField=context.querySelector('.chkLockedField[data-field="People"]');chkLockedField&&(chkLockedField.checked=!0)})})}function onRejected(){}function showMoreMenu(context,button,user){require(["itemContextMenu"],function(itemContextMenu){var item=currentItem;itemContextMenu.show({item:item,positionTo:button,edit:!1,editImages:!0,editSubtitles:!0,sync:!1,share:!1,play:!1,queue:!1,user:user}).then(function(result){result.deleted?function(context,item){var parentId=item.ParentId||item.SeasonId||item.SeriesId;parentId?reload(context,parentId,item.ServerId):require(["appRouter"],function(appRouter){appRouter.goHome()})}(context,item):result.updated&&reload(context,item.Id,item.ServerId)},onRejected)})}function onEditorClick(e){var el,btnRemoveFromEditorList=e.target.closest(".btnRemoveFromEditorList");if(btnRemoveFromEditorList){var chkLockedField=btnRemoveFromEditorList.closest(".editableListviewContainer").querySelector(".chkLockedField");return chkLockedField&&(chkLockedField.checked=!0),(el=btnRemoveFromEditorList.closest(".listItem")).parentNode.removeChild(el),void e.stopPropagation()}var btnAddTextItem=e.target.closest(".btnAddTextItem");btnAddTextItem&&function(source,sortCallback){require(["prompt"],function(prompt){prompt({label:"Value:"}).then(function(text){var container=source.closest(".editableListviewContainer"),list=container.querySelector(".editorList"),items=getListValues(list);items.push(text),populateListView(list,items,sortCallback);var chkLockedField=container.querySelector(".chkLockedField");chkLockedField&&(chkLockedField.checked=!0)})})}(btnAddTextItem)}function getApiClient(){return connectionManager.getApiClient(currentItem.ServerId)}function onGuideDataProviderChange(e){var apiClient,section=this.closest(".channelMappingSection"),value=this.value;value&&"none"!==value?(section.querySelector(".fldGuideChannelId").classList.remove("hide"),(apiClient=connectionManager.getApiClient(currentItem)).isMinServerVersion("4.6.0.44")&&function(context,item,listingsProviderId,apiClient){apiClient.getJSON(apiClient.getUrl("LiveTv/ChannelMappingOptions",{ProviderId:listingsProviderId})).then(function(result){!function(context,item,channels){var select=context.querySelector(".selectGuideChannel"),options=channels.map(function(i){return'<option value="'+i.Id+'">'+i.Name.trim()+"</option>"}).join("");select.innerHTML=options,select.value=item.ListingsChannelId}(context,item,result.ProviderChannels)})}(section,currentItem,value,apiClient)):section.querySelector(".fldGuideChannelId").classList.add("hide")}function onFieldInput(e){var container=this.closest(".inputContainer,.selectContainer").parentNode.closest(".inputContainer");container&&(container.querySelector(".chkLockedField").checked=!0)}function init(context,apiClient){apiClient.isMinServerVersion("4.6.0.15")?context.querySelector(".specialEpisodeNumbers").classList.remove("hide"):context.querySelector(".legacySpecialEpisodeNumbers").classList.remove("hide"),context.querySelector(".externalIds").addEventListener("click",function(e){var field,formatString,btnOpenExternalId=e.target.closest(".btnOpenExternalId");btnOpenExternalId&&(formatString=(field=context.querySelector("#"+btnOpenExternalId.getAttribute("data-fieldid"))).getAttribute("data-formatstring"),field.value&&shell.openUrl(formatString.replace("{0}",field.value)))}),context.querySelector(".btnCancel").addEventListener("click",function(){closeDialog()}),context.querySelector(".btnMore").addEventListener("click",function(e){getApiClient().getCurrentUser().then(function(user){showMoreMenu(context,e.target,user)})}),context.querySelector(".selectGuideDataProvider").addEventListener("change",onGuideDataProviderChange),context.querySelector(".btnHeaderSave").addEventListener("click",function(e){context.querySelector(".btnSave").click()}),context.removeEventListener("click",onEditorClick),context.addEventListener("click",onEditorClick);var form=context.querySelector("form");form.removeEventListener("submit",onSubmit),form.addEventListener("submit",onSubmit),context.querySelector("#btnAddPerson").addEventListener("click",function(event,data){editPerson(context,{},-1)}),context.querySelector("#peopleList").addEventListener("click",function(e){var index,chkLockedField,btnDeletePerson=e.target.closest(".btnDeletePerson");btnDeletePerson&&(index=parseInt(btnDeletePerson.getAttribute("data-index")),currentItem.People.splice(index,1),populatePeople(context,currentItem.People),(chkLockedField=context.querySelector('.chkLockedField[data-field="People"]'))&&(chkLockedField.checked=!0),e.stopPropagation());var btnEditPerson=e.target.closest(".btnEditPerson");btnEditPerson&&(index=parseInt(btnEditPerson.getAttribute("data-index")),editPerson(context,currentItem.People[index],index))}),function(context){for(var elems=context.querySelectorAll(".txtInput-withlockedfield, .select-withlockedfield"),i=0,length=elems.length;i<length;i++){var elem=elems[i];"SELECT"===elem.tagName?elem.addEventListener("change",onFieldInput):elem.addEventListener("input",onFieldInput)}}(context)}function loadExternalIds(context,item,externalIds){for(var html="",providerIds=item.ProviderIds||{},keys=Object.keys(providerIds),i=0,length=externalIds.length;i<length;i++){var idInfo=externalIds[i],id="txt1"+idInfo.Key,formatString=idInfo.UrlFormatString||"",labelText=globalize.translate("LabelDynamicExternalId").replace("{0}",idInfo.Name);html+='<div class="inputContainer">',html+='<div class="flex align-items-center">',html+='<div class="flex-grow">',html+='<input is="emby-input" class="txtExternalId" value="'+(providerIds[function(keys,key){return keys.filter(function(k){return k===key})[0]||key}(keys,idInfo.Key)]||"")+'" data-providerkey="'+idInfo.Key+'" data-formatstring="'+formatString+'" id="'+id+'" label="'+labelText+'"/>',html+="</div>",formatString&&(html+='<button type="button" is="paper-icon-button-light" class="btnOpenExternalId align-self-flex-end md-icon" data-fieldid="'+id+'">open_in_browser</button>'),html+="</div>",html+="</div>"}context.querySelector(".externalIds",context).innerHTML=html,externalIds.length?context.querySelector(".externalIdsSection").classList.remove("hide"):context.querySelector(".externalIdsSection").classList.add("hide")}function hideElement(selector,context,multiple){var elements;context=context||document,"string"==typeof selector?(elements=multiple?context.querySelectorAll(selector):[context.querySelector(selector)],Array.prototype.forEach.call(elements,function(el){el&&el.classList.add("hide")})):selector.classList.add("hide")}function showElement(selector,context,multiple){var elements;context=context||document,"string"==typeof selector?(elements=multiple?context.querySelectorAll(selector):[context.querySelector(selector)],Array.prototype.forEach.call(elements,function(el){el&&el.classList.remove("hide")})):selector.classList.remove("hide")}function setRequired(elem,required){required?elem.setAttribute("required","required"):elem.removeAttribute("required")}function pad(num,size){for(var s=num+"";s.length<size;)s="0"+s;return s}function setDateValue(field,date){var offsetMs,ms;void 0===field.valueAsNumber||"text"===field.getAttribute("type")?field.value=function(date){return date.getFullYear()+"-"+pad(date.getMonth()+1,2)+"-"+pad(date.getDate(),2)}(date):(offsetMs=60*(new Date).getTimezoneOffset()*1e3,field.valueAsNumber=(ms=date.getTime()-offsetMs)-ms%1e3)}function fillItemInfo(context,item,apiClient,parentalRatingOptions){var select=context.querySelector("#selectOfficialRating");populateRatings(parentalRatingOptions,select,item.OfficialRating),select.value=item.OfficialRating||"",populateRatings(parentalRatingOptions,select=context.querySelector("#selectCustomRating"),item.CustomRating),select.value=item.CustomRating||"";var selectStatus=context.querySelector("#selectStatus");!function(select){var html="";html+="<option value=''></option>",html+="<option value='Continuing'>"+globalize.translate("Continuing")+"</option>",html+="<option value='Ended'>"+globalize.translate("Ended")+"</option>",select.innerHTML=html}(selectStatus),selectStatus.value=item.Status||"",context.querySelector("#select3dFormat",context).value=item.Video3DFormat||"",populateListView(context.querySelector("#listGenres"),item.Genres),populatePeople(context,item.People||[]),populateListView(context.querySelector("#listStudios"),(item.Studios||[]).map(function(element){return element.Name||""})),item.TagItems?populateListView(context.querySelector("#listTags"),item.TagItems.map(function(element){return element.Name||""})):populateListView(context.querySelector("#listTags"),item.Tags);var date,lockData=item.LockData||!1;if(context.querySelector(".chkLockData").checked=lockData,context.querySelector(".txtPath").innerHTML=item.Path||"",context.querySelector(".txtName").value=item.Name||"",context.querySelector(".txtChannelNumber").value=item.ChannelNumber||"",context.querySelector("#txtOriginalName").value=item.OriginalTitle||"",context.querySelector("#txtOverview").value=item.Overview||"",context.querySelector("#txtTagline").value=item.Taglines&&item.Taglines.length?item.Taglines[0]:"",apiClient.isMinServerVersion("4.7.0.8")?context.querySelector(".txtSortName").value=item.SortName||"":context.querySelector(".txtSortName").value=item.ForcedSortName||"",context.querySelector("#txtCommunityRating").value=item.CommunityRating||"",context.querySelector("#txtCriticRating").value=item.CriticRating||"",context.querySelector("#txtIndexNumber").value=null==item.IndexNumber?"":item.IndexNumber,context.querySelector("#txtParentIndexNumber").value=null==item.ParentIndexNumber?"":item.ParentIndexNumber,context.querySelector(".txtAirsBeforeSeason").value="AirsBeforeSeasonNumber"in item?item.AirsBeforeSeasonNumber:"",context.querySelector(".txtAirsAfterSeason").value="AirsAfterSeasonNumber"in item?item.AirsAfterSeasonNumber:"",context.querySelector(".txtAirsBeforeEpisode").value="AirsBeforeEpisodeNumber"in item?item.AirsBeforeEpisodeNumber:"",context.querySelector(".txtDisplaySeason").value="SortParentIndexNumber"in item?item.SortParentIndexNumber:"",context.querySelector(".txtDisplayEpisode").value="SortIndexNumber"in item?item.SortIndexNumber:"",context.querySelector("#txtAlbum").value=item.Album||"",context.querySelector("#txtAlbumArtist").value=(item.AlbumArtists||[]).map(function(a){return a.Name}).join(";"),"Series"===item.Type?context.querySelector("#selectDisplayOrder").value=(item.DisplayOrder||"").toLowerCase():context.querySelector("#selectDisplayOrder").value=item.DisplayOrder||"",context.querySelector("#txtArtist").value=(item.ArtistItems||[]).map(function(a){return a.Name}).join(";"),item.DateCreated)try{date=datetime.parseISO8601Date(item.DateCreated,!0),setDateValue(context.querySelector("#txtDateAdded"),date)}catch(e){context.querySelector("#txtDateAdded").value=""}else context.querySelector("#txtDateAdded").value="";if(item.PremiereDate)try{date=datetime.parseISO8601Date(item.PremiereDate,!0),setDateValue(context.querySelector("#txtPremiereDate"),date)}catch(e){context.querySelector("#txtPremiereDate").value=""}else context.querySelector("#txtPremiereDate").value="";if(item.EndDate)try{date=datetime.parseISO8601Date(item.EndDate,!0),setDateValue(context.querySelector("#txtEndDate"),date)}catch(e){context.querySelector("#txtEndDate").value=""}else context.querySelector("#txtEndDate").value="";context.querySelector("#txtProductionYear").value=item.ProductionYear||"";var minutes,placeofBirth=item.ProductionLocations&&item.ProductionLocations.length?item.ProductionLocations[0]:"";context.querySelector("#txtPlaceOfBirth").value=placeofBirth,context.querySelector("#selectLanguage").value=item.PreferredMetadataLanguage||"",context.querySelector("#selectCountry").value=item.PreferredMetadataCountryCode||"",item.RunTimeTicks?(minutes=item.RunTimeTicks/6e8,context.querySelector("#txtSeriesRuntime").value=Math.round(minutes)):context.querySelector("#txtSeriesRuntime",context).value=""}function fillChannelMapping(context,item,apiClient){return apiClient.getJSON(apiClient.getUrl("LiveTv/ListingProviders",{ChannelId:item.Id})).then(function(result){result.length?context.querySelector(".channelMappingSection").classList.remove("hide"):context.querySelector(".channelMappingSection").classList.add("hide"),function(context,item,providers){var select=context.querySelector(".selectGuideDataProvider");providers.push({Name:globalize.translate("None"),Id:"none"});var options=providers.map(function(i){return'<option value="'+i.Id+'">'+i.Name+" "+textEncoding.htmlEncode(i.ListingsId||i.Path||"").trim()+"</option>"}).join("");select.innerHTML=options,select.value=item.ListingsProviderId,onGuideDataProviderChange.call(select)}(context,item,result)})}function populateRatings(allParentalRatings,select,currentValue){var html="";html+="<option value=''></option>";for(var rating,ratings=[],currentValueFound=!1,i=0,length=allParentalRatings.length;i<length;i++)rating=allParentalRatings[i],ratings.push({Name:rating.Name,Value:rating.Name}),rating.Name===currentValue&&(currentValueFound=!0);for(currentValue&&!currentValueFound&&ratings.push({Name:currentValue,Value:currentValue}),i=0,length=ratings.length;i<length;i++)html+="<option value='"+(rating=ratings[i]).Value+"'>"+rating.Name+"</option>";select.innerHTML=html}function populateListView(list,items,sortCallback){items=items||[],void 0===sortCallback?items.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())}):items=sortCallback(items);for(var html="",i=0;i<items.length;i++)html+='<div class="listItem listItem-border">',html+='<div class="listItemBody listItemBody-noleftpadding">',html+='<div class="textValue">',html+=items[i],html+="</div>",html+="</div>",html+='<button type="button" is="paper-icon-button-light" data-index="'+i+'" class="btnRemoveFromEditorList md-icon">delete</button>',html+="</div>";list.innerHTML=html}function populatePeople(context,people){for(var html="",elem=context.querySelector("#peopleList"),i=0,length=people.length;i<length;i++){var person=people[i];html+='<div class="listItem listItem-border">',html+='<i class="md-icon listItemIcon">person</i>',html+='<div class="listItemBody">',html+='<button style="text-align:left;" type="button" class="btnEditPerson clearButton" data-index="'+i+'">',html+='<div class="listItemBodyText textValue">',html+=person.Name||"",html+="</div>",person.Role&&""!==person.Role&&(html+='<div class="listItemBodyText-secondary">'+person.Role+"</div>"),html+="</button>",html+="</div>",html+='<button type="button" is="paper-icon-button-light" data-index="'+i+'" class="btnDeletePerson md-icon">delete</button>',html+="</div>"}elem.innerHTML=html}function checkDateTimeInput(type){var input=document.createElement("input");input.setAttribute("type",type);return input.setAttribute("value","not-a-date"),"not-a-date"!==input.value}function reload(context,itemId,serverId){loading.show(),Promise.all([function(itemId,serverId){var apiClient=connectionManager.getApiClient(serverId);return itemId?apiClient.getItem(apiClient.getCurrentUserId(),itemId,{Fields:"ChannelMappingInfo"}):apiClient.getRootFolder(apiClient.getCurrentUserId())}(itemId,serverId),function(itemId,serverId){var apiClient=connectionManager.getApiClient(serverId);return itemId?apiClient.getJSON(apiClient.getUrl("Items/"+itemId+"/MetadataEditor")):Promise.resolve({})}(itemId,serverId)]).then(function(responses){var item=responses[0];metadataEditorInfo=responses[1],currentItem=item,hasChanges=!1;var languages=metadataEditorInfo.Cultures,countries=metadataEditorInfo.Countries;loadExternalIds(context,item,metadataEditorInfo.ExternalIdInfos),function(context,item){for(var elems=context.querySelectorAll(".chkLockedField"),i=0,length=elems.length;i<length;i++){var elem=elems[i];elem.checked=item.LockedFields.includes(elem.getAttribute("data-field"))}}(context,item),function(select,languages){var html="";html+="<option value=''></option>";for(var i=0,length=languages.length;i<length;i++){var culture=languages[i];html+="<option value='"+culture.TwoLetterISOLanguageName+"'>"+culture.DisplayName+"</option>"}select.innerHTML=html}(context.querySelector("#selectLanguage"),languages),function(select,allCountries){var html="";html+="<option value=''></option>";for(var i=0,length=allCountries.length;i<length;i++){var culture=allCountries[i];html+="<option value='"+culture.TwoLetterISORegionName+"'>"+culture.DisplayName+"</option>"}select.innerHTML=html}(context.querySelector("#selectCountry"),countries);var apiClient=connectionManager.getApiClient(item);!function(context,item,apiClient){(item.Path?showElement:hideElement)("#fldPath",context),("Series"===item.Type||"Movie"===item.Type||"Trailer"===item.Type?showElement:hideElement)("#fldOriginalName",context),"Audio"===item.Type?(hideElement(".fldSortName",context),setRequired(context.querySelector(".txtSortName"),!1)):(showElement(".fldSortName",context),setRequired(context.querySelector(".txtSortName"),apiClient.isMinServerVersion("4.7.0.9"))),("Series"===item.Type?showElement:hideElement)("#fldSeriesRuntime",context),("Series"===item.Type||"Person"===item.Type?showElement:hideElement)("#fldEndDate",context),("MusicAlbum"===item.Type?showElement:hideElement)("#albumAssociationMessage",context),("Movie"===item.Type||"Trailer"===item.Type||"Series"===item.Type?showElement:hideElement)("#fldCriticRating",context),("Series"===item.Type?showElement:hideElement)("#fldStatus",context),("Video"===item.MediaType&&"TvChannel"!==item.Type?showElement:hideElement)("#fld3dFormat",context),("Audio"===item.Type?showElement:hideElement)("#fldAlbumArtist",context),("TvChannel"===item.Type&&apiClient.isMinServerVersion("4.6.0.44")?showElement:hideElement)(".fldChannelNumber",context),"Audio"===item.Type||"MusicVideo"===item.Type?(showElement("#fldArtist",context),showElement("#fldAlbum",context)):(hideElement("#fldArtist",context),hideElement("#fldAlbum",context)),("Episode"===item.Type&&0===item.ParentIndexNumber?showElement:hideElement)("#collapsibleSpecialEpisodeInfo",context),("Person"===item.Type||"Genre"===item.Type||"Studio"===item.Type||"GameGenre"===item.Type||"MusicGenre"===item.Type||"TvChannel"===item.Type||"Book"===item.Type?hideElement:showElement)("#peopleCollapsible",context),"Person"===item.Type||"Genre"===item.Type||"Studio"===item.Type||"GameGenre"===item.Type||"MusicGenre"===item.Type||"TvChannel"===item.Type?(hideElement("#fldCommunityRating",context),hideElement("#genresCollapsible",context),hideElement("#studiosCollapsible",context),("TvChannel"===item.Type?showElement:hideElement)("#fldOfficialRating",context),hideElement("#fldCustomRating",context)):(showElement("#fldCommunityRating",context),showElement("#genresCollapsible",context),showElement("#studiosCollapsible",context),showElement("#fldOfficialRating",context),showElement("#fldCustomRating",context)),showElement("#tagsCollapsible",context),"TvChannel"===item.Type?(hideElement("#metadataSettingsCollapsible",context),hideElement("#fldPremiereDate",context),hideElement("#fldDateAdded",context),hideElement("#fldYear",context)):(showElement("#metadataSettingsCollapsible",context),showElement("#fldPremiereDate",context),showElement("#fldDateAdded",context),showElement("#fldYear",context)),("TvChannel"===item.Type?hideElement:showElement)(".overviewContainer",context),"Person"===item.Type?(context.querySelector("#txtProductionYear").label(globalize.translate("LabelBirthYear")),context.querySelector("#txtPremiereDate").label(globalize.translate("LabelBirthDate")),context.querySelector("#txtEndDate").label(globalize.translate("LabelDeathDate")),showElement("#fldPlaceOfBirth")):(context.querySelector("#txtProductionYear").label(globalize.translate("LabelYear")),context.querySelector("#txtPremiereDate").label(globalize.translate("LabelReleaseDate")),context.querySelector("#txtEndDate").label(globalize.translate("LabelEndDate")),hideElement("#fldPlaceOfBirth")),"Audio"===item.Type||"Episode"===item.Type||"Season"===item.Type?(showElement("#fldIndexNumber"),"Episode"===item.Type?context.querySelector("#txtIndexNumber").label(globalize.translate("LabelEpisodeNumber")):"Season"===item.Type?context.querySelector("#txtIndexNumber").label(globalize.translate("LabelSeasonNumber")):"Audio"===item.Type?context.querySelector("#txtIndexNumber").label(globalize.translate("LabelTrackNumber")):context.querySelector("#txtIndexNumber").label(globalize.translate("LabelNumber"))):hideElement("#fldIndexNumber"),"Audio"===item.Type||"Episode"===item.Type?(showElement("#fldParentIndexNumber"),"Episode"===item.Type?context.querySelector("#txtParentIndexNumber").label(globalize.translate("LabelSeasonNumber")):"Audio"===item.Type?context.querySelector("#txtParentIndexNumber").label(globalize.translate("LabelDiscNumber")):context.querySelector("#txtParentIndexNumber").label(globalize.translate("LabelParentNumber"))):hideElement("#fldParentIndexNumber",context),"BoxSet"===item.Type?(showElement("#fldDisplayOrder",context),hideElement(".seriesDisplayOrderDescription",context),context.querySelector("#selectDisplayOrder").innerHTML='<option value="SortName">'+globalize.translate("SortName")+'</option><option value="PremiereDate">'+globalize.translate("ReleaseDate")+"</option>"):"Series"===item.Type?(showElement("#fldDisplayOrder",context),showElement(".seriesDisplayOrderDescription",context),context.querySelector("#selectDisplayOrder").innerHTML='<option value="aired">'+globalize.translate("Aired")+'</option><option value="absolute">'+globalize.translate("Absolute")+'</option><option value="dvd">Dvd</option>'):(context.querySelector("#selectDisplayOrder").innerHTML="",hideElement("#fldDisplayOrder",context))}(context,item,apiClient),checkDateTimeInput("date")?checkDateTimeInput("datetime-local")||context.querySelector("#txtDateAdded").setAttribute("type","date"):(context.querySelector("#txtDateAdded").setAttribute("type","text"),context.querySelector("#txtPremiereDate").setAttribute("type","text"),context.querySelector("#txtEndDate").setAttribute("type","text")),"TvChannel"===item.Type&&apiClient.isMinServerVersion("4.6.0.44")&&fillChannelMapping(context,item,apiClient),fillItemInfo(context,item,apiClient,metadataEditorInfo.ParentalRatingOptions),("Video"===item.MediaType&&"Episode"!==item.Type&&"TvChannel"!==item.Type||"Series"===item.Type||"Game"===item.Type?showElement:hideElement)("#fldTagline",context),loading.hide()})}function show(itemId,serverId,resolve,reject){loading.show(),require(["text!./metadataeditor.template.html"],function(template){var dialogOptions={removeOnClose:!0,scrollY:!1};layoutManager.tv?dialogOptions.size="fullscreen":dialogOptions.size="medium-tall";var dlg=dialogHelper.createDialog(dialogOptions);dlg.classList.add("formDialog");var html="";html+=globalize.translateDocument(template,"sharedcomponents"),dlg.innerHTML=html,function(context){for(var elems=context.querySelectorAll(".dayText"),date=new Date;0<date.getDay();)date.setDate(date.getDate()-1);for(var i=0,length=elems.length;i<length;i++)elems[i].innerHTML=datetime.toLocaleDateString(date,{weekday:"long"}),date.setDate(date.getDate()+1)}(dlg),dialogHelper.open(dlg),dlg.addEventListener("close",function(){(hasChanges?resolve:reject)()}),init(currentContext=dlg,connectionManager.getApiClient(serverId)),reload(dlg,itemId,serverId)})}return{show:function(itemId,serverId){return new Promise(function(resolve,reject){return show(itemId,serverId,resolve,reject)})},embed:function(elem,itemId,serverId){return new Promise(function(resolve,reject){loading.show(),require(["text!./metadataeditor.template.html"],function(template){elem.innerHTML=globalize.translateDocument(template,"sharedcomponents"),elem.querySelector(".formDialogFooter").classList.remove("formDialogFooter"),elem.querySelector(".btnHeaderSave").classList.remove("hide"),elem.querySelector(".btnCancel").classList.add("hide"),init(currentContext=elem,connectionManager.getApiClient(serverId)),reload(elem,itemId,serverId),focusManager.autoFocus(elem)})})}}});