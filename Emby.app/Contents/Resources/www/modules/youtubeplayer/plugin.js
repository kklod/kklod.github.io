define(["require","events","appRouter","loading","queryString"],function(require,events,appRouter,loading,queryString){"use strict";function clearTimeUpdateInterval(instance){instance.timeUpdateInterval&&clearInterval(instance.timeUpdateInterval),instance.timeUpdateInterval=null}function onEndedInternal(instance){clearTimeUpdateInterval(instance);var resizeListener=instance.resizeListener;resizeListener&&(window.removeEventListener("resize",resizeListener),window.removeEventListener("orientationChange",resizeListener),instance.resizeListener=null);var stopInfo={src:instance._currentSrc};events.trigger(instance,"stopped",[stopInfo]),instance._currentSrc=null,instance.currentYoutubePlayer&&instance.currentYoutubePlayer.destroy(),instance.currentYoutubePlayer=null}function onPlayerReady(event){event.target.playVideo()}function onPlaying(instance,playOptions,resolve){instance.started||(instance.started=!0,resolve(),clearTimeUpdateInterval(instance),instance.timeUpdateInterval=setInterval(function(e){events.trigger(this,"timeupdate")}.bind(instance),500),playOptions.fullscreen?appRouter.showVideoOsd().then(function(){instance.videoDialog.classList.remove("onTop")}):(appRouter.setTransparency("backdrop"),instance.videoDialog.classList.remove("onTop")),require(["loading"],function(loading){loading.hide()}))}function setCurrentSrc(instance,elem,options){return new Promise(function(resolve,reject){instance._currentSrc=options.url,console.log("youtube playing: "+options.url);var tag,firstScriptTag,params=queryString.parse(options.url.split("?")[1]);window.onYouTubeIframeAPIReady=function(){instance.currentYoutubePlayer=new YT.Player("player",{height:instance.videoDialog.offsetHeight,width:instance.videoDialog.offsetWidth,videoId:params.v,events:{onReady:onPlayerReady,onStateChange:function(event){event.data===YT.PlayerState.PLAYING?(reject=null,onPlaying(instance,options,resolve)):event.data===YT.PlayerState.ENDED?onEndedInternal(instance):event.data===YT.PlayerState.PAUSED&&events.trigger(instance,"pause")},onError:function(event){console.log("youtubeplayer, received error code during playback : "+event.data),reject?reject():events.trigger(instance,"error")}},playerVars:{controls:0,enablejsapi:1,modestbranding:1,rel:0,showinfo:0,fs:0,playsinline:1}});var resizeListener=instance.resizeListener;resizeListener?window.removeEventListener("resize",resizeListener):resizeListener=instance.resizeListener=function(){var player=this.currentYoutubePlayer,dlg=this.videoDialog;player&&dlg&&player.setSize(dlg.offsetWidth,dlg.offsetHeight)}.bind(instance),window.addEventListener("resize",resizeListener),window.removeEventListener("orientationChange",resizeListener),window.addEventListener("orientationChange",resizeListener)},window.YT?window.onYouTubeIframeAPIReady():((tag=document.createElement("script")).src="https://www.youtube.com/iframe_api",(firstScriptTag=document.getElementsByTagName("script")[0]).parentNode.insertBefore(tag,firstScriptTag))})}function YoutubePlayer(){this.name="Youtube Player",this.type="mediaplayer",this.id="youtubeplayer",this.priority=1}return YoutubePlayer.prototype.play=function(options){this.started=!1;var instance=this;return function(instance,options){var dlg=document.querySelector(".youtubePlayerContainer");return dlg?Promise.resolve(dlg.querySelector("#player")):require(["css!./style"]).then(function(){loading.show();var dlg=document.createElement("div");dlg.classList.add("youtubePlayerContainer"),options.fullscreen&&dlg.classList.add("onTop"),dlg.innerHTML='<div id="player"></div>';var videoElement=dlg.querySelector("#player");return document.body.insertBefore(dlg,document.body.firstChild),instance.videoDialog=dlg,Promise.resolve(videoElement)})}(this,options).then(function(elem){return setCurrentSrc(instance,0,options)})},YoutubePlayer.prototype.stop=function(destroyPlayer){return this._currentSrc&&(this.currentYoutubePlayer&&this.currentYoutubePlayer.stopVideo(),onEndedInternal(this),destroyPlayer&&this.destroy()),Promise.resolve()},YoutubePlayer.prototype.destroy=function(){appRouter.setTransparency("none");var dlg=this.videoDialog;dlg&&(this.videoDialog=null,dlg.parentNode.removeChild(dlg))},YoutubePlayer.prototype.canPlayMediaType=function(mediaType){return"audio"===(mediaType=(mediaType||"").toLowerCase())||"video"===mediaType},YoutubePlayer.prototype.canPlayItem=function(item){return!1},YoutubePlayer.prototype.canPlayUrl=function(url){return-1!==url.toLowerCase().indexOf("youtube.com")},YoutubePlayer.prototype.getDeviceProfile=function(){return Promise.resolve({})},YoutubePlayer.prototype.currentSrc=function(){return this._currentSrc},YoutubePlayer.prototype.setSubtitleStreamIndex=function(index){},YoutubePlayer.prototype.canSetAudioStreamIndex=function(){return!1},YoutubePlayer.prototype.setAudioStreamIndex=function(index){},YoutubePlayer.prototype.currentTime=function(val){var currentYoutubePlayer=this.currentYoutubePlayer;if(currentYoutubePlayer)return null!=val?void currentYoutubePlayer.seekTo(val/1e3,!0):1e3*currentYoutubePlayer.getCurrentTime()},YoutubePlayer.prototype.duration=function(val){var currentYoutubePlayer=this.currentYoutubePlayer;return currentYoutubePlayer?1e3*currentYoutubePlayer.getDuration():null},YoutubePlayer.prototype.pause=function(){var instance,currentYoutubePlayer=this.currentYoutubePlayer;currentYoutubePlayer&&(currentYoutubePlayer.pauseVideo(),instance=this,setTimeout(function(){events.trigger(instance,"pause")},200))},YoutubePlayer.prototype.unpause=function(){var instance,currentYoutubePlayer=this.currentYoutubePlayer;currentYoutubePlayer&&(currentYoutubePlayer.playVideo(),instance=this,setTimeout(function(){events.trigger(instance,"unpause")},200))},YoutubePlayer.prototype.paused=function(){var currentYoutubePlayer=this.currentYoutubePlayer;return!!currentYoutubePlayer&&2===currentYoutubePlayer.getPlayerState()},YoutubePlayer.prototype.volume=function(val){return null!=val?this.setVolume(val):this.getVolume()},YoutubePlayer.prototype.setVolume=function(val){var currentYoutubePlayer=this.currentYoutubePlayer;currentYoutubePlayer&&null!=val&&currentYoutubePlayer.setVolume(val)},YoutubePlayer.prototype.getVolume=function(){var currentYoutubePlayer=this.currentYoutubePlayer;if(currentYoutubePlayer)return currentYoutubePlayer.getVolume()},YoutubePlayer.prototype.setMute=function(mute){var currentYoutubePlayer=this.currentYoutubePlayer;mute?currentYoutubePlayer&&currentYoutubePlayer.mute():currentYoutubePlayer&&currentYoutubePlayer.unMute()},YoutubePlayer.prototype.isMuted=function(){var currentYoutubePlayer=this.currentYoutubePlayer;if(currentYoutubePlayer)return currentYoutubePlayer.isMuted()},YoutubePlayer});