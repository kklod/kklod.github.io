define(["exports","./../dom.js","./../layoutmanager.js","./../browser.js"],function(_exports,_dom,_layoutmanager,_browser){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_dom=babelHelpers.interopRequireDefault(_dom),_layoutmanager=babelHelpers.interopRequireDefault(_layoutmanager),_browser=babelHelpers.interopRequireDefault(_browser);var cores,enableAnimation=!((cores=navigator.hardwareConcurrency||4)<4)&&(!((2400<=(screen.width||screen.availWidth||0)||1400<=(screen.height||screen.availHeight||0))&&cores<6)&&(!!CSS.supports("transition","all")&&(!!CSS.supports("transform","scale(1)")&&(!!_dom.default.supportsEventListenerOnce()&&!!document.documentElement.animate)))),baseEventName="transition";function clearAnimationState(elem){elem.classList.remove("backgroundContainer","animatedView-in","animatedView-out","animatedView-top")}var currentRequestId=0;function getTransitionPromise(instance,e){if(!instance.hidesPreviousView)return Promise.resolve();var detail=e.detail,previousView=detail.previousView;if(!previousView)return Promise.resolve();var elem,isBack=detail.isBack,newView=instance.view,animationStartElement=isBack?null:elem=(elem=document.activeElement)&&elem.closest(".card,.listItem"),animationEndElement=isBack&&previousView?previousView.animationSourceElement:null;return _layoutmanager.default.tv||animationEndElement?(animationStartElement&&(newView.animationSourceElement=animationStartElement),function(newAnimatedPage,oldAnimatedPage,isBack){return oldAnimatedPage===newAnimatedPage?(clearAnimationState(newAnimatedPage),Promise.resolve()):new Promise(function(resolve,reject){var elemForEvents,timeout,transitionRequestId=currentRequestId++;oldAnimatedPage&&isBack&&(elemForEvents=oldAnimatedPage,newAnimatedPage.classList.add("animatedView-out","animatedView-top"),newAnimatedPage.classList.remove("hide"),oldAnimatedPage.offsetWidth),elemForEvents||((elemForEvents=newAnimatedPage).classList.add("backgroundContainer","animatedView-in","animatedView-top"),oldAnimatedPage.classList.remove("animatedView-top"),oldAnimatedPage.classList.add("backgroundContainer","animatedView-out"),elemForEvents.offsetWidth);var onDone=function(e){var target=e?e.target:null;target&&target!==e.currentTarget||elemForEvents.currentRequestId===transitionRequestId&&(target&&(_dom.default.removeEventListener(target,baseEventName+"cancel",onDone,{once:!0,passive:!0}),_dom.default.removeEventListener(target,baseEventName+"end",onDone,{once:!0,passive:!0})),clearTimeout(timeout),oldAnimatedPage===elemForEvents?(oldAnimatedPage.classList.add("hide"),oldAnimatedPage.classList.remove("backgroundContainer","animatedView-in")):(elemForEvents.classList.remove("backgroundContainer"),oldAnimatedPage&&(oldAnimatedPage.classList.add("hide"),oldAnimatedPage.classList.remove("backgroundContainer","animatedView-in"))),resolve())};_dom.default.addEventListener(elemForEvents,baseEventName+"cancel",onDone,{once:!0,passive:!0}),_dom.default.addEventListener(elemForEvents,baseEventName+"end",onDone,{once:!0,passive:!0}),timeout=setTimeout(onDone,elemForEvents.transitionDurationMs),elemForEvents.currentRequestId=transitionRequestId,requestAnimationFrame(function(){elemForEvents===oldAnimatedPage?(newAnimatedPage.classList.remove("animatedView-out","animatedView-top"),oldAnimatedPage.classList.add("backgroundContainer","animatedView-in","animatedView-top")):newAnimatedPage.classList.remove("animatedView-in")})})}(newView,previousView,isBack)):(newView.animationSourceElement=null,clearAnimationState(newView),previousView&&(previousView.animationSourceElement=null,clearAnimationState(previousView),previousView.classList.add("hide")),Promise.resolve())}function BaseView(view,params){this.view=view,this.params=params,this.scroller="emby-scroller"===view.getAttribute("is")?view:view.querySelector(".viewScroller"),enableAnimation&&_layoutmanager.default.tv&&(this.hidesPreviousView=!0,_layoutmanager.default.tv?_browser.default.android?(view.classList.add("animatedView","animatedView-fade"),view.transitionDurationMs=300):(view.classList.add("animatedView","animatedView-scale"),view.transitionDurationMs=400):(view.classList.add("animatedView","animatedView-fade","animatedView-autodisable"),view.transitionDurationMs=300)),view.addEventListener("viewbeforeshow",function(e){this.transitionPromise=getTransitionPromise(this,e);var resumeOptions={refresh:!e.detail.isRestored};this.onBeginResume(resumeOptions)}.bind(this)),view.addEventListener("viewshow",function(e){var instance=this,resumeOptions={refresh:!e.detail.isRestored};this.transitionPromise.then(function(){instance.onResume(resumeOptions)})}.bind(this)),view.addEventListener("viewbeforehide",function(e){this.onPause()}.bind(this)),view.addEventListener("viewdestroy",this.destroy.bind(this))}BaseView.prototype.enableTransitions=function(){return!1},BaseView.prototype.onBeginResume=function(options){var scroller=this.scroller;scroller&&scroller.beginResume&&scroller.beginResume()},BaseView.prototype.onResume=function(options){this.paused=!1;var scroller=this.scroller;scroller&&scroller.resume&&scroller.resume()},BaseView.prototype.onPause=function(){this.paused=!0;var scroller=this.scroller;scroller&&scroller.pause&&scroller.pause()},BaseView.prototype.destroy=function(){this.animationSourceElement=null,this.scroller=null,this.view=null,this.params=null,this.paused=null},_exports.default=BaseView});