define(["exports","./browser.js","./common/appsettings.js","./emby-apiclient/events.js"],function(_exports,_browser,_appsettings,_events){function containsGreaseChar(value){return value.includes("\\")||value.includes("/")||value.includes(";")||value.includes('"')||value.toLowerCase().includes("brand")}function isGenericBrand(value){return(value=value.toLowerCase()).includes("chromium")?1:void 0}function compareBrands(a,b){var aName=a.brand||"",bName=b.brand||"";return containsGreaseChar(aName)&&!containsGreaseChar(bName)?1:!containsGreaseChar(aName)&&containsGreaseChar(bName)?-1:isGenericBrand(aName)&&!isGenericBrand(bName)?1:!isGenericBrand(aName)&&isGenericBrand(bName)||aName<bName?-1:bName<aName?1:0}function map(i){return i}function getDeviceName(){var deviceName,brands;return _browser.default.tizen?(deviceName="Samsung Smart TV",deviceName+=self.webapis&&self.webapis.productinfo?" ("+self.webapis.productinfo.getRealModel()+")":"",Promise.resolve(deviceName)):_browser.default.orsay?(document.getElementById=document.nativeGetElementById||document.getElementById,deviceName=self.webapis&&self.webapis.platform||"Samsung Smart TV",deviceName+=self.webapis&&self.webapis._plugin?" ("+self.webapis._plugin("TV","GetProductCode")+")":"",Promise.resolve(deviceName)):self.webos||self.PalmSystem?new Promise(function(resolve){require(["native/webos/webOSTV"],function(){webOS.deviceInfo(function(device){deviceName="LG Smart TV",deviceName+=0<device.modelName.length?" ("+device.modelName+")":"",resolve(deviceName)})})}):self.Windows?Promise.resolve(function(){try{var currentDeviceInfo=new Windows.Security.ExchangeActiveSyncProvisioning.EasClientDeviceInformation;if(currentDeviceInfo.friendlyName&&currentDeviceInfo.friendlyName.length)return currentDeviceInfo.friendlyName}catch(err){}return"Windows.Xbox"!==Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily?"Windows":"Xbox One"}()):_browser.default.operaTv?Promise.resolve("Opera TV"):(deviceName||(brands=Array.prototype.map.call(navigator.userAgentData.brands||[],map).sort(compareBrands)).length&&(deviceName=brands[0].brand),deviceName=deviceName||"Web Browser",navigator.userAgentData.getHighEntropyValues(["platform"]).then(function(values){return values.platform&&(deviceName+=" "+values.platform),Promise.resolve(deviceName)}))}function hasPhysicalBackButton(){if(!_browser.default.electron&&!navigator.standalone){if(_browser.default.tv)return 1;if("windows"!==self.appMode&&"winjs"!==self.appMode)return _browser.default.iOS&&!function(){try{return window.self!==window.top}catch(e){return 1}}()}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_browser=babelHelpers.interopRequireDefault(_browser),_appsettings=babelHelpers.interopRequireDefault(_appsettings),_events=babelHelpers.interopRequireDefault(_events);var deviceId,deviceName,supportedFeatures=function(){var features={};navigator.share&&(features.sharing=!0),"windows"===self.appMode||"winjs"===self.appMode||_browser.default.tv||(features.filedownload=!0),(_browser.default.operaTv||_browser.default.tizen||_browser.default.orsay||_browser.default.web0s||_browser.default.netcast)&&(features.exit=!0),_browser.default.web0s||_browser.default.netcast||(features.exitmenu=!0),_browser.default.web0s||_browser.default.netcast||_browser.default.tizen||(features.plugins=!0,features.screensaver=!0),_browser.default.operaTv||_browser.default.tizen||_browser.default.orsay||_browser.default.web0s||_browser.default.netcast||_browser.default.playstation||(features.externallinks=!0,features.externalpremium=!0),_browser.default.operaTv||(features.externallinkdisplay=!0,features.externalappinfo=!0),_browser.default.tv||(features.displaymode=!0),"windows"!==self.appMode&&"winjs"!==self.appMode||_browser.default.xboxOne||(features.sync=!0),function(){if(!_browser.default.tv&&"undefined"!=typeof document){var element=document.documentElement;return element.requestFullscreen||element.mozRequestFullScreen||element.webkitRequestFullscreen||element.msRequestFullscreen||!!document.createElement("video").webkitEnterFullscreen}}()&&(features.fullscreenchange=!0),_browser.default.tizen||_browser.default.web0s||_browser.default.netcast||!self.AudioContext&&!self.webkitAudioContext||!document.createElement("audio").canPlayType("audio/mp3").replace(/no/,"")||(features.soundeffects=!0),("winjs"===self.appMode||"windows"===self.appMode||_browser.default.operaTv||_browser.default.tizen||_browser.default.orsay||_browser.default.web0s||_browser.default.netcast||0===self.location.href.toLowerCase().indexOf("https"))&&(features.connectsignup=!0);var isLocalServer=!self.appMode;return isLocalServer||(features.multiserver=!0,_browser.default.electron||"https:"===(self.location||{}).protocol&&(features.rejectinsecureaddresses=!0)),_browser.default.tv&&(features.physicalvolumecontrol=!0,features.nativevolumeosd=!0),_browser.default.tv||(features.remotecontrol=!0),_browser.default.operaTv||_browser.default.tizen||_browser.default.orsay||_browser.default.web0s||_browser.default.netcast||"windows"===self.appMode||"winjs"===self.appMode||(features.remotevideo=!0),features.otherapppromotions=!0,features.targetblank=!0,_browser.default.orsay||_browser.default.netcast||(features.subtitleappearancesettings=!0),_browser.default.tv||(features.fileinput=!0),self.Windows&&Windows.System&&"Windows.Xbox"===Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily||(features.youtube=!0),_browser.default.chrome&&(features.chromecast=!0),function(){if(self.matchMedia)try{var isDarkMode=window.matchMedia("(prefers-color-scheme: dark)").matches,isLightMode=window.matchMedia("(prefers-color-scheme: light)").matches,isNotSpecified=window.matchMedia("(prefers-color-scheme: no-preference)").matches;return!(!isDarkMode&&!isLightMode&&!isNotSpecified)}catch(err){return}}()&&(features.preferredtheme=!0),self.tizen||self.webOS||"windows"===self.appMode||"winjs"===self.appMode||(features.premiereinheader=!0),_browser.default.tizen||_browser.default.web0s||_browser.default.netcast||(features.keyboardsettings=!0),hasPhysicalBackButton()&&(features.physicalbackbutton=!0),self.tizen||_browser.default.operaTv||_browser.default.web0s||_browser.default.orsay||_browser.default.netcast||(features.serversetup=!0),"standalone"!==self.appMode||_browser.default.tv||self.webOS||self.tizen||_browser.default.orsay||_browser.default.netcast||!(!_browser.default.operaTv&!_browser.default.playstation)||isLocalServer||(features.redirecttolocalserver=!0),features}();var appVersion,visibilityChange,visibilityState,appName=_browser.default.electron?"Emby Theater":_browser.default.netcast||_browser.default.web0s?"Emby for LG":_browser.default.tizen||_browser.default.orsay?"Emby for Samsung":"windows"===self.appMode||"winjs"===self.appMode?"Emby for Windows":"Emby Web",appHost={getWindowState:function(){return document.windowState||"Normal"},setWindowState:function(state){throw new Error("setWindowState is not supported and should not be called")},exit:function(){if(_events.default.trigger(this,"beforeexit"),window.NetCastExit)try{window.NetCastExit()}catch(err){console.log("error closing application: "+err)}else if(window.webOS)try{webOS.platformBack()}catch(err){console.log("error closing application: "+err)}else if(window.tizen)try{tizen.application.getCurrentApplication().exit()}catch(err){console.log("error closing application: "+err)}else if(_browser.default.orsay)try{sf.core.exit(!0)}catch(err){console.log("error closing application: "+err)}else window.close()},supports:function(command){return supportedFeatures[command]},moreIcon:"dots-horiz",getSyncProfile:function(){return require(["browserdeviceprofile"]).then(function(responses){return(0,responses[0])({maxStaticMusicBitrate:_appsettings.default.maxStaticMusicBitrate()})})},init:function(){return function(){if(self.Windows&&Windows.System){try{var sysIdInfo=Windows.System.Profile.SystemIdentification.getSystemIdForPublisher();if(0<sysIdInfo.id.length){var sysIdString=Windows.Security.Cryptography.CryptographicBuffer.encodeToBase64String(sysIdInfo.id);return sysIdString=(sysIdString=(sysIdString=sysIdString.replaceAll("+","")).replaceAll("/","")).replaceAll("=",""),Promise.resolve(sysIdString)}}catch(ex){}var easInfo=new Windows.Security.ExchangeActiveSyncProvisioning.EasClientDeviceInformation;return Promise.resolve(easInfo.id)}var key="_deviceId2",deviceId=_appsettings.default.get(key);return deviceId||(deviceId=crypto.randomUUID(),_appsettings.default.set(key,deviceId)),Promise.resolve(deviceId)}().then(function(generatedDeviceId){return getDeviceName().then(function(generatedDeviceName){return function(){if(self.Windows&&Windows.ApplicationModel){var version=Windows.ApplicationModel.Package.current.id.version;return Promise.resolve(version.major+"."+version.minor+"."+version.build+"."+version.revision)}return self.tizen&&self.tizen.application&&tizen.application.getAppInfo?Promise.resolve(tizen.application.getAppInfo().version):self.curWidget&&self.curWidget.version?Promise.resolve(self.curWidget.version):self.webOS&&self.webOS.fetchAppInfo?new Promise(function(resolve){self.webOS.fetchAppInfo(function(info){resolve(info.version)})}):Promise.resolve(self.dashboardVersion||"3.0.0")}().then(function(generatedAppVersion){deviceId=generatedDeviceId,deviceName=generatedDeviceName,appVersion=generatedAppVersion})})})},deviceName:function(){return deviceName},deviceId:function(){return deviceId},appName:function(){return appName},appVersion:function(){return appVersion},getPushTokenInfo:function(){return{}},setTheme:function(themeSettings){var metaThemeColor=document.querySelector("meta[name=theme-color]");metaThemeColor&&metaThemeColor.setAttribute("content",themeSettings.themeColor)},setUserScalable:function(scalable){var att;_browser.default.tv||(att=scalable?"viewport-fit=cover, width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes":"viewport-fit=cover, width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no",document.querySelector("meta[name=viewport]").setAttribute("content",att))},deviceIconUrl:function(){return _browser.default.xboxOne?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/xboxone.png":"windows"===self.appMode||"winjs"===self.appMode?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/windowsrt.png":_browser.default.opera||_browser.default.operaTv?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/opera.png":_browser.default.orsay||_browser.default.tizen?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/samsungtv.png":_browser.default.web0s||_browser.default.netcast?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/lgtv.png":_browser.default.playstation?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/playstation.png":_browser.default.chromecast?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/chromecast.png":_browser.default.chrome?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/chrome.png":_browser.default.firefox?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/firefox.png":_browser.default.safari?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/safari.png":"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/html5.png"},getPreferredTheme:function(){try{if(window.matchMedia("(prefers-color-scheme: dark)").matches)return"dark";if(window.matchMedia("(prefers-color-scheme: light)").matches)return"light"}catch(err){}return null},getKeyOptions:function(){var backKeys=[];return(_browser.default.web0s||_browser.default.netcast)&&backKeys.push(461),self.Windows&&(backKeys.push(8),backKeys.push(196)),_browser.default.orsay||backKeys.push(27),{keyMaps:{back:backKeys},handleAltLeftBack:!!self.Windows,handleAltRightForward:!!self.Windows}},getDefaultLayout:function(){if(self.Windows&&Windows.System)switch(Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily){case"Windows.Desktop":return Windows.UI.ViewManagement.UIViewSettings.getForCurrentView().userInteractionMode===Windows.UI.ViewManagement.UserInteractionMode.touch?"mobile":"desktop";case"Windows.Mobile":return"mobile";case"Windows.Xbox":return"tv";default:return"mobile"}return null}},doc=self.document;doc&&(void 0!==doc.visibilityState?(visibilityChange="visibilitychange",visibilityState="hidden"):void 0!==doc.mozHidden?(visibilityChange="mozvisibilitychange",visibilityState="mozVisibilityState"):void 0!==doc.msHidden?(visibilityChange="msvisibilitychange",visibilityState="msVisibilityState"):void 0!==doc.webkitHidden&&(visibilityChange="webkitvisibilitychange",visibilityState="webkitVisibilityState"));var _isHidden=!1;function onAppVisible(){_isHidden&&(_isHidden=!1,_events.default.trigger(appHost,"resume"))}function onAppHidden(){_isHidden=_isHidden||!0}doc&&doc.addEventListener(visibilityChange,function(){(document[visibilityState]?onAppHidden:onAppVisible)()}),self.addEventListener&&doc&&(self.addEventListener("focus",onAppVisible),self.addEventListener("blur",onAppHidden)),_exports.default=appHost});