define(["exports","./../emby-apiclient/connectionmanager.js","./../approuter.js","./../dialog/dialog.js","./globalize.js","./dialogs/confirm.js","./dialogs/alert.js"],function(_exports,_connectionmanager,_approuter,_dialog,_globalize,_confirm,_alert){function onItemDeleted(options,serverId,parentId){"back"===options.navigate?_approuter.default.back():options.navigate&&(parentId?_approuter.default.showItem(parentId,serverId):_approuter.default.goHome())}function deleteItemInternal(item,apiClient,options){var itemId=item.Id;return apiClient.getDeleteInfo(itemId).then(function(deleteInfo){var msg;return deleteInfo.Paths.length?(msg=_globalize.default.translate("ConfirmDeleteItem"),msg+="\n\n"+_globalize.default.translate("FollowingFilesWillBeDeleted")+"\n"+deleteInfo.Paths.join("\n"),msg+="\n\n"+_globalize.default.translate("AreYouSureToContinue")):msg=_globalize.default.translate("DeleteItemConfirmation",item.Name),(0,_confirm.default)({title:_globalize.default.translate("HeaderDeleteItem"),text:msg,confirmText:_globalize.default.translate("Delete"),primary:"cancel"}).then(function(){var parentId=item.SeasonId||item.SeriesId||item.ParentId,serverId=item.ServerId;return apiClient.deleteItem(item).then(function(){return onItemDeleted(options,serverId,parentId)},function(err){function result(){return Promise.reject(err)}var options;return options=_globalize.default.translate("ErrorDeletingItem"),(0,_alert.default)(options).then(result,result)})})})}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_connectionmanager=babelHelpers.interopRequireDefault(_connectionmanager),_approuter=babelHelpers.interopRequireDefault(_approuter),_dialog=babelHelpers.interopRequireDefault(_dialog),_globalize=babelHelpers.interopRequireDefault(_globalize),_confirm=babelHelpers.interopRequireDefault(_confirm),_alert=babelHelpers.interopRequireDefault(_alert);var _default={deleteItem:function(options){var item=options.item,apiClient=_connectionmanager.default.getApiClient(item);return"Device"===item.Type?function(item,apiClient,options){return(0,_confirm.default)({text:_globalize.default.translate("DeleteDeviceConfirmation"),title:_globalize.default.translate("HeaderDeleteDevice"),confirmText:_globalize.default.translate("Delete"),primary:"cancel"}).then(function(){return apiClient.ajax({type:"DELETE",url:apiClient.getUrl("Devices",{Id:item.Id})}).then(function(){return onItemDeleted(options)})})}(item,apiClient,options):"Server"===item.Type?function(item,options){return(0,_confirm.default)({text:_globalize.default.translate("DeleteServerConfirmation",item.Name),title:_globalize.default.translate("HeaderDeleteServer"),confirmText:_globalize.default.translate("Delete"),primary:"cancel"}).then(function(){return _connectionmanager.default.deleteServer(item.Id).then(function(){return onItemDeleted(options)})})}(item,options):"User"===item.Type?function(item,apiClient,options){return(0,_confirm.default)({text:_globalize.default.translate("DeleteUserConfirmation",item.Name),title:_globalize.default.translate("HeaderDeleteUser"),confirmText:_globalize.default.translate("Delete"),primary:"cancel"}).then(function(){return apiClient.deleteUser(item.Id).then(function(){return onItemDeleted(options)})})}(item,apiClient,options):"LiveTVTunerDevice"===item.Type?function(item,apiClient,options){return(0,_confirm.default)({title:_globalize.default.translate("HeaderDeleteDevice"),text:_globalize.default.translate("MessageConfirmDeleteTunerDevice"),confirmText:_globalize.default.translate("Delete"),primary:"cancel"}).then(function(){return apiClient.ajax({type:"DELETE",url:apiClient.getUrl("LiveTv/TunerHosts",{Id:item.Id})}).then(function(){return onItemDeleted(options)})})}(item,apiClient,options):"LiveTVGuideSource"===item.Type?function(item,apiClient,options){return(0,_confirm.default)({title:_globalize.default.translate("HeaderDeleteProvider"),text:_globalize.default.translate("MessageConfirmDeleteGuideProvider"),confirmText:_globalize.default.translate("Delete"),primary:"cancel"}).then(function(){return apiClient.ajax({type:"DELETE",url:apiClient.getUrl("LiveTv/ListingProviders",{Id:item.Id})}).then(function(){return onItemDeleted(options)})})}(item,apiClient,options):"ItemImage"===item.Type?function(item,apiClient){return(0,_confirm.default)({text:_globalize.default.translate("ConfirmDeleteImage"),confirmText:_globalize.default.translate("Delete"),primary:"cancel"}).then(function(){return apiClient.deleteItemImage(item.Id,item.ImageType,item.ImageIndex)})}(item,apiClient):"MediaStream"===item.Type&&"Subtitle"===item.StreamType?function(item,apiClient,options){var msg=_globalize.default.translate("MessageAreYouSureDeleteSubtitles");return(0,_confirm.default)({title:_globalize.default.translate("ConfirmDeletion"),text:msg,confirmText:_globalize.default.translate("Delete"),primary:"cancel"}).then(function(){var url="Videos/"+item.ItemId+"/Subtitles/"+item.Index;return apiClient.ajax({type:"DELETE",url:apiClient.getUrl(url)}).then(function(){return onItemDeleted(options)})})}(item,apiClient,options):"Plugin"===item.Type?function(item,apiClient,options){return(0,_confirm.default)({text:_globalize.default.translate("UninstallPluginConfirmation"),title:_globalize.default.translate("HeaderUninstallPlugin"),confirmText:_globalize.default.translate("Uninstall"),primary:"cancel"}).then(function(){return apiClient.uninstallPlugin(item.Id).then(function(){return onItemDeleted(options)})})}(item,apiClient,options):"ApiKey"===item.Type?function(item){return(0,_confirm.default)({text:_globalize.default.translate("MessageConfirmRevokeApiKey"),title:_globalize.default.translate("HeaderConfirmRevokeApiKey"),confirmText:_globalize.default.translate("Delete"),primary:"cancel"}).then(function(){var apiClient=_connectionmanager.default.getApiClient(item);return apiClient.ajax({type:"DELETE",url:apiClient.getUrl("Auth/Keys/"+item.AccessToken)})})}(item):("VirtualFolder"===item.Type?function(virtualFolder,apiClient,options){var msg=_globalize.default.translate("MessageAreYouSureYouWishToRemoveMediaFolder");return virtualFolder.Locations.length&&(msg+="<br/><br/>"+_globalize.default.translate("MessageTheFollowingLocationWillBeRemovedFromLibrary")+"<br/><br/>",msg+=virtualFolder.Locations.join("<br/>")),(0,_confirm.default)(msg,_globalize.default.translate("HeaderRemoveMediaFolder")).then(function(){var refreshAfterChange="true"===options.positionTo.closest(".page").getAttribute("data-refreshlibrary");return apiClient.removeVirtualFolder(virtualFolder,refreshAfterChange)})}:"Series"===item.Type&&apiClient.isMinServerVersion("4.5.0.3")?function(item,apiClient,options){return apiClient.getEpisodes(item.Id,{Limit:1,SortBy:"DatePlayed",SortOrder:"Descending",IsPlayed:!0,UserId:apiClient.getCurrentUserId(),ExcludeLocationTypes:"Virtual"}).then(function(result){return result.Items.length?(0,_dialog.default)({title:_globalize.default.translate("HeaderDeleteSeries"),text:"",buttons:[{name:_globalize.default.translate("Cancel"),id:"cancel",type:"submit"},{name:_globalize.default.translate("HeaderDeleteLastPlayedEpisode"),id:"deletelastplayed",type:"cancel"},{name:_globalize.default.translate("HeaderDeleteSeries"),id:"deleteseries",type:"cancel"}]}).then(function(id){return"deleteseries"===id?deleteItemInternal(item,apiClient,options):"deletelastplayed"===id?deleteItemInternal(result.Items[0],apiClient,options):Promise.reject()}):deleteItemInternal(item,apiClient,options)})}:deleteItemInternal)(item,apiClient,options)}};_exports.default=_default});