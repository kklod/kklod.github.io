define(["playbackManager","userSettings","connectionManager","events"],function(playbackManager,userSettings,connectionManager,events){"use strict";var currentOwnerId,currentPlayer;function playThemeMedia(items,ownerId){if(items.length){if(!currentOwnerId&&playbackManager.isPlaying())return;items.map(function(i){return i.Id}),playbackManager.play({items:items,fullscreen:!1,enableRemotePlayers:!1}).then(function(){currentOwnerId=ownerId})}else stopIfPlaying()}function stopIfPlaying(){currentOwnerId&&playbackManager.stop(),currentOwnerId=null}var excludeTypes=["CollectionFolder","UserView","Program","SeriesTimer","Person","TvChannel","Channel","User","Plugin","Device"];document.addEventListener("viewshow",function(e){currentPlayer&&!currentPlayer.isLocalPlayer||e.detail.supportsThemeMedia||playThemeMedia([],null)},!0),document.addEventListener("itemshow",function(e){var item;currentPlayer&&!currentPlayer.isLocalPlayer||(item=e.detail.item)&&item.ServerId&&function(item){var apiClient,enableThemeVideos;!item.CollectionType&&!excludeTypes.includes(item.Type)&&item.ServerId&&item.Id?(apiClient=connectionManager.getApiClient(item),enableThemeVideos=userSettings.enableThemeVideos(),apiClient.getThemeMedia(item.Id,{UserId:apiClient.getCurrentUserId(),InheritFromParent:!0,EnableThemeSongs:userSettings.enableThemeSongs(),EnableThemeVideos:enableThemeVideos}).then(function(themeMediaResult){var itemsResult=themeMediaResult.ThemeVideosResult.Items.length?themeMediaResult.ThemeVideosResult:themeMediaResult.ThemeSongsResult,ownerId=itemsResult.OwnerId;ownerId!==currentOwnerId&&playThemeMedia(itemsResult.Items,ownerId)})):stopIfPlaying()}(item)},!0),document.addEventListener("itemclear",function(e){currentPlayer&&!currentPlayer.isLocalPlayer||playThemeMedia([],null)},!0),events.on(playbackManager,"playerchange",function(e,player){currentPlayer=player})});