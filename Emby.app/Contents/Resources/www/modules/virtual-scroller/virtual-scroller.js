define(["exports","./../dom.js","./../layoutmanager.js","./../focusmanager.js","./../browser.js"],function(_exports,_dom,_layoutmanager,_focusmanager,_browser){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_dom=babelHelpers.interopRequireDefault(_dom),_layoutmanager=babelHelpers.interopRequireDefault(_layoutmanager),_focusmanager=babelHelpers.interopRequireDefault(_focusmanager),_browser=babelHelpers.interopRequireDefault(_browser);var rAF=requestAnimationFrame,cAF=cancelAnimationFrame,supportsCssTransforms=CSS.supports("transform","scale(1)"),supportsContentVisibility=CSS.supports("content-visibility","hidden"),displayProp=supportsContentVisibility?"contentVisibility":"display",displayHiddenValue=supportsContentVisibility?"hidden":"none";function Layout1dBase(config){this._physicalMin=0,this._physicalMax=0,this._first=-1,this._last=-1,this._itemSize={width:0,height:0},this._scrollPosition=0,this._viewportSize={width:0,height:0},this._totalItems=0,this._scrollSize=1,this._pendingReflow=!1,Object.assign(this,config)}function Layout1dGrid(config){Layout1dBase.call(this,config),this._rolumns=1}function VirtualScroller(config){this._totalItems=0,this._num=1/0,this._first=0,this._last=0,this._prevFirst=0,this._prevLast=0,this._needsReset=!1,this._needsRemeasure=!1,this._pendingRender=null,this._container=null,this._ordered=[],this._keyToChild=new Map,this._indexToMeasure={},this.requestAnimationFrameCallbackFn=this.requestAnimationFrameCallback.bind(this),this._num=0,this._first=-1,this._last=-1,this._prevFirst=-1,this._prevLast=-1,this._needsUpdateViewSize=!1,this._needsUpdateViewScrollPosition=!1,this._layout=null,this._scrollTarget=null,this._scrollSize=null,this._childrenPos=null,this._container=null,this._containerSize=null,this._containerRO=new ResizeObserver(this._containerSizeChanged.bind(this)),config.enableScrollTargetResizeObserver&&(this._scrollTargetRO=new ResizeObserver(this._scrollTargetSizeChanged.bind(this))),this._skipNextChildrenSizeChanged=!1,this.sameSizeChildren=config.sameSizeChildren,this.sameSizeChildren||(this._childrenRO=new ResizeObserver(this._childrenSizeChanged.bind(this))),this.boundHandleScroll=this.handleScroll.bind(this),this.setContainer(config.container),this.setScrollTarget(config.scrollTarget)}function abortRequests(instance){var currentAbortController=instance.currentAbortController;currentAbortController&&(currentAbortController.abort(),instance.currentAbortController=null)}function onInit(){this.hasVirtualScrollerInit||(this.hasVirtualScrollerInit=!0,this.scroller=null,this.nodePool=[],this.childTemplate=null,this.setItemSourceInternal(null),_layoutmanager.default.tv?this.classList.add("virtual-scroller","virtual-scroller-overflowvisible"):this.classList.add("virtual-scroller"),this.boundLoadItems=function(){var chunkSize,chunkStart,instance,abortController,index=this.startIndexToLoad;null!=index&&(chunkSize=this.virtualChunkSize,chunkStart=index,this.chunksLoaded[chunkStart]||(this.chunksLoaded[chunkStart]=!0,abortRequests(instance=this),abortController=new AbortController,this.currentAbortController=abortController,this.getItems({StartIndex:chunkStart,Limit:chunkSize,EnableTotalRecordCount:!1},abortController.signal).then(function(result){var items=result.Items||result,itemSource=instance._itemSource;if(itemSource){for(var itemSourceMap=instance._itemSourceMap,anyUpdated=!1,i=0,length=items.length;i<length;i++){var item,id,itemIndex=chunkStart+i;itemSource[itemIndex]||((id=(item=items[i]).Id)&&(itemSourceMap[id]=itemIndex),itemSource[itemIndex]=item,anyUpdated=!0)}anyUpdated&&instance.scroller.requestReset()}},function(error){instance.chunksLoaded[chunkStart]=null})))}.bind(this))}function cancelDataLoading(instance){var timeout=instance.getItemsTimeout;timeout&&(clearTimeout(timeout),instance.getItemsTimeout=null)}function updateElementOuter(element,index,item,showElement){var style,chunkStart,_style2;(item=item||this._itemSource[index])?(element._dataItemIndex=index,this.updateElement(element,item,index),!showElement||(style=element.style)&&(style[displayProp]=null),index===this._focusIndex&&(this._focusIndex=null,function(element){setTimeout(function(){_focusmanager.default.focus(element)},0)}(element))):(element._dataItemIndex=null,element.innerHTML=this.templateInnerHTML,(chunkStart=index-index%this.virtualChunkSize)===this.startIndexToLoad||this.chunksLoaded[chunkStart]||(cancelDataLoading(this),this.startIndexToLoad=chunkStart,this.getItemsTimeout=setTimeout(this.boundLoadItems,140)),!showElement||(_style2=element.style)&&(_style2[displayProp]=null))}Layout1dBase.prototype.setTotalItems=function(num){num!==this._totalItems&&(this._totalItems=num,this._scheduleReflow())},Layout1dBase.prototype.getDirection=function(){return this._direction},Layout1dBase.prototype.setDirection=function(dir){(dir="horizontal"===dir?dir:"vertical")!==this._direction&&(this._direction=dir,this.isVertical="vertical"===dir,this.isVertical?this._overhang=_layoutmanager.default.tv&&!_browser.default.web0s?3*_dom.default.getWindowSize().innerHeight:150:this._overhang=_layoutmanager.default.tv&&!_browser.default.web0s?3*_dom.default.getWindowSize().innerWidth:150,this._sizeDim="horizontal"===dir?"width":"height",this._secondarySizeDim="horizontal"===dir?"height":"width",this._positionDim="horizontal"===dir?"left":"top",this._secondaryPositionDim="horizontal"===dir?"top":"left",this._scheduleReflow())},Layout1dBase.prototype.setItemSize=function(dims){var _itemDim1=this._itemDim1(),_itemDim2=this._itemDim2(),itemSize=this._itemSize;return itemSize.width=Math.floor(dims.width),itemSize.height=Math.floor(dims.height),(_itemDim1!==this._itemDim1()||_itemDim2!==this._itemDim2())&&(_itemDim2!==this._itemDim2()?this._itemDim2Changed():this._scheduleReflow(),!0)},Layout1dBase.prototype.setViewportSize=function(dims){var _viewDim1=this._viewDim1(),_viewDim2=this._viewDim2();this._viewportSize=dims,_viewDim2!==this._viewDim2()?this._viewDim2Changed():_viewDim1===this._viewDim1()&&dims.offset===this._viewportSize.offset||this._checkThresholds()},Layout1dBase.prototype.setViewportScroll=function(newScrollPosition){this._scrollPosition=newScrollPosition,this._checkThresholds()},Layout1dBase.prototype._itemDim1=function(){return this._itemSize[this._sizeDim]},Layout1dBase.prototype._itemDim2=function(){return this._itemSize[this._secondarySizeDim]},Layout1dBase.prototype._viewDim1=function(){return this._viewportSize[this._sizeDim]},Layout1dBase.prototype._viewDim2=function(){return this._viewportSize[this._secondarySizeDim]},Layout1dBase.prototype._num=function(){var first=this._first,last=this._last;return-1===first||-1===last?0:last-first+1},Layout1dBase.prototype.reflowIfNeeded=function(forceEmitChildPositions){this._pendingReflow&&(this._pendingReflow=!1,this._reflow(forceEmitChildPositions))},Layout1dBase.prototype._scheduleReflow=function(){this._pendingReflow=!0},Layout1dBase.prototype._reflow=function(forceEmitChildPositions){var _first=this._first,_last=this._last,_scrollSize=this._scrollSize;this._updateScrollSize(),this._getActiveItems(),this._scrollSize!==_scrollSize&&this._emitScrollSize();var first=this._first,last=this._last,hasEmittedChildPositions=!1;-1===first&&-1===last?this._emitRange():first===_first&&last===_last||(this._emitRange(),this._emitChildPositions(),hasEmittedChildPositions=!0),!hasEmittedChildPositions&&forceEmitChildPositions&&this._emitChildPositions()},Layout1dBase.prototype._updateScrollSize=function(){var itemDim1=this._itemDim1();itemDim1&&(this._scrollSize=Math.max(1,this._totalItems*itemDim1))},Layout1dBase.prototype._checkThresholds=function(){var overhang,scrollPosition,min,max,_viewDim1=this._viewDim1();0===_viewDim1&&0<this._num()?this._scheduleReflow():(overhang=this._overhang,scrollPosition=this._scrollPosition,min=Math.max(0,scrollPosition-overhang-this._viewportSize.offset),max=Math.min(this._scrollSize,scrollPosition+_viewDim1+overhang),(this._physicalMin>min||this._physicalMax<max)&&this._scheduleReflow())},Layout1dBase.prototype._emitRange=function(){var fn=this.onRangeChange;fn&&fn({first:this._first,num:this._num()})},Layout1dBase.prototype._emitScrollSize=function(){var fn=this.onScrollSizeChange;fn&&fn(this._scrollSize)},Layout1dBase.prototype._emitChildPositions=function(){var first=this._first,last=this._last,positions=[last+1],rolumns=this._rolumns,itemDim1=this._itemDim1(),itemDim2=this._itemDim2();if(itemDim1&&itemDim2){for(var i=first;i<=last;i++)positions[i]=this._getItemPosition(i,rolumns,itemDim1,itemDim2);var fn=this.onItemPositionChange;fn&&fn({first:first,positions:positions})}},Layout1dBase.prototype._itemDim2Changed=function(){},Layout1dBase.prototype._viewDim2Changed=function(){},Layout1dBase.prototype._getActiveItems=function(){},Layout1dBase.prototype._getItemPosition=function(idx,rolumns,itemDim1,itemDim2){},Object.assign(Layout1dGrid.prototype,Layout1dBase.prototype),Layout1dGrid.prototype.updateItemSizes=function(sizes){return!!sizes&&this.setItemSize(sizes)},Layout1dGrid.prototype._viewDim2Changed=function(){this._defineGrid()},Layout1dGrid.prototype._itemDim2Changed=function(){this._defineGrid()},Layout1dGrid.prototype._getActiveItems=function(){var firstCow,lastCow,rolumns,overhang=this._overhang,scrollPosition=this._scrollPosition,min=Math.max(0,scrollPosition-overhang-this._viewportSize.offset),max=Math.min(this._scrollSize,scrollPosition+this._viewDim1()+overhang),_itemDim1=this._itemDim1();_itemDim1?(firstCow=Math.floor(min/_itemDim1),lastCow=Math.ceil(max/_itemDim1)-1,rolumns=this._rolumns,this._first=firstCow*rolumns,this._last=Math.min((1+lastCow)*rolumns-1,this._totalItems),this._physicalMin=_itemDim1*firstCow,this._physicalMax=_itemDim1*(1+lastCow)):(this._first=0,this._last=Math.min(1,this._totalItems))},Layout1dGrid.prototype._getItemPosition=function(idx,rolumns,itemDim1,itemDim2){var result={};return result[this._positionDim]=Math.floor(idx/rolumns)*itemDim1,result[this._secondaryPositionDim]=idx%rolumns*itemDim2,result},Layout1dGrid.prototype._defineGrid=function(){var itemDim2=this._itemDim2();itemDim2&&(this._rolumns=Math.max(1,Math.floor(this._viewDim2()/itemDim2))),this._scheduleReflow()},Layout1dGrid.prototype._updateScrollSize=function(){var itemDim1=this._itemDim1();itemDim1&&(this._scrollSize=Math.max(1,Math.ceil(this._totalItems/this._rolumns)*itemDim1))},VirtualScroller.prototype.getContainer=function(){return this._container},VirtualScroller.prototype.setContainer=function(container){this._container=container,this.requestReset(!0),this._containerRO.disconnect(),this._containerSize=null,this._needsUpdateViewSize=!0,this._needsUpdateViewScrollPosition=!0,this._scheduleRender(),this._containerRO.observe(container)},VirtualScroller.prototype.getLayout=function(){return this._layout},VirtualScroller.prototype.setLayout=function(layout){var itemsContainer;this._layout=layout,"function"==typeof this._layout.updateItemSizes&&this.requestRemeasure(),this._layout.isVertical||(itemsContainer=this._container.closest(".itemsContainer"))&&itemsContainer!==this._container&&this._containerRO.observe(itemsContainer),this._layout.onScrollSizeChange=this.onScrollSizeChange.bind(this),this._layout.onItemPositionChange=this.onItemPositionChange.bind(this),this._layout.onRangeChange=this.onRangeChange.bind(this),this._needsUpdateViewSize=!0,this._needsUpdateViewScrollPosition=!0,this._scheduleRender()},VirtualScroller.prototype.getScrollTarget=function(){return this._scrollTarget},VirtualScroller.prototype.setScrollTarget=function(target){this._scrollTarget=target,this._scrollTargetRO&&this._scrollTargetRO.observe(target),target.addScrollEventListener?target.addScrollEventListener(this.boundHandleScroll,{passive:!0}):_dom.default.addEventListener(target,"scroll",this.boundHandleScroll,{passive:!0})},VirtualScroller.prototype.getFirst=function(){return this._first},VirtualScroller.prototype.setFirst=function(idx){var newFirst=Math.max(0,Math.min(idx,this._totalItems-this._num));newFirst!==this._first&&(this._first=newFirst,this._scheduleRender())},VirtualScroller.prototype.setNum=function(n){n!==this._num&&(this._num=n,this.setFirst(this._first),this._scheduleRender())},VirtualScroller.prototype.setTotalItems=function(num,forceReset){var changed=!1;num!==this._totalItems&&(this._totalItems=num,this.setFirst(this._first),changed=!0),(changed||forceReset)&&this.requestReset(!0)},VirtualScroller.prototype.requestReset=function(requestRemeasure){requestRemeasure&&(this._needsRemeasure=!0,this._childSize=null),this._needsReset=!0,this._scheduleRender()},VirtualScroller.prototype.requestRemeasure=function(){this._needsRemeasure=!0,this._childSize=null,this._scheduleRender()},VirtualScroller.prototype._shouldRender=function(){var _containerSize=this._containerSize;if(!_containerSize){var container=this._container;if(!container)return!1;this._containerSize=_containerSize=container.getBoundingClientRect()}return 0<_containerSize.width||0<_containerSize.height},VirtualScroller.prototype.requestAnimationFrameCallback=function(){this._pendingRender=null,this._shouldRender()&&this._render()},VirtualScroller.prototype._scheduleRender=function(){this._pendingRender||(this._pendingRender=rAF(this.requestAnimationFrameCallbackFn))},VirtualScroller.prototype.get_toMeasure=function(){var _this=this;if(this.sameSizeChildren){var kids=this._ordered,first=this._first;return this._needsRemeasure||first<this._prevFirst||first+kids.length-1>this._prevLast?{indices:[first],children:kids}:{indices:[],children:[]}}return this._ordered.reduce(function(toMeasure,c,i){var idx=_this._first+i;return(_this._needsRemeasure||idx<_this._prevFirst||idx>_this._prevLast)&&(toMeasure.indices.push(idx),toMeasure.children.push(c)),toMeasure},{indices:[],children:[]})},VirtualScroller.prototype._measureChildren=function(_ref){var _this2=this,indices=_ref.indices,children=_ref.children;if(this.sameSizeChildren){var child=children[0];return child?this._layout.updateItemSizes(this._measureChild(child,!0)):!1}var mm=children.map(function(c,i){return _this2._indexToMeasure[indices[i]]||_this2._measureChild(c)}).reduce(function(out,cur,i){return out[indices[i]]=_this2._indexToMeasure[indices[i]]=cur,out},{});return this._layout.updateItemSizes(mm[0])},VirtualScroller.prototype._baseRender=function(){var _first=this._first,rangeChanged=_first!==this._prevFirst||this._num!==this._prevNum,needsReset=this._needsReset;if((rangeChanged||needsReset)&&(this._last=_first+Math.min(this._num,this._totalItems-_first)-1,this._num||this._prevNum))if(needsReset){for(var o=this._ordered,_prevFirst=this._prevFirst,elemsToHide=[o.length],elemToHideIndex=-1,idx=_prevFirst;o.length&&idx<_first;idx++){var elem=o.shift();elemsToHide[++elemToHideIndex]=elem,this._unassignChild(idx,elem)}for(var _last=this._last,_idx=this._prevLast;o.length&&_last<_idx;_idx--){var _elem=o.pop();elemsToHide[++elemToHideIndex]=_elem,this._unassignChild(_idx,_elem)}this._reset(_first,this._last);for(var prop=displayProp,propValue=displayHiddenValue,i=0;i<=elemToHideIndex;i++){var style,_elem2=elemsToHide[i];_elem2._unassigned&&(_elem2._unassigned=null,(style=_elem2.style)&&(style[prop]=propValue))}}else{for(var _o=this._ordered,_prevFirst2=this._prevFirst,_elemsToHide=[_o.length],_elemToHideIndex=-1,_idx2=_prevFirst2;_o.length&&_idx2<_first;_idx2++){var _elem3=_o.shift();_elemsToHide[++_elemToHideIndex]=_elem3,this._unassignChild(_idx2,_elem3)}for(var _last2=this._last,_idx3=this._prevLast;_o.length&&_last2<_idx3;_idx3--){var _elem4=_o.pop();_elemsToHide[++_elemToHideIndex]=_elem4,this._unassignChild(_idx3,_elem4)}this._addHead(),this._addTail();for(var _prop=displayProp,_propValue=displayHiddenValue,_i=0;_i<=_elemToHideIndex;_i++){var _style,_elem5=_elemsToHide[_i];_elem5._unassigned&&(_elem5._unassigned=null,(_style=_elem5.style)&&(_style[_prop]=_propValue))}}this._needsRemeasure&&(this._indexToMeasure={});var toMeasure=0<this._num&&(rangeChanged||this._needsRemeasure)?this.get_toMeasure():null;return this._prevFirst=this._first,this._prevLast=this._last,this._prevNum=this._num,this._needsReset=!1,this._needsRemeasure=!1,this._didRender(),!!toMeasure&&this._measureChildren(toMeasure)},VirtualScroller.prototype._render=function(){var childrenRO=this._childrenRO;for(childrenRO&&childrenRO.disconnect(),this._layout.setTotalItems(this._totalItems),this._needsUpdateViewSize&&(this._needsUpdateViewSize=!1,this._updateViewSize()),this._needsUpdateViewScrollPosition&&(this._needsUpdateViewScrollPosition=!1,this._updateViewScrollPosition()),this._layout.reflowIfNeeded();;){this._pendingRender&&(cAF(this._pendingRender),this._pendingRender=null),this._sizeContainer(this._scrollSize);var hasChanges=this._baseRender();if(this._layout.reflowIfNeeded(hasChanges),!this._pendingRender)break}if(childrenRO){this._skipNextChildrenSizeChanged=!0;for(var kids=this._ordered,i=0,length=kids.length;i<length;i++)childrenRO.observe(kids[i])}},VirtualScroller.prototype._didRender=function(){var childrenPos=this._childrenPos;childrenPos&&(this._positionChildren(childrenPos),this._childrenPos=null)},VirtualScroller.prototype._addHead=function(){for(var start=this._first,end=Math.min(this._last,this._prevFirst-1),updateElement=this.updateElement,ordered=(this._container,this._ordered),idx=end;start<=idx;idx--){var child=this._assignChild(idx,ordered[0],!0);updateElement(child,idx,null,!0),ordered.unshift(child)}},VirtualScroller.prototype._addTail=function(){for(var start=Math.max(this._first,this._prevLast+1),end=this._last,updateElement=this.updateElement,ordered=(this._container,this._ordered),idx=start;idx<=end;idx++){var child=this._assignChild(idx,null,!0);updateElement(child,idx,null,!0),ordered.push(child)}},VirtualScroller.prototype._reset=function(first,last){var ordered=this._ordered,currentMarker=ordered[0];ordered.length=0;for(var updateElement=this.updateElement,i=(this._container,first);i<=last;i++){var child=this._assignChild(i,currentMarker);ordered.push(child),updateElement(child,i,null,!0)}},VirtualScroller.prototype.updateExistingElement=function(index,item){var child=this._keyToChild.get(index);child&&this.updateElement(child,index,item)},VirtualScroller.prototype._assignChild=function(idx,insertBefore,insertElement){var container,keyToChild=this._keyToChild,child=keyToChild.get(idx);return child?(container=this._container,insertElement&&container.insertBefore(child,insertBefore)):(child=this.createElement(insertBefore),keyToChild.set(idx,child)),child._unassigned=null,child},VirtualScroller.prototype._unassignChild=function(idx,child){child._unassigned=!0,this._keyToChild.delete(idx),this.recycleElement(child,idx)},VirtualScroller.prototype._measureChild=function(child,sameSizeChildren){var childSize=this._childSize;return sameSizeChildren&&childSize||(this._childSize=childSize=child.getBoundingClientRect()),childSize},VirtualScroller.prototype._containerSizeChanged=function(entries){this.paused||(this._containerSize=entries[0].contentRect,this._needsUpdateViewSize=!0,this._needsUpdateViewScrollPosition=!0,this.requestRemeasure())},VirtualScroller.prototype._scrollTargetSizeChanged=function(entries){this.paused||(this._needsUpdateViewSize=!0,this._needsUpdateViewScrollPosition=!0,this.requestRemeasure())},VirtualScroller.prototype._childrenSizeChanged=function(){this.paused||(this._skipNextChildrenSizeChanged?this._skipNextChildrenSizeChanged=!1:this.requestRemeasure())},VirtualScroller.prototype.onRangeChange=function(range){this.setNum(range.num),this.setFirst(range.first)},VirtualScroller.prototype.onItemPositionChange=function(event){this._childrenPos=event,this._scheduleRender()},VirtualScroller.prototype.onScrollSizeChange=function(size){this._scrollSize=size,this._scheduleRender()},VirtualScroller.prototype.handleScroll=function(event){this.paused||(this._needsUpdateViewScrollPosition=!0,this._scheduleRender())},VirtualScroller.prototype._updateViewSize=function(){var containerElement=this._container,layout=this._layout,containerBounds=containerElement.getBoundingClientRect(),scrollBounds=this._scrollTarget.getBoundingClientRect(),scrollerWidth=scrollBounds.width,scrollerHeight=scrollBounds.height,xMin=Math.max(0,Math.min(scrollerWidth,containerBounds.left-scrollBounds.left)),yMin=Math.max(0,Math.min(scrollerHeight,containerBounds.top-scrollBounds.top)),directionIsVertical=layout.isVertical,width=(directionIsVertical?Math.max(0,Math.min(scrollerWidth,containerBounds.right-scrollBounds.left)):scrollerWidth)-xMin,height=(directionIsVertical?scrollerHeight:Math.max(0,Math.min(scrollerHeight,containerBounds.bottom-scrollBounds.top)))-yMin,offset=directionIsVertical?Math.max(0,containerBounds.top-scrollBounds.top):Math.max(0,containerBounds.left-scrollBounds.left);layout.setViewportSize({width:width,height:height,offset:offset})},VirtualScroller.prototype._updateViewScrollPosition=function(){this._layout.setViewportScroll(this._scrollTarget.getScrollPosition())},VirtualScroller.prototype._sizeContainer=function(size){var containerElemStyle,itemHeight,containerElem=this._container,styleValue=size?size+"px":null;this._layout.isVertical?containerElem.lastMinHeight!==styleValue&&(containerElem.style.minHeight=styleValue,containerElem.lastMinHeight=styleValue):containerElem.lastMinWidth!==styleValue&&((containerElemStyle=containerElem.style).minWidth=styleValue,containerElem.lastMinWidth=styleValue,(itemHeight=this._layout._itemDim2())&&(containerElemStyle.minHeight=itemHeight+"px"))},VirtualScroller.prototype._positionChildrenAbsolute=function(pos){for(var kids=this._ordered,first=this._first,positions=pos.positions,i=pos.first,length=positions.length;i<length;i++){var childPosition,childStyle,child=kids[i-first];child&&(childPosition=positions[i],(childStyle=child.style).left=childPosition.left+"px",childStyle.top=childPosition.top+"px")}},VirtualScroller.prototype._positionChildrenTransforms=function(pos){for(var kids=this._ordered,first=this._first,positions=pos.positions,i=pos.first,length=positions.length;i<length;i++){var childPosition,child=kids[i-first];child&&(childPosition=positions[i],child.style.transform="translate("+childPosition.left+"px, "+childPosition.top+"px)")}},VirtualScroller.prototype._positionChildren=supportsCssTransforms?VirtualScroller.prototype._positionChildrenTransforms:VirtualScroller.prototype._positionChildrenAbsolute,VirtualScroller.prototype.destroy=function(){abortRequests(this);var ro=this._containerRO;ro&&(ro.disconnect(),this._containerRO=null),(ro=this._scrollTargetRO)&&(ro.disconnect(),this._scrollTargetRO=null),(ro=this._childrenRO)&&(ro.disconnect(),this._childrenRO=null);var scrollTarget=this._scrollTarget;scrollTarget&&this.boundHandleScroll&&(scrollTarget.removeScrollEventListener?scrollTarget.removeScrollEventListener(this.boundHandleScroll,{passive:!0}):_dom.default.removeEventListener(scrollTarget,"scroll",this.boundHandleScroll,{passive:!0})),this.requestAnimationFrameCallbackFn=this.requestAnimationFrameCallback.bind(this),this.boundHandleScroll=null,this._container=null,this._containerSize=null};var VirtualScrollerElement=function(_HTMLDivElement){babelHelpers.inherits(VirtualScrollerElement,_HTMLDivElement);var _super=_createSuper(VirtualScrollerElement);function VirtualScrollerElement(){var _this3;babelHelpers.classCallCheck(this,VirtualScrollerElement);var self=_this3=_super.call(this);return onInit.call(self),babelHelpers.possibleConstructorReturn(_this3,self)}return babelHelpers.createClass(VirtualScrollerElement,[{key:"connectedCallback",value:function(){onInit.call(this),this.dispatchEvent(new CustomEvent("upgraded",{cancelable:!1}))}},{key:"disconnectedCallback",value:function(){cancelDataLoading(this),this.hasVirtualScrollerInit=null;var scroller=this.scroller;this.scroller=null,scroller&&scroller.destroy(),this.nodePool=null,this.childTemplate=null,this.setItemSourceInternal(null),this.boundLoadItems=null}},{key:"setItemSourceInternal",value:function(items){if(this._itemSource=items){for(var map={},i=0,length=items.length;i<length;i++){var item=items[i];if(!item)break;var id=item.Id;id&&(map[id]=i)}this._itemSourceMap=map}else this._itemSourceMap=null}},{key:"setItemSource",value:function(itemSource,totalItems){cancelDataLoading(this),totalItems&&(itemSource.length=totalItems),this.setItemSourceInternal(itemSource),this.chunksLoaded={},this.startIndexToLoad=null;var layoutAttr,direction,layout,scroller=this.scroller;scroller||(layoutAttr=this.getAttribute("layout"),(scroller=this.scroller=new VirtualScroller({container:this,scrollTarget:this.closest(".emby-scroller"),sameSizeChildren:!0,enableScrollTargetResizeObserver:"true"===this.getAttribute("data-scrollresizeobserver")})).updateElement=updateElementOuter.bind(this),scroller.createElement=function(insertBefore){var result=this.nodePool.pop();if(result)return this.scroller._container.insertBefore(result,insertBefore),result;var fragment,template=this.childTemplate;template||((fragment=document.createElement("div")).innerHTML=this.templateHTML,template=this.childTemplate=fragment.firstChild.cloneNode(!0),fragment.innerHTML="");var newElement=template.cloneNode(!0),fn=this.onElementCreated;return fn&&fn(newElement),this.scroller._container.insertBefore(newElement,insertBefore),newElement}.bind(this),scroller.recycleElement=function(element,index){this.nodePool.push(element);var fn=this.onRecycleElement;fn&&fn(element,index)}.bind(this),direction=0===layoutAttr.indexOf("horizontal")?"horizontal":"vertical",(layout=new Layout1dGrid({})).setDirection(direction),scroller.setLayout(layout)),scroller.setTotalItems(itemSource.length,!0)}},{key:"scrollToIndex",value:function(index,scrollOptions,setFocus){if(setFocus){var item=this.scroller._keyToChild.get(index);if(item&&item.classList.contains("focus-subcontainer")&&(item=item.querySelector("button")),item)return void _focusmanager.default.focus(item)}var scroller=this.scroller,layout=scroller.getLayout(),rolumns=layout._rolumns,pos=Math.floor(index/rolumns)*layout._itemDim1();setFocus&&(this._focusIndex=index);var posOptions={};scrollOptions&&scrollOptions.behavior?posOptions.behavior=scrollOptions.behavior:setFocus&&(posOptions.behavior="instant"),layout.isVertical?posOptions.top=pos:posOptions.left=pos;var promise=scroller._scrollTarget.scrollToPosition(posOptions);setFocus&&this._focusIndexInternal(promise,index)}},{key:"_focusIndexInternal",value:function(promise,index){var instance=this;promise.then(function(){var item,newFocusIndex=instance._focusIndex;null!=newFocusIndex&&newFocusIndex!==index||((item=instance.scroller._keyToChild.get(index))&&item.classList.contains("focus-subcontainer")&&(item=item.querySelector("button")),item?_focusmanager.default.focus(item):instance._focusIndex=index)})}},{key:"pause",value:function(){var scroller=this.scroller;scroller&&(scroller.paused=!0)}},{key:"resume",value:function(){var scroller=this.scroller;scroller&&scroller.paused&&(scroller.paused=!1,scroller.requestReset(!0))}},{key:"indexOfItemId",value:function(id){var index=this._itemSourceMap[id];return null==index?-1:index}},{key:"getItem",value:function(index){return this._itemSource[index]}},{key:"getItemFromElement",value:function(element){var index=this.indexOfElement(element);if(0<=index){var elem=this.getItem(index);if(elem)return elem}return null}},{key:"indexOfElement",value:function(element){return element._dataItemIndex}},{key:"onItemUpdated",value:function(index,item){this._itemSource[index]=item,this._itemSourceMap[item.Id]=index,this.scroller.updateExistingElement(index,item)}},{key:"getActiveItems",value:function(){var scroller=this.scroller,first=scroller._first,last=scroller._last;return{elements:scroller._ordered.slice(0),firstIndex:first,lastIndex:last}}}]),VirtualScrollerElement}(babelHelpers.wrapNativeSuper(HTMLDivElement));customElements.define("virtual-scroller",VirtualScrollerElement,{extends:"div"}),_exports.default=VirtualScrollerElement});