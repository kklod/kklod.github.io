define(["exports","./../common/datetime.js","./../common/globalize.js","./../common/textencoding.js","./../common/itemhelper.js","./../indicators/indicators.js","./../approuter.js","./../emby-apiclient/connectionmanager.js"],function(_exports,_datetime,_globalize,_textencoding,_itemhelper,_indicators,_approuter,_connectionmanager){function getProgramInfoHtml(item,options){var text,date,name,timerHtml,html="",miscInfo=[];if(item.StartDate&&!1!==options.programTime)try{text="",date=_datetime.default.parseISO8601Date(item.StartDate),!1!==options.startDate&&(text+=_datetime.default.toLocaleDateString(date,{weekday:"short",month:"short",day:"numeric"})),text+=" "+_datetime.default.getDisplayTime(date),item.EndDate&&(date=_datetime.default.parseISO8601Date(item.EndDate),text+=" &ndash; "+_datetime.default.getDisplayTime(date)),miscInfo.push(text)}catch(e){console.log("Error parsing date: "+item.StartDate)}return item.ChannelName&&(name=item.ChannelName,item.ChannelNumber&&(name+=" "+item.ChannelNumber),options.interactive&&item.ChannelId?miscInfo.push({html:'<a is="emby-linkbutton" style="color:inherit;" class="button-link mediaInfoItem" href="'+_approuter.default.getRouteUrl({ServerId:item.ServerId,Type:"TvChannel",Name:item.ChannelName,Id:item.ChannelId})+'">'+name+"</a>"}):miscInfo.push(name)),!options.timerIndicator||(timerHtml=function(item){var status;if("SeriesTimer"===item.Type)return'<i class="md-icon mediaInfoItem mediaInfoIconItem mediaInfoTimerIcon">&#xE062;</i>';if(item.TimerId||item.SeriesTimerId)status=item.Status||"Cancelled";else{if("Timer"!==item.Type)return"";status=item.Status}return item.SeriesTimerId?"Cancelled"!==status?'<i class="md-icon mediaInfoItem mediaInfoIconItem mediaInfoTimerIcon">&#xE062;</i>':'<i class="md-icon mediaInfoItem mediaInfoIconItem">&#xE062;</i>':'<i class="md-icon mediaInfoItem mediaInfoIconItem mediaInfoTimerIcon">&#xE061;</i>'}(item))&&miscInfo.push({html:timerHtml}),html+=miscInfo.map(getMediaInfoItem).join("")}function getMediaInfoHtml(item,options){var text,date,html="",miscInfo=[];options=options||{};var studioHtml,studio,count,endsAt,dateCreated,showFolderRuntime="MusicAlbum"===item.Type||"MusicArtist"===item.Type||"Playlist"===item.Type||"MusicGenre"===item.Type;if(("Episode"===item.Type||"Photo"===item.MediaType)&&!1!==options.originalAirDate&&item.PremiereDate)try{date=_datetime.default.parseISO8601Date(item.PremiereDate),text=_datetime.default.toLocaleDateString(date),miscInfo.push(text)}catch(e){console.log("Error parsing date: "+item.PremiereDate)}if("SeriesTimer"===item.Type&&(item.RecordAnyTime?miscInfo.push(_globalize.default.translate("Anytime")):miscInfo.push(_datetime.default.getDisplayTime(item.StartDate)),item.RecordAnyChannel?miscInfo.push(_globalize.default.translate("AllChannels")):miscInfo.push(item.ChannelName||_globalize.default.translate("OneChannel"))),item.StartDate&&"Program"!==item.Type&&"SeriesTimer"!==item.Type)try{date=_datetime.default.parseISO8601Date(item.StartDate),text=_datetime.default.toLocaleDateString(date),miscInfo.push(text),"Recording"!==item.Type&&(text=_datetime.default.getDisplayTime(date),miscInfo.push(text))}catch(e){console.log("Error parsing date: "+item.StartDate)}if(!1!==options.year&&item.ProductionYear&&"Series"===item.Type)if("Continuing"===item.Status)miscInfo.push(_globalize.default.translate("SeriesYearToPresent",item.ProductionYear));else if(item.ProductionYear){if(text=item.ProductionYear,item.EndDate)try{_datetime.default.parseISO8601Date(item.EndDate).getFullYear()!==item.ProductionYear&&(text+=" &ndash; "+_datetime.default.parseISO8601Date(item.EndDate).getFullYear())}catch(e){console.log("Error parsing date: "+item.EndDate)}miscInfo.push(text)}if("Series"===item.Type&&(studioHtml="",item.Studios&&item.Studios.length&&(studio=item.Studios[0],studioHtml&&(studioHtml+=" on "),studioHtml+='<a style="color:inherit;" class="button-link" is="emby-linkbutton" href="'+_approuter.default.getRouteUrl({Name:studio.Name,Type:"Studio",ServerId:item.ServerId,Id:studio.Id})+'">'+studio.Name+"</a>"),studioHtml&&miscInfo.push(studioHtml)),"Program"===item.Type)if(!1!==options.programIndicator&&(item.IsLive?miscInfo.push({html:'<div class="mediaInfoProgramAttribute mediaInfoItem liveTvProgram">'+_globalize.default.translate("Live")+"</div>"}):item.IsPremiere?miscInfo.push({html:'<div class="mediaInfoProgramAttribute mediaInfoItem premiereTvProgram">'+_globalize.default.translate("Premiere")+"</div>"}):item.IsNew?miscInfo.push({html:'<div class="mediaInfoProgramAttribute mediaInfoItem newTvProgram">'+_globalize.default.translate("AttributeNew")+"</div>"}):item.IsRepeat&&miscInfo.push({html:'<div class="mediaInfoProgramAttribute mediaInfoItem repeatTvProgram secondaryText">'+_globalize.default.translate("Repeat")+"</div>"})),(item.IsSeries||item.EpisodeTitle)&&!1!==options.episodeTitle)(text=_itemhelper.default.getDisplayName(item,{includeIndexNumber:options.episodeTitleIndexNumber}))&&miscInfo.push(text);else if(item.IsMovie&&item.ProductionYear&&!1!==options.originalAirDate)miscInfo.push(item.ProductionYear);else if(item.PremiereDate&&!1!==options.originalAirDate)try{date=_datetime.default.parseISO8601Date(item.PremiereDate),text=_globalize.default.translate("OriginalAirDateValue",_datetime.default.toLocaleDateString(date)),miscInfo.push(text)}catch(e){console.log("Error parsing date: "+item.PremiereDate)}else item.ProductionYear&&miscInfo.push(item.ProductionYear);if(!1!==options.year&&"Series"!==item.Type&&"Episode"!==item.Type&&"Person"!==item.Type&&"Photo"!==item.MediaType&&"Program"!==item.Type&&"Season"!==item.Type)if(item.ProductionYear)miscInfo.push(item.ProductionYear);else if(item.PremiereDate)try{text=_datetime.default.parseISO8601Date(item.PremiereDate).getFullYear(),miscInfo.push(text)}catch(e){console.log("Error parsing date: "+item.PremiereDate)}return item.RunTimeTicks&&"Series"!==item.Type&&"Program"!==item.Type&&!showFolderRuntime&&!1!==options.runtime&&("Audio"===item.Type?miscInfo.push(_datetime.default.getDisplayRunningTime(item.RunTimeTicks)):miscInfo.push(_datetime.default.getHumanReadableRuntime(item.RunTimeTicks))),item.OfficialRating&&miscInfo.push({text:item.OfficialRating}),showFolderRuntime&&((count=item.SongCount||item.ChildCount)&&(1===count?miscInfo.push(_globalize.default.translate("OneTrack")):miscInfo.push(_globalize.default.translate("TrackCount",count))),item.RunTimeTicks&&"Playlist"===item.Type&&miscInfo.push(_datetime.default.getHumanReadableRuntime(item.RunTimeTicks))),"Series"===item.Type&&item.ChildCount&&(1===item.ChildCount?miscInfo.push(_globalize.default.translate("OneSeason")):miscInfo.push(_globalize.default.translate("NumberSeasonsValue",item.ChildCount))),item.Video3DFormat&&miscInfo.push("3D"),"Photo"===item.MediaType&&item.Width&&item.Height&&miscInfo.push(item.Width+"x"+item.Height),!1!==options.container&&"Audio"===item.Type&&item.Container&&miscInfo.push(item.Container),!1!==options.CommunityRating&&item.CommunityRating&&(html+=getStarIconsHtml(item)),item.CriticRating&&!1!==options.criticRating&&(html+=getCriticRating(item)),html+=miscInfo.map(getMediaInfoItem).join(""),item.HasSubtitles&&!1!==options.subtitles&&(html+='<div class="mediaInfoItem mediaInfoText closedCaptionMediaInfoText">CC</div>'),!1===options.endsAt||(endsAt=getEndsAt(item))&&(html+=getMediaInfoItem(endsAt,"endsAt")),options.dateAdded&&_itemhelper.default.enableDateAddedDisplay(item)&&(dateCreated=_datetime.default.parseISO8601Date(item.DateCreated),html+=getMediaInfoItem(_globalize.default.translate("AddedOnValue",_datetime.default.toLocaleDateString(dateCreated)))),options.genres&&(html+=function(item,options){var type,context=options.context,genres=(item.GenreItems||[]).slice(0);switch("Playlist"!==item.Type&&"BoxSet"!==item.Type&&"MusicArtist"!==item.Type||5<genres.length&&(genres.length=5),context){case"games":type="GameGenre";break;case"music":type="MusicGenre";break;default:type="Genre"}var html=genres.map(function(p){return'<a style="color:inherit;" class="button-link" is="emby-linkbutton" href="'+_approuter.default.getRouteUrl({Name:p.Name,Type:type,ServerId:item.ServerId,Id:p.Id},{context:context})+'">'+_textencoding.default.htmlEncode(p.Name)+"</a>"}).join(", ");return html=html&&'<div class="mediaInfoItem" style="white-space:normal;">'+html+"</div>"}(item,options)),html+=_indicators.default.getMissingIndicator(item)}function getEndsAt(item){if("Video"!==item.MediaType||!item.RunTimeTicks||item.StartDate||"Program"===item.Type)return null;var positionTicks=item.UserData&&item.UserData.PlaybackPositionTicks||0;return getEndsAtFromPosition(item.RunTimeTicks,positionTicks)}function getEndsAtFromPosition(runtimeTicks,positionTicks,includeText){var endDate=Date.now()+(runtimeTicks-(positionTicks||0))/1e4,endDate=new Date(endDate),displayTime=_datetime.default.getDisplayTime(endDate);return!1===includeText?displayTime:_globalize.default.translate("EndsAtValue",displayTime)}function getMediaInfoItem(m,cssClass){cssClass=cssClass?cssClass+" mediaInfoItem":"mediaInfoItem";var mediaInfoText=m;if("string"!=typeof m&&"number"!=typeof m){if(m.html)return m.html;mediaInfoText=m.text,cssClass+=" "+m.cssClass}return'<div class="'+cssClass+'">'+mediaInfoText+"</div>"}function getCriticRating(item,options){var outerClass="mediaInfoItem mediaInfoCriticRating";return options&&options.outerClass&&(outerClass+=" "+options.outerClass),60<=item.CriticRating?outerClass+=" mediaInfoCriticRatingFresh":outerClass+=" mediaInfoCriticRatingRotten",'<div class="'+outerClass+'">'+item.CriticRating+"%</div>"}function getStarIconsHtml(item,options){var outerClass,html="",rating=item.CommunityRating;return rating&&(outerClass="starRatingContainer mediaInfoItem",options&&options.outerClass&&(outerClass+=" "+options.outerClass),html+='<div class="'+outerClass+'">',html+='<i class="md-icon starIcon">&#xE838;</i>',html+=rating,html+="</div>"),html}function fillPrimaryMediaInfo(elem,item,options){var html=getPrimaryMediaInfoHtml(item,options);(elem.innerHTML=html)?elem.classList.remove("hide"):elem.classList.add("hide"),afterFill(elem,item,options)}function afterFill(elem,item,options){var endsAtElem;!1!==options.endsAt&&(endsAtElem=elem.querySelector(".endsAt"))&&function(elem,item){var interval=setInterval(function(){document.body.contains(elem)?elem.innerHTML=getEndsAt(item):clearInterval(interval)},6e4)}(endsAtElem,item)}function getPrimaryMediaInfoHtml(item,options){return null==(options=options||{}).interactive&&(options.interactive=!1),getMediaInfoHtml(item,options)}function getSecondaryMediaInfoHtml(item,options){return null==(options=options||{}).interactive&&(options.interactive=!1),"Program"===item.Type?getProgramInfoHtml(item,options):""}function createAttribute(label,value,className){return className=className?className+" ":className,className+=" flex",'<div class="'+(className+=" mediaStreamAttribute")+'"><span class="mediaInfoAttributeLabel">'+label+'</span><span class="mediaInfoAttributeValue">'+value+"</span></div>"}function intToString(value){try{return new Intl.NumberFormat(_globalize.default.getCurrentLocales(),{style:"decimal"}).format(value)}catch(err){return console.log("Error in NumberFormat: "+err),value}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_datetime=babelHelpers.interopRequireDefault(_datetime),_globalize=babelHelpers.interopRequireDefault(_globalize),_textencoding=babelHelpers.interopRequireDefault(_textencoding),_itemhelper=babelHelpers.interopRequireDefault(_itemhelper),_indicators=babelHelpers.interopRequireDefault(_indicators),_approuter=babelHelpers.interopRequireDefault(_approuter),_connectionmanager=babelHelpers.interopRequireDefault(_connectionmanager),require(["material-icons","css!modules/mediainfo/mediainfo.css","programStyles","emby-linkbutton"]);var _default={getMediaInfoHtml:getPrimaryMediaInfoHtml,fill:fillPrimaryMediaInfo,getEndsAt:getEndsAt,getEndsAtFromPosition:getEndsAtFromPosition,getPrimaryMediaInfoHtml:getPrimaryMediaInfoHtml,getSecondaryMediaInfoHtml:getSecondaryMediaInfoHtml,fillPrimaryMediaInfo:fillPrimaryMediaInfo,fillSecondaryMediaInfo:function(elem,item,options){var html=getSecondaryMediaInfoHtml(item,options);(elem.innerHTML=html)?elem.classList.remove("hide"):elem.classList.add("hide"),afterFill(elem,item,options)},getResolutionText:function(i){var width=i.Width,height=i.Height;if(width&&height){if(3800<=width||2e3<=height)return"4K";if(2500<=width||1400<=height)return i.IsInterlaced?"1440i":"1440P";if(1800<=width||1e3<=height)return i.IsInterlaced?"1080i":"1080P";if(1200<=width||700<=height)return i.IsInterlaced?"720i":"720P";if(700<=width||400<=height)return i.IsInterlaced?"480i":"480P"}return null},pushMediaStreamLines:function(stream,options,lines,icon){var streamType=stream.StreamType,streamTypeLocalizationKey="EmbeddedImage"===streamType?"Image":streamType,displayType=_globalize.default.translate(streamTypeLocalizationKey);icon&&(displayType='<i class="md-icon mediaStreamTypeIcon">'+icon+"</i>"+displayType),lines.push('<h3 style="margin: .6em 0 .8em;" class="flex align-items-center">'+displayType+"</h3>"),stream.DisplayTitle&&lines.push(createAttribute(_globalize.default.translate("Title"),stream.DisplayTitle)),stream.Title&&stream.Title!==stream.DisplayTitle&&lines.push(createAttribute(_globalize.default.translate("HeaderEmbeddedTitle"),stream.Title)),(stream.DisplayLanguage||stream.Language)&&"Video"!==streamType&&lines.push(createAttribute(_globalize.default.translate("Language"),stream.DisplayLanguage||stream.Language)),stream.Codec&&lines.push(createAttribute(_globalize.default.translate("Codec"),stream.Codec.toUpperCase())),stream.CodecTag&&lines.push(createAttribute(_globalize.default.translate("HeaderCodecTag"),stream.CodecTag)),stream.Profile&&lines.push(createAttribute(_globalize.default.translate("Profile"),stream.Profile)),stream.Level&&lines.push(createAttribute(_globalize.default.translate("Level"),stream.Level)),(stream.Width||stream.Height)&&lines.push(createAttribute(_globalize.default.translate("Resolution"),stream.Width+"x"+stream.Height)),stream.AspectRatio&&"mjpeg"!==stream.Codec&&lines.push(createAttribute(_globalize.default.translate("HeaderAspectRatio"),stream.AspectRatio)),"Video"===streamType&&lines.push(createAttribute(_globalize.default.translate("Interlaced"),stream.IsInterlaced?_globalize.default.translate("Yes"):_globalize.default.translate("No"))),(stream.AverageFrameRate||stream.RealFrameRate)&&lines.push(createAttribute(_globalize.default.translate("Framerate"),intToString(stream.AverageFrameRate||stream.RealFrameRate))),stream.ChannelLayout&&lines.push(createAttribute(_globalize.default.translate("Layout"),stream.ChannelLayout)),stream.Channels&&lines.push(createAttribute(_globalize.default.translate("Channels"),stream.Channels+" ch")),stream.BitRate&&"mjpeg"!==stream.Codec&&lines.push(createAttribute(_globalize.default.translate("Bitrate"),intToString(parseInt(stream.BitRate/1e3))+" kbps")),stream.SampleRate&&lines.push(createAttribute(_globalize.default.translate("HeaderSampleRate"),intToString(stream.SampleRate)+" Hz")),stream.VideoRange&&"SDR"!==stream.VideoRange&&lines.push(createAttribute(_globalize.default.translate("HeaderVideoRange"),stream.VideoRange)),stream.ColorPrimaries&&lines.push(createAttribute(_globalize.default.translate("HeaderColorPrimaries"),stream.ColorPrimaries)),stream.ColorSpace&&lines.push(createAttribute(_globalize.default.translate("HeaderColorSpace"),stream.ColorSpace)),stream.ColorTransfer&&lines.push(createAttribute(_globalize.default.translate("HeaderColorTransfer"),stream.ColorTransfer)),stream.BitDepth&&lines.push(createAttribute(_globalize.default.translate("HeaderBitDepth"),stream.BitDepth+" bit")),stream.PixelFormat&&lines.push(createAttribute(_globalize.default.translate("HeaderPixelFormat"),stream.PixelFormat)),stream.RefFrames&&lines.push(createAttribute(_globalize.default.translate("HeaderReferenceFrames"),stream.RefFrames)),"Video"!==streamType&&lines.push(createAttribute(_globalize.default.translate("Default"),stream.IsDefault?_globalize.default.translate("Yes"):_globalize.default.translate("No"))),"Subtitle"===streamType&&(lines.push(createAttribute(_globalize.default.translate("Forced"),stream.IsForced?_globalize.default.translate("Yes"):_globalize.default.translate("No"))),lines.push(createAttribute(_globalize.default.translate("External"),stream.IsExternal?_globalize.default.translate("Yes"):_globalize.default.translate("No")))),stream.Extradata&&lines.push(createAttribute(_globalize.default.translate("HeaderExtradata"),stream.Extradata)),stream.IsExternal&&stream.Path&&lines.push(createAttribute(_globalize.default.translate("File"),function(stream){var parts=stream.Path.split("/").join("\\").split("\\");return parts[parts.length-1]}(stream)))},getCommunityRating:getStarIconsHtml,getCriticRating:getCriticRating};_exports.default=_default});