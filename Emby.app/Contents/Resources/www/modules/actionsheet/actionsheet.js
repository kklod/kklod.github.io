define(["exports","./../emby-apiclient/connectionmanager.js","./../dom.js","./../common/globalize.js","./../layoutmanager.js","./../common/itemhelper.js","./../common/servicelocator.js","./../imageloader/imageloader.js","./../dialoghelper/dialoghelper.js"],function(_exports,_connectionmanager,_dom,_globalize,_layoutmanager,_itemhelper,_servicelocator,_imageloader,_dialoghelper){function getPosition(options,dlg){var pos=function(elems){var box,elem,results=[];if(!document)return results;for(var i=0,length=elems.length;i<length;i++)box=(elem=elems[i]).getBoundingClientRect?elem.getBoundingClientRect():{top:0,left:0},results[i]={top:box.top,left:box.left,width:box.width,height:box.height};return results}([options.positionTo])[0];"bottom"===options.positionY?pos.top+=pos.height||0:"top"!==options.positionY&&"above"!==options.positionY&&(pos.top+=(pos.height||0)/2),"right"!==options.positionX&&"left"===options.positionX||(pos.left+=(pos.width||0)/2);var height=dlg.offsetHeight||300,width=dlg.offsetWidth||160;"above"===options.positionY?pos.top-=height:"bottom"!==options.positionY&&"center"!==options.positionY&&"top"!==options.positionY&&(pos.top-=height/2),"left"===options.positionX||"right"!==options.positionX&&(pos.left-=width/2);var windowSize=_dom.default.getWindowSize(),windowHeight=windowSize.innerHeight,windowWidth=windowSize.innerWidth,overflowX=pos.left+width-windowWidth,overflowY=pos.top+height-windowHeight;return 0<overflowX&&(pos.left-=20+overflowX),0<overflowY&&(pos.top-=20+overflowY),pos.top+=options.offsetTop||0,pos.left+=options.offsetLeft||0,!1!==options.preventOverflow&&(pos.top=Math.max(pos.top,10),pos.left=Math.max(pos.left,10)),pos}function onCancelClick(e){_dialoghelper.default.close(this.closest(".actionSheet"))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_connectionmanager=babelHelpers.interopRequireDefault(_connectionmanager),_dom=babelHelpers.interopRequireDefault(_dom),_globalize=babelHelpers.interopRequireDefault(_globalize),_layoutmanager=babelHelpers.interopRequireDefault(_layoutmanager),_itemhelper=babelHelpers.interopRequireDefault(_itemhelper),_imageloader=babelHelpers.interopRequireDefault(_imageloader),_dialoghelper=babelHelpers.interopRequireDefault(_dialoghelper),require(["emby-button","css!modules/actionsheet/actionsheet.css","material-icons","listViewStyle","emby-scroller"]);var _default={show:function(options){var dialogOptions={removeOnClose:!0,enableHistory:options.enableHistory,autoFocus:!0,autoCenter:!1,transparentBackground:!0};_layoutmanager.default.tv?dialogOptions.size="fullscreen":dialogOptions.modal=!1;var type=options.type;_layoutmanager.default.tv&&(type=null);var iconRight,dlg=_dialoghelper.default.createDialog(dialogOptions);dlg.classList.add("actionSheet"),_layoutmanager.default.tv||dlg.classList.add("dialog-blur"),type&&dlg.classList.add("actionSheet-"+type),options.dialogClass&&dlg.classList.add(options.dialogClass);var option,hasAside,hasSubText,html="",renderIcon=!1,icons=[];if(!options.multiple)for(i=0,length=options.items.length;i<length;i++){var itemIcon=(option=options.items[i]).icon||(option.selected?"&#xe5ca;":null);itemIcon&&(renderIcon=!0),(option.asideText||option.asideIcon)&&(hasAside=!0),(option.secondaryText||option.title)&&(hasSubText=!0),icons.push({icon:itemIcon||"",iconClass:option.iconClass})}!renderIcon||hasAside||hasSubText||!1===options.iconRight||(iconRight=!0),_layoutmanager.default.tv&&(html+='<button is="paper-icon-button-light" class="btnCloseActionSheet btnCloseActionSheet-tv hide-mouse-idle-tv" tabindex="-1"><i class="md-icon">&#xE5C4;</i></button>');var headerClass,center=options.title&&!renderIcon;(center||_layoutmanager.default.tv)&&dlg.classList.add("actionsheet-centered"),options.item&&!_layoutmanager.default.tv&&(html+=function(options,item){options.showCurrentProgramImage?item.CurrentProgram:item.ProgramInfo;var html="";html+='<div class="actionsheetItemPreview flex flex-direction-row">';var imageAspect,shape,apiClient=_connectionmanager.default.getApiClient(item),imageUrlInfo=options.cardBuilder.getImageUrl(item,apiClient,{height:60,width:200}),imageUrl=imageUrlInfo.imgUrl,imgClass="",round="MusicArtist"===item.Type;imageUrl?(imgClass+=" actionsheetItemPreviewImage-bg",imageAspect=imageUrlInfo.aspect||1,imgClass+=" actionsheetItemPreviewImage-bg-"+(shape=_imageloader.default.getShapeFromAspect(imageAspect)),round&&"square"===shape&&(imgClass+=" actionsheetItemPreviewImage-round"),html+='<div class="'+imgClass.trim()+'" style="aspect-ratio:'+imageAspect+";background-image:url("+imageUrl+');">'):(imgClass+=" actionsheetItemPreviewImage-iconcontainer",round&&(imgClass+=" actionsheetItemPreviewImage-round"),html+='<div class="'+imgClass.trim()+'">',html+='<i class="actionsheetItemPreviewImage-icon md-icon">',html+=options.cardBuilder.getDefaultIcon(item),html+="</i>"),html+="</div>",html+='<div class="actionsheetItemPreviewContent">';var lines=[];item.SeriesName?lines.push(item.SeriesName):"Program"===item.Type&&lines.push(item.Name),lines.push(_itemhelper.default.getDisplayName(item,{})),item.AlbumArtistItems&&item.AlbumArtistItems.length?lines.push(item.AlbumArtistItems[0].Name):item.ArtistItems&&item.ArtistItems.length&&lines.push(item.ArtistItems[0].Name);var secondaryTexts=[];item.Album&&secondaryTexts.push(item.Album),item.ProductionYear&&"Episode"!==item.Type&&secondaryTexts.push(item.ProductionYear),secondaryTexts.length&&lines.push(secondaryTexts.join(" &middot; "));for(var i=0,length=Math.min(lines.length,3);i<length;i++)html+=1<=i?'<div class="actionsheetItemPreviewText secondaryText">':'<div class="actionsheetItemPreviewText">',html+=lines[i],html+="</div>";return html+="</div>",html+="</div>"}(options,options.item)),options.title&&(headerClass="actionSheetTitle","select"===type&&(headerClass+=" actionSheetTitle-select"),options.hideTitleWhenNotFullscreen&&!_layoutmanager.default.tv&&(headerClass+=" actionSheetTitle-hideNonFullscreen"),html+='<h3 class="'+headerClass+'">',html+=options.title,html+="</h3>"),options.text&&(html+='<p class="actionSheetText">',html+=options.text,html+="</p>");var scrollerClassName="actionSheetScroller";_layoutmanager.default.tv&&(scrollerClassName+=" actionSheetScroller-tv focuscontainer-x"),type&&(scrollerClassName+=" actionSheetScroller-"+type),(options.title||options.text)&&(scrollerClassName+=" actionSheetScroller-withheader"),html+='<div is="emby-scroller" data-horizontal="false" data-centerfocus="card" class="'+scrollerClassName+'">';var scrollSliderClass=" actionsheetScrollSlider scrollSlider flex flex-direction-column";options.multiple&&(scrollSliderClass+=" actionsheet-scrollSlider-multiple",_layoutmanager.default.tv&&(scrollSliderClass+=" actionsheet-scrollSlider-multiple-tv")),html+='<div class="'+scrollSliderClass+'">';var cancelButtonClass,btnCloseActionSheetClass,menuItemClass="actionSheetMenuItem";for(options.menuItemClass&&(menuItemClass+=" "+options.menuItemClass),iconRight&&(menuItemClass+=" actionSheetMenuItem-iconright"),options.multiple||(options.asideTextClass="actionSheetItemAsideText",type&&(options.asideTextClass+=" actionSheetItemAsideText-"+type),options.listItemBodyClass="actionsheetListItemBody",iconRight&&(options.listItemBodyClass+=" actionsheetListItemBody-iconright"),type&&(options.listItemBodyClass+=" actionsheetListItemBody-"+type),options.itemIconClass="actionsheetMenuItemIcon listItemIcon listItemIcon-transparent md-icon secondaryText",type&&(options.itemIconClass+=" actionsheetMenuItemIcon-"+type),menuItemClass+=" listItem listItem-button",(options.border||options.shaded)&&(menuItemClass+=" listItem-border"),_layoutmanager.default.tv?menuItemClass+=" listItem-focusscale":menuItemClass+=" listItem-hoverable",type&&(menuItemClass+=" actionSheetMenuItem-"+type),_layoutmanager.default.tv&&(menuItemClass+=" actionSheetMenuItem-tv"),renderIcon||(menuItemClass+=" actionSheetMenuItem-noicon")),i=0,length=options.items.length;i<length;i++)(option=options.items[i]).divider?html+='<div class="actionsheetDivider"></div>':options.multiple?html+=function(option,menuItemClass){var html="",containerClass="checkboxContainer actionSheetMenuItem-checkboxContainer";_layoutmanager.default.tv&&(containerClass+=" actionSheetMenuItem-checkboxContainer-tv"),html+='<div class="'+containerClass+'">',html+="<label>";var currentMenuItemClass=menuItemClass;option.selected&&(currentMenuItemClass+=" autofocus");var optionId=null==option.id||""===option.id?option.value:option.id;return html+="<input"+(option.selected?" checked":"")+' type="checkbox" is="emby-checkbox" class="chkActionSheetMenuItem '+currentMenuItemClass+'" data-id="'+optionId+'" />',html+='<span class="actionSheetItemText">',html+=option.name||option.textContent||option.innerText,html+="</span>",html+="</label>",html+="</div>"}(option,menuItemClass):html+=function(options,option,menuItemClass,itemIcon,renderIcon,center){var html="",currentMenuItemClass=menuItemClass;option.selected&&(currentMenuItemClass+=" actionSheetMenuItem-selected"),option.hideWithFinePointer&&(currentMenuItemClass+=" actionSheetMenuItem-hiddenfinepointer"),option.selected&&(currentMenuItemClass+=" autofocus"),html+='<button is="emby-button" type="button" class="'+currentMenuItemClass+'" data-id="'+(null==option.id||""===option.id?option.value:option.id)+'">';var iconClass=options.itemIconClass;itemIcon&&itemIcon.iconClass&&(iconClass+=" "+itemIcon.iconClass),itemIcon&&itemIcon.icon?html+='<i class="'+iconClass+'">'+itemIcon.icon+"</i>":renderIcon&&!center&&(html+='<i class="'+iconClass+'" style="visibility:hidden;">&#xe5ca;</i>'),html+='<div class="listItemBody '+options.listItemBodyClass+'">',html+='<div class="listItemBodyText actionSheetItemText">',html+=option.name||option.textContent||option.innerText,html+="</div>";var secondaryText=option.secondaryText||option.title;return secondaryText&&(html+='<div class="listItemBodyText listItemBodyText-secondary">',html+=secondaryText,html+="</div>"),html+="</div>",option.asideText&&(html+='<div class="listItemAside '+options.asideTextClass+' secondaryText">',html+=option.asideText,html+="</div>"),option.asideIcon&&(html+='<div class="listItemAside '+options.asideTextClass+' actionSheetItemAsideIcon secondaryText"><i class="md-icon">',html+=option.asideIcon,html+="</i></div>"),html+="</button>"}(options,option,menuItemClass,icons[i],renderIcon,center);html+="</div>",html+="</div>",options.bottomText&&(html+='<div class="actionSheetBottomText fieldDescription">',html+=options.bottomText,html+="</div>"),_layoutmanager.default.tv&&!options.multiple||("select"===type?(html+="select"===type?'<div class="actionSheet-bottom actionSheet-select-bottom">':'<div class="actionSheet-bottom">',cancelButtonClass="btnCloseActionSheet btnCloseActionSheet-default","select"===type&&(cancelButtonClass+=" btnCloseActionSheet-select"),html+='<button is="emby-button" type="button" class="'+cancelButtonClass+' hide-mouse-idle-tv raised block">'+_globalize.default.translate("Cancel")+"</button>",html+="</div>"):options.multiple&&(btnCloseActionSheetClass="btnCloseActionSheet btnCloseActionSheet-bottom raised block",_layoutmanager.default.tv&&(btnCloseActionSheetClass+=" btnCloseActionSheet-bottom-tv"),html+='<button is="emby-button" type="button" class="'+btnCloseActionSheetClass+'">'+_globalize.default.translate("Done")+"</button>"));var enablePositioning=options.positionTo&&"fullscreen"!==dialogOptions.size;enablePositioning&&(options.transformOrigin?"center top"===options.transformOrigin?dlg.classList.add("dialog-transformorigin-top"):"left top"===options.transformOrigin?dlg.classList.add("dialog-transformorigin-lefttop"):"center bottom"===options.transformOrigin&&dlg.classList.add("dialog-transformorigin-bottom"):"bottom"===options.positionY?"right"===options.positionX?dlg.classList.add("dialog-transformorigin-lefttop"):dlg.classList.add("dialog-transformorigin-top"):"top"===options.positionY&&dlg.classList.add("dialog-transformorigin-bottom")),dlg.innerHTML=html;for(var selectedId,timeout,btnCloseActionSheets=dlg.querySelectorAll(".btnCloseActionSheet"),i=0,length=btnCloseActionSheets.length;i<length;i++)btnCloseActionSheets[i].addEventListener("click",onCancelClick);return options.timeout&&(timeout=setTimeout(function(){_dialoghelper.default.close(dlg)},options.timeout)),new Promise(function(resolve,reject){var isResolved;dlg.addEventListener("click",function(e){var actionSheetMenuItem=e.target.closest("button.actionSheetMenuItem");actionSheetMenuItem&&(selectedId=actionSheetMenuItem.getAttribute("data-id"),!options.resolveOnClick||options.resolveOnClick.indexOf&&-1===options.resolveOnClick.indexOf(selectedId)||(resolve(selectedId),isResolved=!0),_dialoghelper.default.close(dlg))}),dlg.addEventListener("close",function(){var resolveResult;timeout&&(clearTimeout(timeout),timeout=null),isResolved||(null!=(resolveResult=options.multiple?function(dlg){return Array.prototype.map.call(dlg.querySelectorAll(".chkActionSheetMenuItem:checked"),function(elem){return elem.getAttribute("data-id")})}(dlg):selectedId)?(options.callback&&options.callback(resolveResult),resolve(resolveResult)):reject())}),_dialoghelper.default.open(dlg);var pos=enablePositioning?getPosition(options,dlg):null;pos&&(dlg.style.position="fixed",dlg.style.left=pos.left+"px",dlg.style.top=pos.top+"px",!1===options.preventOverflow&&(dlg.style.maxHeight="calc(98% - "+pos.top+"px)"),options.minWidthToElement&&pos.width&&(dlg.style.minWidth=pos.width+"px"))})}};_exports.default=_default});