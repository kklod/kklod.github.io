define(["exports","./../approuter.js","./../dom.js","./../focusmanager.js","./../common/inputmanager.js"],function(_exports,_approuter,_dom,_focusmanager,_inputmanager){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_approuter=babelHelpers.interopRequireDefault(_approuter),_dom=babelHelpers.interopRequireDefault(_dom),_focusmanager=babelHelpers.interopRequireDefault(_focusmanager),_inputmanager=babelHelpers.interopRequireDefault(_inputmanager);var globalOnOpenCallback,uiDependencies=["css!modules/dialoghelper/dialoghelper.css"];uiDependencies.length&&require(uiDependencies);var supportsCssAnimations=CSS.supports("animation-name","a");function enableAnimation(){return supportsCssAnimations&&_dom.default.supportsEventListenerOnce()}function tryRemoveElement(elem){var parentNode=elem.parentNode;if(parentNode)try{parentNode.removeChild(elem)}catch(err){console.log("Error removing dialog element: "+err)}}function getScrollingElement(){return document.scrollingElement||document.documentElement}function DialogHashHandler(dlg,hash,resolve){var self=this;self.originalUrl=window.location.href;var activeElement=document.activeElement,removeScrollLockOnClose=!1;function onHashChange(e){var isBack=self.originalUrl===window.location.href;!isBack&&isOpened(dlg)||window.removeEventListener("popstate",onHashChange),isBack&&closeDialog(dlg)}function onInputCommand(e){var command=e.detail.command;"back"===command?isHistoryEnabled(dlg)||(e.preventDefault(),e.stopPropagation(),closeDialog(dlg)):"left"===command||"right"===command||"up"===command||"down"===command||"pageup"===command||"pagedown"===command?e.stopPropagation():"home"!==command&&"end"!==command&&"settings"!==command&&"guide"!==command&&"recordedtv"!==command&&"favorites"!==command&&"channelup"!==command&&"channeldown"!==command||e.preventDefault()}_dom.default.addEventListener(dlg,"close",function(){var elemForEvents=dlg.dialogContainer;elemForEvents&&dlg.boundDocumentMouseDown&&(_dom.default.removeEventListener(elemForEvents,window.PointerEvent?"pointerdown":"mousedown",dlg.boundDocumentMouseDown,{passive:!0}),dlg.boundDocumentMouseDown=null),elemForEvents&&dlg.boundDocumentClick&&(_dom.default.removeEventListener(elemForEvents,"click",dlg.boundDocumentClick,{passive:!0}),dlg.boundDocumentClick=null),_inputmanager.default.off(dlg,onInputCommand),window.removeEventListener("popstate",onHashChange),dlg.classList.remove("opened"),removeScrollLockOnClose&&getScrollingElement().classList.remove("withDialogOpen"),activeElement&&_focusmanager.default.focus(activeElement);var dialogContainer=dlg.dialogContainer;"false"!==dlg.getAttribute("data-removeonclose")?dialogContainer?(function(dlg){var backdrop=dlg.dialogContainer;if(!backdrop)return;function onAnimationFinish(){tryRemoveElement(backdrop)}if(enableAnimation())return backdrop.classList.remove("dialogBackdropOpened"),setTimeout(onAnimationFinish,300);onAnimationFinish()}(dlg),dlg.dialogContainer=null):tryRemoveElement(dlg):dialogContainer&&dialogContainer.classList.remove("dialogBackdropOpened"),setTimeout(function(){resolve({element:dlg})},1)},{once:!0}),function(dlg){dlg.getAttribute("data-transparentbackground")||(dlg.dialogContainer.classList.add("dialogBackdrop"),dlg.dialogContainer.offsetWidth,dlg.dialogContainer.classList.add("dialogBackdropOpened"));setTimeout(function(){this.boundDocumentMouseDown||(this.boundDocumentMouseDown=function(e){this.pointerDownOnBackdrop=e.target===this.dialogContainer}.bind(this));var elemForEvents=this.dialogContainer;_dom.default.addEventListener(elemForEvents,window.PointerEvent?"pointerdown":"mousedown",this.boundDocumentMouseDown,{passive:!0}),this.boundDocumentClick||(this.boundDocumentClick=function(e){var target=e.target;(target===this.dialogContainer&&this.pointerDownOnBackdrop||!this.contains(target))&&close(this)}.bind(this));_dom.default.addEventListener(elemForEvents,"click",this.boundDocumentClick,{passive:!0})}.bind(dlg),100)}(dlg),dlg.classList.remove("hide"),dlg.classList.add("opened"),dlg.dispatchEvent(new CustomEvent("open",{bubbles:!1,cancelable:!1}));var scrollingElement=getScrollingElement();"true"!==dlg.getAttribute("data-lockscroll")||scrollingElement.classList.contains("withDialogOpen")||(scrollingElement.classList.add("withDialogOpen"),removeScrollLockOnClose=!0),function(dlg){if(enableAnimation())return _dom.default.addEventListener(dlg,"animationend",onOpenAnimationFinish,{passive:!0});onOpenAnimationFinish.call(dlg,{target:dlg,currentTarget:dlg})}(dlg),isHistoryEnabled(dlg)&&(_approuter.default.pushState({dialogId:hash},"Dialog","#"+hash),window.addEventListener("popstate",onHashChange)),_inputmanager.default.on(dlg,onInputCommand)}function onOpenAnimationFinish(e){e.target===e.currentTarget&&(_dom.default.removeEventListener(this,"animationend",onOpenAnimationFinish,{passive:!0}),_focusmanager.default.pushScope(this),this.dispatchEvent(new CustomEvent("opened",{bubbles:!1,cancelable:!1})),"true"===this.getAttribute("data-autofocus")&&_focusmanager.default.autoFocus(this))}function isHistoryEnabled(dlg){return"true"===dlg.getAttribute("data-history")}function isOpened(dlg){return!dlg.classList.contains("hide")}function close(dlg){isOpened(dlg)&&(isHistoryEnabled(dlg)?_approuter.default.back():closeDialog(dlg))}function onCloseAnimationFinish(e){e.target===e.currentTarget&&(_dom.default.removeEventListener(this,"animationend",onCloseAnimationFinish,{passive:!0}),_focusmanager.default.popScope(this),this.classList.add("hide"),this.dispatchEvent(new CustomEvent("close",{bubbles:!1,cancelable:!1})))}function closeDialog(dlg){dlg.classList.contains("hide")||(dlg.dispatchEvent(new CustomEvent("closing",{bubbles:!1,cancelable:!1})),dlg.classList.add("dialog-close"),enableAnimation()?_dom.default.addEventListener(dlg,"animationend",onCloseAnimationFinish,{once:!0}):onCloseAnimationFinish.call(dlg,{target:dlg,currentTarget:dlg}))}var _default={open:function(dlg){dlg.classList.remove("dialog-close"),globalOnOpenCallback&&globalOnOpenCallback(dlg);var parent=dlg.parentNode;parent&&parent.removeChild(dlg);var dialogContainer=document.createElement("div");return dialogContainer.classList.add("dialogContainer"),dialogContainer.appendChild(dlg),dlg.dialogContainer=dialogContainer,document.body.appendChild(dialogContainer),new Promise(function(resolve,reject){new DialogHashHandler(dlg,"dlg"+Date.now(),resolve)})},close:close,createDialog:function(options){options=options||{};var dlg=document.createElement("div");return dlg.classList.add("hide","focuscontainer"),dlg.setAttribute("data-lockscroll","true"),!1!==options.enableHistory&&_approuter.default.enableNativeHistory()&&dlg.setAttribute("data-history","true"),!1!==options.autoFocus&&dlg.setAttribute("data-autofocus","true"),dlg.classList.add("dialog"),enableAnimation()||dlg.classList.add("dialog-noanimation"),options.removeOnClose&&dlg.setAttribute("data-removeonclose","true"),options.transparentBackground&&dlg.setAttribute("data-transparentbackground","true"),options.size&&dlg.classList.add("dialog-fixedSize","dialog-"+options.size),!1===options.autoCenter||dlg.classList.contains("dialog-fixedSize")||dlg.classList.add("centeredDialog"),dlg},setOnOpen:function(val){globalOnOpenCallback=val}};_exports.default=_default});